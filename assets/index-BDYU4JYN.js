var ft=Object.defineProperty;var pt=(d,e,t)=>e in d?ft(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var w=(d,e,t)=>pt(d,typeof e!="symbol"?e+"":e,t);import{cc as gt,k as mt,q as ze,cd as kt,ce as vt,p as Se,ad as Ue,d as L,cf as wt,ag as Ct,v as re,aZ as St,x as yt,F as N,i as De,c as G,y as Be,cg as bt,ch as Et,C as xt,D as Tt,ci as Mt,m as At,G as _t,a4 as He,I as le,cj as Rt,ck as Ft,a as $,o as F,b as S,bm as Pt,a7 as It,e as y,t as U,w as E,g,a3 as ne,J as oe,V,f as j,cl as Pe,W as zt,l as K,B as me,cm as ye,a1 as Ie,cn as Ut,co as Dt,b3 as Nt,cp as Ot,cq as $t,aE as Lt,aF as Bt,cr as Ht,cs as Wt,ct as Gt,cu as Qt,cv as jt,cw as Kt}from"./index-D3pJGQdL.js";import{I as We,V as Ge,D as Qe,A as je,a as Ke,_ as Ve,M as Vt,T as Zt,C as qt,b as Yt,F as Xt}from"./VideocamOutline-C45UeHwq.js";import{N as Jt,C as es}from"./index-C3wqSuGS.js";import{C as be}from"./CloudUploadOutline-BAOOvIVW.js";import{u as ts}from"./use-theme-vars-CxNnKqFN.js";import{_ as ss,a as rs}from"./FormItem-DYD-Ey5V.js";const ns=gt&&"loading"in document.createElement("img");function is(d={}){var e;const{root:t=null}=d;return{hash:`${d.rootMargin||"0px 0px 0px 0px"}-${Array.isArray(d.threshold)?d.threshold.join(","):(e=d.threshold)!==null&&e!==void 0?e:"0"}`,options:Object.assign(Object.assign({},d),{root:(typeof t=="string"?document.querySelector(t):t)||document.documentElement})}}const Ee=new WeakMap,xe=new WeakMap,Te=new WeakMap,as=(d,e,t)=>{if(!d)return()=>{};const s=is(e),{root:r}=s.options;let n;const o=Ee.get(r);o?n=o:(n=new Map,Ee.set(r,n));let f,p;n.has(s.hash)?(p=n.get(s.hash),p[1].has(d)||(f=p[0],p[1].add(d),f.observe(d))):(f=new IntersectionObserver(C=>{C.forEach(b=>{if(b.isIntersecting){const A=xe.get(b.target),W=Te.get(b.target);A&&A(),W&&(W.value=!0)}})},s.options),f.observe(d),p=[f,new Set([d])],n.set(s.hash,p));let v=!1;const m=()=>{v||(xe.delete(d),Te.delete(d),v=!0,p[1].has(d)&&(p[0].unobserve(d),p[1].delete(d)),p[1].size<=0&&n.delete(s.hash),n.size||Ee.delete(r))};return xe.set(d,m),Te.set(d,t),m},os=mt("n-avatar-group"),ls=ze("avatar",`
 width: var(--n-merged-size);
 height: var(--n-merged-size);
 color: #FFF;
 font-size: var(--n-font-size);
 display: inline-flex;
 position: relative;
 overflow: hidden;
 text-align: center;
 border: var(--n-border);
 border-radius: var(--n-border-radius);
 --n-merged-color: var(--n-color);
 background-color: var(--n-merged-color);
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
`,[kt(Se("&","--n-merged-color: var(--n-color-modal);")),vt(Se("&","--n-merged-color: var(--n-color-popover);")),Se("img",`
 width: 100%;
 height: 100%;
 `),Ue("text",`
 white-space: nowrap;
 display: inline-block;
 position: absolute;
 left: 50%;
 top: 50%;
 `),ze("icon",`
 vertical-align: bottom;
 font-size: calc(var(--n-merged-size) - 6px);
 `),Ue("text","line-height: 1.25")]),cs=Object.assign(Object.assign({},Be.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),us=L({name:"Avatar",props:cs,slots:Object,setup(d){const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=yt(d),s=N(!1);let r=null;const n=N(null),o=N(null),f=()=>{const{value:c}=n;if(c&&(r===null||r!==c.innerHTML)){r=c.innerHTML;const{value:i}=o;if(i){const{offsetWidth:a,offsetHeight:h}=i,{offsetWidth:l,offsetHeight:z}=c,H=.9,Q=Math.min(a/l*H,h/z*H,1);c.style.transform=`translateX(-50%) translateY(-50%) scale(${Q})`}}},p=De(os,null),v=G(()=>{const{size:c}=d;if(c)return c;const{size:i}=p||{};return i||"medium"}),m=Be("Avatar","-avatar",ls,bt,d,e),C=De(Et,null),b=G(()=>{if(p)return!0;const{round:c,circle:i}=d;return c!==void 0||i!==void 0?c||i:C?C.roundRef.value:!1}),A=G(()=>p?!0:d.bordered||!1),W=G(()=>{const c=v.value,i=b.value,a=A.value,{color:h}=d,{self:{borderRadius:l,fontSize:z,color:H,border:Q,colorModal:ee,colorPopover:ce},common:{cubicBezierEaseInOut:ue}}=m.value;let te;return typeof c=="number"?te=`${c}px`:te=m.value.self[xt("height",c)],{"--n-font-size":z,"--n-border":a?Q:"none","--n-border-radius":i?"50%":l,"--n-color":h||H,"--n-color-modal":h||ee,"--n-color-popover":h||ce,"--n-bezier":ue,"--n-merged-size":`var(--n-avatar-size-override, ${te})`}}),O=t?Tt("avatar",G(()=>{const c=v.value,i=b.value,a=A.value,{color:h}=d;let l="";return c&&(typeof c=="number"?l+=`a${c}`:l+=c[0]),i&&(l+="b"),a&&(l+="c"),h&&(l+=Mt(h)),l}),W,d):void 0,x=N(!d.lazy);At(()=>{if(d.lazy&&d.intersectionObserverOptions){let c;const i=_t(()=>{c==null||c(),c=void 0,d.lazy&&(c=as(o.value,d.intersectionObserverOptions,x))});He(()=>{i(),c==null||c()})}}),le(()=>{var c;return d.src||((c=d.imgProps)===null||c===void 0?void 0:c.src)},()=>{s.value=!1});const u=N(!d.lazy);return{textRef:n,selfRef:o,mergedRoundRef:b,mergedClsPrefix:e,fitTextTransform:f,cssVars:t?void 0:W,themeClass:O==null?void 0:O.themeClass,onRender:O==null?void 0:O.onRender,hasLoadError:s,shouldStartLoading:x,loaded:u,mergedOnError:c=>{if(!x.value)return;s.value=!0;const{onError:i,imgProps:{onError:a}={}}=d;i==null||i(c),a==null||a(c)},mergedOnLoad:c=>{const{onLoad:i,imgProps:{onLoad:a}={}}=d;i==null||i(c),a==null||a(c),u.value=!0}}},render(){var d,e;const{$slots:t,src:s,mergedClsPrefix:r,lazy:n,onRender:o,loaded:f,hasLoadError:p,imgProps:v={}}=this;o==null||o();let m;const C=!f&&!p&&(this.renderPlaceholder?this.renderPlaceholder():(e=(d=this.$slots).placeholder)===null||e===void 0?void 0:e.call(d));return this.hasLoadError?m=this.renderFallback?this.renderFallback():wt(t.fallback,()=>[re("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})]):m=Ct(t.default,b=>{if(b)return re(St,{onResize:this.fitTextTransform},{default:()=>re("span",{ref:"textRef",class:`${r}-avatar__text`},b)});if(s||v.src){const A=this.src||v.src;return re("img",Object.assign(Object.assign({},v),{loading:ns&&!this.intersectionObserverOptions&&n?"lazy":"eager",src:n&&this.intersectionObserverOptions?this.shouldStartLoading?A:void 0:A,"data-image-src":A,onLoad:this.mergedOnLoad,onError:this.mergedOnError,style:[v.style||"",{objectFit:this.objectFit},C?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}}),re("span",{ref:"selfRef",class:[`${r}-avatar`,this.themeClass],style:this.cssVars},m,n&&C)}}),hs={scrollbarProps:Object,items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},ds=L({name:"VirtualList",props:hs,setup(d){const e=N(null),t=N(null);function s(){const{value:m}=e;m&&m.sync()}function r(m){var C;s(),(C=d.onScroll)===null||C===void 0||C.call(d,m)}function n(m){var C;s(),(C=d.onResize)===null||C===void 0||C.call(d,m)}function o(m){var C;(C=d.onWheel)===null||C===void 0||C.call(d,m)}function f(m,C){var b,A;typeof m=="number"?(b=t.value)===null||b===void 0||b.scrollTo(m,C??0):(A=t.value)===null||A===void 0||A.scrollTo(m)}function p(){var m;return(m=t.value)===null||m===void 0?void 0:m.listElRef}function v(){var m;return(m=t.value)===null||m===void 0?void 0:m.itemsElRef}return{scrollTo:f,scrollbarInstRef:e,virtualListInstRef:t,getScrollContainer:p,getScrollContent:v,handleScroll:r,handleResize:n,handleWheel:o}},render(){return re(Ft,Object.assign({},this.scrollbarProps,{ref:"scrollbarInstRef",container:this.getScrollContainer,content:this.getScrollContent}),{default:()=>re(Rt,{ref:"virtualListInstRef",showScrollbar:!1,items:this.items,itemSize:this.itemSize,itemResizable:this.itemResizable,itemsStyle:this.itemsStyle,visibleItemsTag:this.visibleItemsTag,visibleItemsProps:this.visibleItemsProps,ignoreItemResize:this.ignoreItemResize,keyField:this.keyField,defaultScrollKey:this.defaultScrollKey,defaultScrollIndex:this.defaultScrollIndex,paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,onScroll:this.handleScroll,onResize:this.handleResize,onWheel:this.handleWheel},{default:({item:d,index:e})=>{var t,s;return(s=(t=this.$slots).default)===null||s===void 0?void 0:s.call(t,{item:d,index:e})}})})}}),fs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ps=L({name:"ArrowUpOutline",render:function(e,t){return F(),$("svg",fs,t[0]||(t[0]=[S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1)]))}}),gs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ms=L({name:"CheckmarkDoneOutline",render:function(e,t){return F(),$("svg",gs,t[0]||(t[0]=[S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M464 128L240 384l-96-96"},null,-1),S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M144 384l-96-96"},null,-1),S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 128L232 284"},null,-1)]))}}),ks={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},vs=L({name:"ChevronDownOutline",render:function(e,t){return F(),$("svg",ks,t[0]||(t[0]=[S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),ws={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Cs=L({name:"CloseOutline",render:function(e,t){return F(),$("svg",ws,t[0]||(t[0]=[S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1)]))}}),Ss={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ys=L({name:"DocumentsOutline",render:function(e,t){return F(),$("svg",Ss,t[0]||(t[0]=[S("path",{d:"M336 264.13V436c0 24.3-19.05 44-42.95 44H107c-23.95 0-43-19.7-43-44V172a44.26 44.26 0 0 1 44-44h94.12a24.55 24.55 0 0 1 17.49 7.36l109.15 111a25.4 25.4 0 0 1 7.24 17.77z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),S("path",{d:"M200 128v108a28.34 28.34 0 0 0 28 28h108",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),S("path",{d:"M176 128V76a44.26 44.26 0 0 1 44-44h94a24.83 24.83 0 0 1 17.61 7.36l109.15 111A25.09 25.09 0 0 1 448 168v172c0 24.3-19.05 44-42.95 44H344",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),S("path",{d:"M312 32v108a28.34 28.34 0 0 0 28 28h108",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),bs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Es=L({name:"EyeOutline",render:function(e,t){return F(),$("svg",bs,t[0]||(t[0]=[S("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),S("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),xs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ts=L({name:"MusicalNoteOutline",render:function(e,t){return F(),$("svg",xs,t[0]||(t[0]=[S("path",{d:"M240 343.31V424a32.28 32.28 0 0 1-21.88 30.65l-21.47 7.23c-25.9 8.71-52.65-10.75-52.65-38.32h0A34.29 34.29 0 0 1 167.25 391l50.87-17.12A32.29 32.29 0 0 0 240 343.24V92a16.13 16.13 0 0 1 12.06-15.66L360.49 48.2A6 6 0 0 1 368 54v57.76a16.13 16.13 0 0 1-12.12 15.67l-91.64 23.13A32.25 32.25 0 0 0 240 181.91v39.39",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Ms={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},As=L({name:"PauseOutline",render:function(e,t){return F(),$("svg",Ms,t[0]||(t[0]=[S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 96h16v320h-16z"},null,-1),S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M320 96h16v320h-16z"},null,-1)]))}}),_s={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ne=L({name:"PlayOutline",render:function(e,t){return F(),$("svg",_s,t[0]||(t[0]=[S("path",{d:"M112 111v290c0 17.44 17 28.52 31 20.16l247.9-148.37c12.12-7.25 12.12-26.33 0-33.58L143 90.84c-14-8.36-31 2.72-31 20.16z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),Rs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ze=L({name:"RefreshOutline",render:function(e,t){return F(),$("svg",Rs,t[0]||(t[0]=[S("path",{d:"M320 146s24.36-12-64-12a160 160 0 1 0 160 160",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 58l80 80l-80 80"},null,-1)]))}}),Fs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ps=L({name:"SettingsOutline",render:function(e,t){return F(),$("svg",Fs,t[0]||(t[0]=[S("path",{d:"M262.29 192.31a64 64 0 1 0 57.4 57.4a64.13 64.13 0 0 0-57.4-57.4zM416.39 256a154.34 154.34 0 0 1-1.53 20.79l45.21 35.46a10.81 10.81 0 0 1 2.45 13.75l-42.77 74a10.81 10.81 0 0 1-13.14 4.59l-44.9-18.08a16.11 16.11 0 0 0-15.17 1.75A164.48 164.48 0 0 1 325 400.8a15.94 15.94 0 0 0-8.82 12.14l-6.73 47.89a11.08 11.08 0 0 1-10.68 9.17h-85.54a11.11 11.11 0 0 1-10.69-8.87l-6.72-47.82a16.07 16.07 0 0 0-9-12.22a155.3 155.3 0 0 1-21.46-12.57a16 16 0 0 0-15.11-1.71l-44.89 18.07a10.81 10.81 0 0 1-13.14-4.58l-42.77-74a10.8 10.8 0 0 1 2.45-13.75l38.21-30a16.05 16.05 0 0 0 6-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 0 0-6.07-13.94l-38.19-30A10.81 10.81 0 0 1 49.48 186l42.77-74a10.81 10.81 0 0 1 13.14-4.59l44.9 18.08a16.11 16.11 0 0 0 15.17-1.75A164.48 164.48 0 0 1 187 111.2a15.94 15.94 0 0 0 8.82-12.14l6.73-47.89A11.08 11.08 0 0 1 213.23 42h85.54a11.11 11.11 0 0 1 10.69 8.87l6.72 47.82a16.07 16.07 0 0 0 9 12.22a155.3 155.3 0 0 1 21.46 12.57a16 16 0 0 0 15.11 1.71l44.89-18.07a10.81 10.81 0 0 1 13.14 4.58l42.77 74a10.8 10.8 0 0 1-2.45 13.75l-38.21 30a16.05 16.05 0 0 0-6.05 14.08c.33 4.14.55 8.3.55 12.47z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),Is={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},zs=L({name:"SpeedometerOutline",render:function(e,t){return F(),$("svg",Is,t[0]||(t[0]=[Pt('<path d="M326.1 231.9l-47.5 75.5a31 31 0 0 1-7 7a30.11 30.11 0 0 1-35-49l75.5-47.5a10.23 10.23 0 0 1 11.7 0a10.06 10.06 0 0 1 2.3 14z" fill="currentColor"></path><path d="M256 64C132.3 64 32 164.2 32 287.9a223.18 223.18 0 0 0 56.3 148.5c1.1 1.2 2.1 2.4 3.2 3.5a25.19 25.19 0 0 0 37.1-.1a173.13 173.13 0 0 1 254.8 0a25.19 25.19 0 0 0 37.1.1l3.2-3.5A223.18 223.18 0 0 0 480 287.9C480 164.2 379.7 64 256 64z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M256 128v32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M416 288h-32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M128 288H96"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M165.49 197.49l-22.63-22.63"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M346.51 197.49l22.63-22.63"></path>',7)]))}}),Us={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Oe=L({name:"TimeOutline",render:function(e,t){return F(),$("svg",Us,t[0]||(t[0]=[S("path",{d:"M256 64C150 64 64 150 64 256s86 192 192 192s192-86 192-192S362 64 256 64z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),S("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 128v144h96"},null,-1)]))}}),Ds={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ns=L({name:"WifiOutline",render:function(e,t){return F(),$("svg",Ds,t[0]||(t[0]=[S("path",{d:"M332.41 310.59a115 115 0 0 0-152.8 0",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),S("path",{d:"M393.46 249.54a201.26 201.26 0 0 0-274.92 0",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),S("path",{d:"M447.72 182.11a288 288 0 0 0-383.44 0",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),S("path",{d:"M256 416a32 32 0 1 1 32-32a32 32 0 0 1-32 32z",fill:"currentColor"},null,-1)]))}});var k=(d=>(d.PENDING="pending",d.UPLOADING="uploading",d.SUCCESS="success",d.ERROR="error",d.PAUSED="paused",d.CANCELLED="cancelled",d))(k||{}),D=(d=>(d.PENDING="pending",d.UPLOADING="uploading",d.SUCCESS="success",d.ERROR="error",d.RETRYING="retrying",d))(D||{}),Me={exports:{}},$e;function Os(){return $e||($e=1,function(d,e){(function(t){d.exports=t()})(function(t){var s=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(u,c){var i=u[0],a=u[1],h=u[2],l=u[3];i+=(a&h|~a&l)+c[0]-680876936|0,i=(i<<7|i>>>25)+a|0,l+=(i&a|~i&h)+c[1]-389564586|0,l=(l<<12|l>>>20)+i|0,h+=(l&i|~l&a)+c[2]+606105819|0,h=(h<<17|h>>>15)+l|0,a+=(h&l|~h&i)+c[3]-1044525330|0,a=(a<<22|a>>>10)+h|0,i+=(a&h|~a&l)+c[4]-176418897|0,i=(i<<7|i>>>25)+a|0,l+=(i&a|~i&h)+c[5]+1200080426|0,l=(l<<12|l>>>20)+i|0,h+=(l&i|~l&a)+c[6]-1473231341|0,h=(h<<17|h>>>15)+l|0,a+=(h&l|~h&i)+c[7]-45705983|0,a=(a<<22|a>>>10)+h|0,i+=(a&h|~a&l)+c[8]+1770035416|0,i=(i<<7|i>>>25)+a|0,l+=(i&a|~i&h)+c[9]-1958414417|0,l=(l<<12|l>>>20)+i|0,h+=(l&i|~l&a)+c[10]-42063|0,h=(h<<17|h>>>15)+l|0,a+=(h&l|~h&i)+c[11]-1990404162|0,a=(a<<22|a>>>10)+h|0,i+=(a&h|~a&l)+c[12]+1804603682|0,i=(i<<7|i>>>25)+a|0,l+=(i&a|~i&h)+c[13]-40341101|0,l=(l<<12|l>>>20)+i|0,h+=(l&i|~l&a)+c[14]-1502002290|0,h=(h<<17|h>>>15)+l|0,a+=(h&l|~h&i)+c[15]+1236535329|0,a=(a<<22|a>>>10)+h|0,i+=(a&l|h&~l)+c[1]-165796510|0,i=(i<<5|i>>>27)+a|0,l+=(i&h|a&~h)+c[6]-1069501632|0,l=(l<<9|l>>>23)+i|0,h+=(l&a|i&~a)+c[11]+643717713|0,h=(h<<14|h>>>18)+l|0,a+=(h&i|l&~i)+c[0]-373897302|0,a=(a<<20|a>>>12)+h|0,i+=(a&l|h&~l)+c[5]-701558691|0,i=(i<<5|i>>>27)+a|0,l+=(i&h|a&~h)+c[10]+38016083|0,l=(l<<9|l>>>23)+i|0,h+=(l&a|i&~a)+c[15]-660478335|0,h=(h<<14|h>>>18)+l|0,a+=(h&i|l&~i)+c[4]-405537848|0,a=(a<<20|a>>>12)+h|0,i+=(a&l|h&~l)+c[9]+568446438|0,i=(i<<5|i>>>27)+a|0,l+=(i&h|a&~h)+c[14]-1019803690|0,l=(l<<9|l>>>23)+i|0,h+=(l&a|i&~a)+c[3]-187363961|0,h=(h<<14|h>>>18)+l|0,a+=(h&i|l&~i)+c[8]+1163531501|0,a=(a<<20|a>>>12)+h|0,i+=(a&l|h&~l)+c[13]-1444681467|0,i=(i<<5|i>>>27)+a|0,l+=(i&h|a&~h)+c[2]-51403784|0,l=(l<<9|l>>>23)+i|0,h+=(l&a|i&~a)+c[7]+1735328473|0,h=(h<<14|h>>>18)+l|0,a+=(h&i|l&~i)+c[12]-1926607734|0,a=(a<<20|a>>>12)+h|0,i+=(a^h^l)+c[5]-378558|0,i=(i<<4|i>>>28)+a|0,l+=(i^a^h)+c[8]-2022574463|0,l=(l<<11|l>>>21)+i|0,h+=(l^i^a)+c[11]+1839030562|0,h=(h<<16|h>>>16)+l|0,a+=(h^l^i)+c[14]-35309556|0,a=(a<<23|a>>>9)+h|0,i+=(a^h^l)+c[1]-1530992060|0,i=(i<<4|i>>>28)+a|0,l+=(i^a^h)+c[4]+1272893353|0,l=(l<<11|l>>>21)+i|0,h+=(l^i^a)+c[7]-155497632|0,h=(h<<16|h>>>16)+l|0,a+=(h^l^i)+c[10]-1094730640|0,a=(a<<23|a>>>9)+h|0,i+=(a^h^l)+c[13]+681279174|0,i=(i<<4|i>>>28)+a|0,l+=(i^a^h)+c[0]-358537222|0,l=(l<<11|l>>>21)+i|0,h+=(l^i^a)+c[3]-722521979|0,h=(h<<16|h>>>16)+l|0,a+=(h^l^i)+c[6]+76029189|0,a=(a<<23|a>>>9)+h|0,i+=(a^h^l)+c[9]-640364487|0,i=(i<<4|i>>>28)+a|0,l+=(i^a^h)+c[12]-421815835|0,l=(l<<11|l>>>21)+i|0,h+=(l^i^a)+c[15]+530742520|0,h=(h<<16|h>>>16)+l|0,a+=(h^l^i)+c[2]-995338651|0,a=(a<<23|a>>>9)+h|0,i+=(h^(a|~l))+c[0]-198630844|0,i=(i<<6|i>>>26)+a|0,l+=(a^(i|~h))+c[7]+1126891415|0,l=(l<<10|l>>>22)+i|0,h+=(i^(l|~a))+c[14]-1416354905|0,h=(h<<15|h>>>17)+l|0,a+=(l^(h|~i))+c[5]-57434055|0,a=(a<<21|a>>>11)+h|0,i+=(h^(a|~l))+c[12]+1700485571|0,i=(i<<6|i>>>26)+a|0,l+=(a^(i|~h))+c[3]-1894986606|0,l=(l<<10|l>>>22)+i|0,h+=(i^(l|~a))+c[10]-1051523|0,h=(h<<15|h>>>17)+l|0,a+=(l^(h|~i))+c[1]-2054922799|0,a=(a<<21|a>>>11)+h|0,i+=(h^(a|~l))+c[8]+1873313359|0,i=(i<<6|i>>>26)+a|0,l+=(a^(i|~h))+c[15]-30611744|0,l=(l<<10|l>>>22)+i|0,h+=(i^(l|~a))+c[6]-1560198380|0,h=(h<<15|h>>>17)+l|0,a+=(l^(h|~i))+c[13]+1309151649|0,a=(a<<21|a>>>11)+h|0,i+=(h^(a|~l))+c[4]-145523070|0,i=(i<<6|i>>>26)+a|0,l+=(a^(i|~h))+c[11]-1120210379|0,l=(l<<10|l>>>22)+i|0,h+=(i^(l|~a))+c[2]+718787259|0,h=(h<<15|h>>>17)+l|0,a+=(l^(h|~i))+c[9]-343485551|0,a=(a<<21|a>>>11)+h|0,u[0]=i+u[0]|0,u[1]=a+u[1]|0,u[2]=h+u[2]|0,u[3]=l+u[3]|0}function n(u){var c=[],i;for(i=0;i<64;i+=4)c[i>>2]=u.charCodeAt(i)+(u.charCodeAt(i+1)<<8)+(u.charCodeAt(i+2)<<16)+(u.charCodeAt(i+3)<<24);return c}function o(u){var c=[],i;for(i=0;i<64;i+=4)c[i>>2]=u[i]+(u[i+1]<<8)+(u[i+2]<<16)+(u[i+3]<<24);return c}function f(u){var c=u.length,i=[1732584193,-271733879,-1732584194,271733878],a,h,l,z,H,Q;for(a=64;a<=c;a+=64)r(i,n(u.substring(a-64,a)));for(u=u.substring(a-64),h=u.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<h;a+=1)l[a>>2]|=u.charCodeAt(a)<<(a%4<<3);if(l[a>>2]|=128<<(a%4<<3),a>55)for(r(i,l),a=0;a<16;a+=1)l[a]=0;return z=c*8,z=z.toString(16).match(/(.*?)(.{0,8})$/),H=parseInt(z[2],16),Q=parseInt(z[1],16)||0,l[14]=H,l[15]=Q,r(i,l),i}function p(u){var c=u.length,i=[1732584193,-271733879,-1732584194,271733878],a,h,l,z,H,Q;for(a=64;a<=c;a+=64)r(i,o(u.subarray(a-64,a)));for(u=a-64<c?u.subarray(a-64):new Uint8Array(0),h=u.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<h;a+=1)l[a>>2]|=u[a]<<(a%4<<3);if(l[a>>2]|=128<<(a%4<<3),a>55)for(r(i,l),a=0;a<16;a+=1)l[a]=0;return z=c*8,z=z.toString(16).match(/(.*?)(.{0,8})$/),H=parseInt(z[2],16),Q=parseInt(z[1],16)||0,l[14]=H,l[15]=Q,r(i,l),i}function v(u){var c="",i;for(i=0;i<4;i+=1)c+=s[u>>i*8+4&15]+s[u>>i*8&15];return c}function m(u){var c;for(c=0;c<u.length;c+=1)u[c]=v(u[c]);return u.join("")}m(f("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function u(c,i){return c=c|0||0,c<0?Math.max(c+i,0):Math.min(c,i)}ArrayBuffer.prototype.slice=function(c,i){var a=this.byteLength,h=u(c,a),l=a,z,H,Q,ee;return i!==t&&(l=u(i,a)),h>l?new ArrayBuffer(0):(z=l-h,H=new ArrayBuffer(z),Q=new Uint8Array(H),ee=new Uint8Array(this,h,z),Q.set(ee),H)}}();function C(u){return/[\u0080-\uFFFF]/.test(u)&&(u=unescape(encodeURIComponent(u))),u}function b(u,c){var i=u.length,a=new ArrayBuffer(i),h=new Uint8Array(a),l;for(l=0;l<i;l+=1)h[l]=u.charCodeAt(l);return c?h:a}function A(u){return String.fromCharCode.apply(null,new Uint8Array(u))}function W(u,c,i){var a=new Uint8Array(u.byteLength+c.byteLength);return a.set(new Uint8Array(u)),a.set(new Uint8Array(c),u.byteLength),a}function O(u){var c=[],i=u.length,a;for(a=0;a<i-1;a+=2)c.push(parseInt(u.substr(a,2),16));return String.fromCharCode.apply(String,c)}function x(){this.reset()}return x.prototype.append=function(u){return this.appendBinary(C(u)),this},x.prototype.appendBinary=function(u){this._buff+=u,this._length+=u.length;var c=this._buff.length,i;for(i=64;i<=c;i+=64)r(this._hash,n(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},x.prototype.end=function(u){var c=this._buff,i=c.length,a,h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l;for(a=0;a<i;a+=1)h[a>>2]|=c.charCodeAt(a)<<(a%4<<3);return this._finish(h,i),l=m(this._hash),u&&(l=O(l)),this.reset(),l},x.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},x.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},x.prototype.setState=function(u){return this._buff=u.buff,this._length=u.length,this._hash=u.hash,this},x.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},x.prototype._finish=function(u,c){var i=c,a,h,l;if(u[i>>2]|=128<<(i%4<<3),i>55)for(r(this._hash,u),i=0;i<16;i+=1)u[i]=0;a=this._length*8,a=a.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(a[2],16),l=parseInt(a[1],16)||0,u[14]=h,u[15]=l,r(this._hash,u)},x.hash=function(u,c){return x.hashBinary(C(u),c)},x.hashBinary=function(u,c){var i=f(u),a=m(i);return c?O(a):a},x.ArrayBuffer=function(){this.reset()},x.ArrayBuffer.prototype.append=function(u){var c=W(this._buff.buffer,u),i=c.length,a;for(this._length+=u.byteLength,a=64;a<=i;a+=64)r(this._hash,o(c.subarray(a-64,a)));return this._buff=a-64<i?new Uint8Array(c.buffer.slice(a-64)):new Uint8Array(0),this},x.ArrayBuffer.prototype.end=function(u){var c=this._buff,i=c.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h,l;for(h=0;h<i;h+=1)a[h>>2]|=c[h]<<(h%4<<3);return this._finish(a,i),l=m(this._hash),u&&(l=O(l)),this.reset(),l},x.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},x.ArrayBuffer.prototype.getState=function(){var u=x.prototype.getState.call(this);return u.buff=A(u.buff),u},x.ArrayBuffer.prototype.setState=function(u){return u.buff=b(u.buff,!0),x.prototype.setState.call(this,u)},x.ArrayBuffer.prototype.destroy=x.prototype.destroy,x.ArrayBuffer.prototype._finish=x.prototype._finish,x.ArrayBuffer.hash=function(u,c){var i=p(new Uint8Array(u)),a=m(i);return c?O(a):a},x})}(Me)),Me.exports}var $s=Os();const Ls=It($s),J={CHUNK_SIZE:2*1024*1024,SIZE_UNITS:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],SIZE_MULTIPLIER:1024,TIME_UNITS:{MINUTE:60,HOUR:3600}};function Bs(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,d=>{const e=Math.random()*16|0;return(d==="x"?e:e&3|8).toString(16)})}function ke(d,e=2){if(d===0)return"0 B";if(d<0||!Number.isFinite(d))return"Invalid";const t=J.SIZE_MULTIPLIER,s=Math.max(0,e),r=Math.min(Math.floor(Math.log(d)/Math.log(t)),J.SIZE_UNITS.length-1),n=Math.max(0,r),o=d/Math.pow(t,n);return Number.isFinite(o)?`${o.toFixed(s)} ${J.SIZE_UNITS[r]}`:`${d} B`}function Hs(d,e=2){if(!Number.isFinite(d)||d<0||d===0)return"0 B/s";try{const t=ke(d,e);return t==="Invalid"?"0 B/s":`${t}/s`}catch(t){return console.error("Ê†ºÂºèÂåñÈÄüÂ∫¶Â§±Ë¥•:",t),"0 B/s"}}function Ws(d,e=!1){if(d<0)return"Invalid";if(d===0)return"0s";const t=Math.floor(d/J.TIME_UNITS.HOUR),s=Math.floor(d%J.TIME_UNITS.HOUR/J.TIME_UNITS.MINUTE),r=Math.floor(d%J.TIME_UNITS.MINUTE);if(e){const n=[];return t>0&&n.push(`${t} Â∞èÊó∂`),s>0&&n.push(`${s} ÂàÜÈíü`),r>0&&n.push(`${r} Áßí`),n.join(" ")||"0 Áßí"}return t>0?`${t}h ${s}m`:s>0?`${s}m ${r}s`:`${r}s`}const qe=d=>new Promise(e=>{setTimeout(e,d)});async function Ye(d,e){return new Promise((t,s)=>{const r=new Ls.ArrayBuffer,n=new FileReader,o=J.CHUNK_SIZE,f=Math.ceil(d.size/o);let p=0;const v=()=>{const m=p*o,C=Math.min(m+o,d.size);n.readAsArrayBuffer(d.slice(m,C))};n.onload=m=>{var C;try{const b=(C=m.target)==null?void 0:C.result;if(r.append(b),p++,e){const A=Math.round(p/f*100);e(A)}if(p<f)v();else{const A=r.end();t(A)}}catch(b){s(new Error(`MD5 ËÆ°ÁÆóÂ§±Ë¥•: ${b.message}`))}},n.onerror=()=>{s(new Error("Êñá‰ª∂ËØªÂèñÂ§±Ë¥•"))},v()})}class Xe{constructor(e=15,t=3e4){w(this,"dataPoints",[]);w(this,"windowSize");w(this,"windowTime");w(this,"smoothingFactor",.7);w(this,"lastSpeed",0);this.windowSize=e,this.windowTime=t}addData(e,t){if(!Number.isFinite(e)||e<0||!Number.isFinite(t)||t<=0){console.warn("Invalid data point:",{size:e,time:t});return}const s=Date.now();this.dataPoints.push({size:e,time:t,timestamp:s}),this.cleanup(s)}cleanup(e){const t=e-this.windowTime;this.dataPoints=this.dataPoints.filter(s=>s.timestamp>t),this.dataPoints.length>this.windowSize&&(this.dataPoints=this.dataPoints.slice(-this.windowSize))}getSpeed(){if(this.dataPoints.length===0)return 0;const e=this.dataPoints.slice(-Math.min(5,this.dataPoints.length));if(e.length===0)return 0;const t=e.reduce((n,o)=>n+o.size,0),s=e.reduce((n,o)=>n+o.time,0);if(s<=0||!Number.isFinite(s))return this.lastSpeed;const r=t/s*1e3;return!Number.isFinite(r)||r<0?(console.warn("Invalid instant speed calculated:",r),this.lastSpeed):(this.lastSpeed===0?this.lastSpeed=r:this.lastSpeed=this.smoothingFactor*r+(1-this.smoothingFactor)*this.lastSpeed,Math.max(0,Number.isFinite(this.lastSpeed)?this.lastSpeed:0))}getAverageSpeed(){if(this.dataPoints.length===0)return 0;const e=this.dataPoints.reduce((r,n)=>r+n.size,0),t=this.dataPoints.reduce((r,n)=>r+n.time,0);if(t<=0||!Number.isFinite(e)||!Number.isFinite(t))return 0;const s=e/t*1e3;return Number.isFinite(s)?Math.max(0,s):0}getSpeedInfo(){const e=this.getSpeed(),t=this.getAverageSpeed();return{current:e,average:t,formatted:{current:this.formatSpeedSafe(e),average:this.formatSpeedSafe(t)}}}formatSpeedSafe(e){if(!Number.isFinite(e)||e<0)return"0 B/s";const t=["B/s","KB/s","MB/s","GB/s","TB/s"],s=1024;if(e===0)return"0 B/s";const r=Math.min(Math.floor(Math.log(e)/Math.log(s)),t.length-1),n=e/Math.pow(s,Math.max(0,r));return Number.isFinite(n)?`${n.toFixed(2)} ${t[Math.max(0,r)]}`:"0 B/s"}reset(){this.dataPoints=[],this.lastSpeed=0}getStats(){return this.dataPoints.length===0?{dataPoints:0,oldestTimestamp:null,newestTimestamp:null,totalBytes:0,totalTime:0}:{dataPoints:this.dataPoints.length,oldestTimestamp:this.dataPoints[0].timestamp,newestTimestamp:this.dataPoints[this.dataPoints.length-1].timestamp,totalBytes:this.dataPoints.reduce((e,t)=>e+t.size,0),totalTime:this.dataPoints.reduce((e,t)=>e+t.time,0)}}}class ve{static calculateOptimalChunkSize(e,t,s){const{minChunkSize:r,maxChunkSize:n,chunkSize:o}=s;let f=o;return t>0&&(f=Math.round(t*1024*3)),e<10*1024*1024?f=Math.min(f,1*1024*1024):e>1024*1024*1024&&(f=Math.max(f,5*1024*1024)),Math.max(r,Math.min(n,f))}}const M={RETRY:{MAX_DELAY:3e4,CHUNK_MAX_DELAY:1e4,BASE_DELAY:1e3,BACKOFF_MULTIPLIER:1.5,MAX_RETRIES:3},NETWORK:{ADJUST_INTERVAL:1e4,POLL_INTERVAL:50,QUALITY_THRESHOLDS:{GOOD:1e3,FAIR:100}},PROGRESS:{CHUNK_WEIGHT:90,MERGE_START:92,MERGE_END:95,COMPLETE:100},CONCURRENT:{POOR_NETWORK:2,FAIR_NETWORK:4,GOOD_NETWORK:10,DEFAULT_FILES:10,DEFAULT_CHUNKS:10},RETRYABLE_ERROR_KEYWORDS:["networkerror","timeouterror","aborterror","fetch","network","timeout","5"],UPLOAD:{TIMEOUT:6e4,CHUNK_SIZE:2*1024*1024,MIN_CHUNK_SIZE:512*1024,MAX_CHUNK_SIZE:20*1024*1024,MAX_FILESIZE:1*1024*1024*1024,MAX_FILES:500},COMPRESSION:{ENABLE_COMPRESSION:!0,COMPRESSION_QUALITY:.8},PREVIEW:{ENABLE_PREVIEW:!0,PREVIEW_MAX_WIDTH:200,PREVIEW_MAX_HEIGHT:200}};class Gs{constructor(){w(this,"taskAbortControllers",new Map);w(this,"chunkAbortControllers",new Map);w(this,"isPaused",N(!1));w(this,"pausedTasks",new Set);w(this,"getTask",()=>{})}pause(e){const t=this.getTask(e);!t||t.status!==k.UPLOADING||(this.abortTask(e),t.status=k.PAUSED,t.pausedTime=Date.now(),this.pausedTasks.add(e),console.log(`‰ªªÂä° ${t.file.name} Â∑≤ÊöÇÂÅú`))}resume(e){const t=this.getTask(e);!t||t.status!==k.PAUSED||(this.createAbortController(e),t.status=k.PENDING,t.resumeTime=Date.now(),this.pausedTasks.delete(e),console.log(`‰ªªÂä° ${t.file.name} Â∑≤ÊÅ¢Â§ç`))}cancel(e){const t=this.getTask(e);t&&(this.abortTask(e),t.status=k.CANCELLED,t.endTime=Date.now(),this.pausedTasks.delete(e),console.log(`‰ªªÂä° ${t.file.name} Â∑≤ÂèñÊ∂à`))}pauseAll(){this.isPaused.value=!0,this.taskAbortControllers.forEach((e,t)=>{this.pause(t)})}resumeAll(){this.isPaused.value=!1,Array.from(this.pausedTasks).forEach(t=>{this.resume(t)})}cancelAll(){this.taskAbortControllers.forEach((e,t)=>{this.cancel(t)}),this.taskAbortControllers.clear(),this.chunkAbortControllers.clear(),this.pausedTasks.clear()}createAbortController(e){const t=new AbortController;return this.taskAbortControllers.set(e,t),t}createChunkAbortController(e,t){const s=new AbortController;return this.chunkAbortControllers.has(e)||this.chunkAbortControllers.set(e,new Map),this.chunkAbortControllers.get(e).set(t,s),s}getTaskAbortSignal(e){var t;return(t=this.taskAbortControllers.get(e))==null?void 0:t.signal}getChunkAbortSignal(e,t){var n;const s=this.taskAbortControllers.get(e),r=(n=this.chunkAbortControllers.get(e))==null?void 0:n.get(t);if(s&&r){const o=new AbortController,f=()=>o.abort();return s.signal.addEventListener("abort",f),r.signal.addEventListener("abort",f),o.signal}return(s==null?void 0:s.signal)||(r==null?void 0:r.signal)}abortTask(e){const t=this.taskAbortControllers.get(e);t&&(t.abort(),this.taskAbortControllers.delete(e));const s=this.chunkAbortControllers.get(e);s&&(s.forEach(r=>r.abort()),this.chunkAbortControllers.delete(e))}cleanupTask(e){this.taskAbortControllers.delete(e),this.chunkAbortControllers.delete(e),this.pausedTasks.delete(e)}shouldPause(e){return this.isPaused.value||this.pausedTasks.has(e)}setTaskGetter(e){this.getTask=e}}class Qs{static async compressImage(e,t=.8,s=1920,r=1080){return new Promise(n=>{const o=document.createElement("canvas"),f=o.getContext("2d"),p=new Image;p.onload=()=>{let{width:v,height:m}=p;if(v>s||m>r){const C=Math.min(s/v,r/m);v*=C,m*=C}o.width=v,o.height=m,f.drawImage(p,0,0,v,m),o.toBlob(C=>{const b=new File([C],e.name,{type:e.type,lastModified:Date.now()});n(b)},e.type,t)},p.src=URL.createObjectURL(e)})}}class js{constructor(e){this.config=e}validate(e,t=0){const s=[],r=[];console.log(`üìù ÂºÄÂßãÈ™åËØÅ ${e.length} ‰∏™Êñá‰ª∂ÔºåÂΩìÂâçÂ∑≤Êúâ ${t} ‰∏™Êñá‰ª∂`);for(const n of e){const o=t+s.length,f=this.validateSingleFile(n,o);f?(r.push({file:n,reason:f}),console.warn(`‚ùå Êñá‰ª∂ ${n.name} È™åËØÅÂ§±Ë¥•: ${f}`)):(s.push(n),console.log(`‚úÖ Êñá‰ª∂ ${n.name} È™åËØÅÈÄöËøá (${s.length}/${e.length})`))}return console.log(`üìä È™åËØÅÁªìÊûú: ÈÄöËøá ${s.length} ‰∏™ÔºåÂ§±Ë¥• ${r.length} ‰∏™`),{valid:s,errors:r}}validateSingleFile(e,t){var s;return e.size===0?"Êñá‰ª∂‰∏∫Á©∫":this.config.maxFileSize&&e.size>this.config.maxFileSize?`Êñá‰ª∂Â§ßÂ∞èË∂ÖÈôê: ${ke(e.size)} > ${ke(this.config.maxFileSize)}`:this.isAcceptedType(e)?this.config.maxFiles&&t>=this.config.maxFiles?`Â∑≤ËææÂà∞ÊúÄÂ§ßÊñá‰ª∂Êï∞ÈáèÈôêÂà∂: ${this.config.maxFiles} (ÂΩìÂâç: ${t})`:null:`Êñá‰ª∂Á±ªÂûã‰∏çÊîØÊåÅ„ÄÇÊîØÊåÅ: ${(s=this.config.accept)==null?void 0:s.join(", ")}`}isAcceptedType(e){var o,f;if(!((o=this.config.accept)!=null&&o.length))return!0;const t=(f=e.name.split(".").pop())==null?void 0:f.toLowerCase(),s=e.type.toLowerCase(),r=t&&this.config.accept.some(p=>p.toLowerCase()===`.${t}`||p.toLowerCase()===t),n=this.config.accept.some(p=>p.toLowerCase()===s||p.includes("/")&&s.startsWith(p.split("/")[0]));return r||n}}class Ks{constructor(e=1e3,t=30*60*1e3){w(this,"cache",new Map);w(this,"maxSize");w(this,"ttl");this.maxSize=e,this.ttl=t}set(e,t,s){if(this.cache.has(e)&&this.cache.delete(e),this.cache.size>=this.maxSize){const r=this.cache.keys().next().value;r!==void 0&&this.cache.delete(r)}this.cache.set(e,{value:t,timestamp:Date.now()+(s??this.ttl)})}get(e){const t=this.cache.get(e);return t?Date.now()>t.timestamp?(this.cache.delete(e),null):(this.cache.delete(e),this.cache.set(e,t),t.value):null}remove(e){return this.cache.delete(e)}removeMany(e){let t=0;return e.forEach(s=>{this.cache.delete(s)&&t++}),t}removeWhere(e){let t=0;const s=[];return this.cache.forEach((r,n)=>{e(n,r.value)&&s.push(n)}),s.forEach(r=>{this.cache.delete(r)&&t++}),t}has(e){return this.cache.has(e)}isValid(e){const t=this.cache.get(e);return t?Date.now()>t.timestamp?(this.cache.delete(e),!1):!0:!1}size(){return this.cache.size}keys(){return Array.from(this.cache.keys())}cleanup(){let e=0;const t=Date.now(),s=[];return this.cache.forEach((r,n)=>{t>r.timestamp&&s.push(n)}),s.forEach(r=>{this.cache.delete(r),e++}),e}touch(e,t){const s=this.cache.get(e);return s?(s.timestamp=Date.now()+(t??this.ttl),!0):!1}stats(){let e=null,t=null;return this.cache.forEach(s=>{const r=s.timestamp;(!e||r<e)&&(e=r),(!t||r>t)&&(t=r)}),{size:this.cache.size,maxSize:this.maxSize,hitRate:0,oldestTimestamp:e,newestTimestamp:t}}clear(){this.cache.clear()}export(){const e=[];return this.cache.forEach((t,s)=>{e.push([s,t.value,t.timestamp])}),e}import(e){for(this.clear(),e.forEach(([t,s,r])=>{r>Date.now()&&this.cache.set(t,{value:s,timestamp:r})});this.cache.size>this.maxSize;){const t=this.cache.keys().next().value;t!==void 0&&this.cache.delete(t)}}}class Vs{constructor(){w(this,"callbacks",{})}onFileStart(e){return this.callbacks.onFileStart=e,this}onFileProgress(e){return this.callbacks.onFileProgress=e,this}onFileSuccess(e){return this.callbacks.onFileSuccess=e,this}onFileError(e){return this.callbacks.onFileError=e,this}onFilePause(e){return this.callbacks.onFilePause=e,this}onFileResume(e){return this.callbacks.onFileResume=e,this}onFileCancel(e){return this.callbacks.onFileCancel=e,this}onTotalProgress(e){return this.callbacks.onTotalProgress=e,this}onAllComplete(e){return this.callbacks.onAllComplete=e,this}onAllError(e){return this.callbacks.onAllError=e,this}onSpeedChange(e){return this.callbacks.onSpeedChange=e,this}onQueueChange(e){return this.callbacks.onQueueChange=e,this}onChunkSuccess(e){return this.callbacks.onChunkSuccess=e,this}onChunkError(e){return this.callbacks.onChunkError=e,this}async emit(e,...t){const s=this.callbacks[e];s&&await s(...t)}getCallbacks(){return{...this.callbacks}}}class Zs{constructor(e,t){this.config=e,this.progressCallback=t}async createChunks(e,t){const s=Math.ceil(e.file.size/t),r=[];!e.fileMD5&&this.config.enableDeduplication&&(e.fileMD5=await Ye(e.file));for(let n=0;n<s;n++){const o=n*t,f=Math.min(o+t,e.file.size);r.push({index:n,start:o,end:f,size:f-o,blob:e.file.slice(o,f),status:D.PENDING,retryCount:0,uploadTime:0,etag:void 0,result:void 0,error:void 0,hash:void 0})}return e.chunks=r,e.totalChunks=s,e.uploadedChunks=0,r}async uploadChunk(e,t,s){const r=performance.now();try{t.status=D.UPLOADING;const n=this.config.chunkUploadTransformer({task:e,chunk:t,customParams:this.config.customParams}),o=n instanceof FormData,f={...this.config.headers,...o?{}:{"Content-Type":"application/json"}},p=await fetch(this.config.uploadChunkUrl,{method:"POST",headers:f,body:o?n:JSON.stringify(n),signal:s});if(!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);const v=await p.json();return t.status=D.SUCCESS,t.result=v,t.uploadTime=performance.now()-r,this.progressCallback(t,t.size,t.uploadTime),v}catch(n){throw t.status=D.ERROR,t.error=n,n}}async mergeChunks(e,t){const s=this.config.mergeChunksTransformer({task:e,customParams:this.config.customParams}),r=s instanceof FormData,n={...this.config.headers,...r?{}:{"Content-Type":"application/json"}},o=await fetch(this.config.mergeChunksUrl,{method:"POST",headers:n,body:r?s:JSON.stringify(s),signal:t});if(!o.ok)throw new Error(`ÂêàÂπ∂ÂàÜÂùóÂ§±Ë¥•: ${o.status} ${o.statusText}`);return await o.json()}calculateOptimalChunkSize(e,t){return ve.calculateOptimalChunkSize(e,t,this.config)}}class qs{constructor(){w(this,"history",[]);w(this,"maxHistory",10);w(this,"smoothingFactor",.3);w(this,"historyTimeout",6e4);w(this,"lastEstimatedTime",0)}update(e,t){if(!Number.isFinite(e)||e<=0)return 0;if(!Number.isFinite(t)||t<=0)return this.lastEstimatedTime>0?this.lastEstimatedTime:0;const s=e/1024/t,r=this.exponentialSmoothing(s),n=this.applyTrendCorrection(r),o=this.applyBounds(n);return this.recordHistory(o),this.lastEstimatedTime=o,Math.max(0,Math.round(o))}exponentialSmoothing(e){return this.lastEstimatedTime===0?e:this.smoothingFactor*e+(1-this.smoothingFactor)*this.lastEstimatedTime}applyTrendCorrection(e){if(this.history.length<3)return e;const t=this.history.slice(-3),s=[];for(let n=1;n<t.length;n++)s.push(t[n-1].time-t[n].time);const r=s.reduce((n,o)=>n+o,0)/s.length;return r>0&&r<10?e-Math.abs(r)*.1:e}applyBounds(e){if(this.lastEstimatedTime===0)return e;const t=this.lastEstimatedTime*1.3;if(e>t)return console.log(`‚ö†Ô∏è Êó∂Èó¥Ë∑≥Ë∑ÉËøáÂ§ßÔºåÈôêÂà∂Â¢ûÂä†: ${e.toFixed(1)}s -> ${t.toFixed(1)}s`),t;if(e>10){const s=this.lastEstimatedTime*.7;if(e<s)return console.log(`‚ö†Ô∏è Êó∂Èó¥‰∏ãÈôçËøáÂø´ÔºåÈôêÂà∂ÂáèÂ∞ë: ${e.toFixed(1)}s -> ${s.toFixed(1)}s`),s}return e}recordHistory(e){this.history.push({time:e,timestamp:Date.now()}),this.history.length>this.maxHistory&&this.history.shift();const t=Date.now()-this.historyTimeout;this.history=this.history.filter(s=>s.timestamp>t)}getTrend(){if(this.history.length<2)return"stable";const e=this.history.slice(-3),t=e[0].time,s=e[e.length-1].time,r=t-s;return r>5?"decreasing":r<-5?"increasing":"stable"}reset(){this.history=[],this.lastEstimatedTime=0}getLastEstimatedTime(){return this.lastEstimatedTime}getHistory(){return[...this.history]}}class Ys{constructor(){w(this,"speedCalculator");w(this,"timeEstimator");w(this,"totalProgress",N(0));w(this,"uploadSpeed",N(0));w(this,"networkQuality",N("good"));this.speedCalculator=new Xe,this.timeEstimator=new qs}updateFileProgress(e){if(e.totalChunks>0){const t=e.uploadedChunks/e.totalChunks*100;e.progress=Math.round(t),e.speed=this.uploadSpeed.value,e.chunks&&(e.uploadedSize=e.chunks.filter(s=>s.status===D.SUCCESS).reduce((s,r)=>s+r.size,0))}}updateChunkProgress(e,t,s){this.speedCalculator.addData(t,s);const r=this.speedCalculator.getSpeed();this.uploadSpeed.value=Number.isFinite(r)?r:0,this.updateNetworkQuality()}updateTotalProgress(e){if(e.length===0){this.totalProgress.value=0;return}const t=e.reduce((r,n)=>r+n.file.size,0),s=e.reduce((r,n)=>r+n.file.size*n.progress/100,0);this.totalProgress.value=Math.min(100,Math.round(s/t*100)||0)}calculateStats(e,t,s){const r=t.size,n=e.length,o=s.filter(u=>u.status===k.SUCCESS).length,f=s.filter(u=>u.status===k.ERROR).length,p=s.filter(u=>u.status===k.PAUSED).length,v=s.filter(u=>u.status===k.CANCELLED).length,m=r+n+o+f+p+v,C=[...e,...Array.from(t.values()),...s],b=C.reduce((u,c)=>u+c.file.size,0),A=C.reduce((u,c)=>u+c.file.size*c.progress/100,0),W=b-A,O=this.speedCalculator.getAverageSpeed(),x=this.timeEstimator.update(W,O);return{completed:o,active:r,pending:n,failed:f,paused:p,cancelled:v,total:m,totalSize:b,uploadedSize:A,averageSpeed:O,instantSpeed:this.uploadSpeed.value,estimatedTime:x,networkQuality:this.networkQuality.value}}updateNetworkQuality(){const e=this.uploadSpeed.value;e<50?this.networkQuality.value="poor":e<200?this.networkQuality.value="fair":this.networkQuality.value="good"}reset(){this.totalProgress.value=0,this.uploadSpeed.value=0,this.networkQuality.value="good",this.speedCalculator.reset(),this.timeEstimator.reset()}getAverageSpeed(){return this.speedCalculator.getAverageSpeed()}getTimeTrend(){return this.timeEstimator.getTrend()}}class Xs{constructor(e){this.config=e}shouldRetry(e,t){if(e.retryCount>=(e.options.maxRetries||this.config.maxRetries))return!1;const s=t.message.toLowerCase();return M.RETRYABLE_ERROR_KEYWORDS.some(r=>s.includes(r))}calculateDelay(e,t=!1){const s=t?M.RETRY.CHUNK_MAX_DELAY:M.RETRY.MAX_DELAY,r=M.RETRY.BASE_DELAY*Math.pow(M.RETRY.BACKOFF_MULTIPLIER,e);return Math.min(r,s)}resetTask(e){e.status=k.PENDING,e.error=null,e.chunks.forEach(t=>{t.status===D.ERROR&&(t.status=D.PENDING,t.retryCount=0,t.error=void 0)})}}class Js{constructor(){w(this,"priorities",{high:3,normal:2,low:1})}sort(e){e.sort((t,s)=>{const r=this.priorities[t.options.priority||"normal"],n=this.priorities[s.options.priority||"normal"];return r!==n?n-r:t.file.size-s.file.size})}isDuplicate(e,t){return t.some(s=>s.file.name===e.name&&s.file.size===e.size&&s.file.lastModified===e.lastModified)}createTask(e,t,s,r,n,o){return{id:Bs(),file:t,originalFile:e!==t?e:void 0,status:k.PENDING,progress:0,speed:0,chunks:[],uploadedChunks:0,totalChunks:0,retryCount:0,startTime:null,endTime:null,pausedTime:0,resumeTime:0,uploadedSize:0,result:null,error:null,fileMD5:"",options:{maxRetries:r.maxRetries,chunkSize:ve.calculateOptimalChunkSize(t.size,n,r),priority:"normal",customParams:{},metadata:{preview:o,originalSize:e.size,compressedSize:t.size,compressionRatio:e.size>0?t.size/e.size:1},...s}}}}const Ae={TIMEOUT:3e4,DEFAULT_CHUNK_SIZE:2*1024*1024};class er{static generate(){return`
      ${this.getMD5Function()}
      ${this.getImageCompressionFunction()}
      ${this.getFileSlicingFunction()}
      ${this.getBatchProcessFunction()}
      ${this.getMessageHandler()}
    `}static getMD5Function(){return`
      // MD5 ËÆ°ÁÆó - ‰ΩøÁî® Web Crypto API
      async function calculateMD5(buffer) {
        try {
          // ‰ΩøÁî® SHA-256 (MD5 Âú®Áé∞‰ª£ÊµèËßàÂô®‰∏≠‰∏çÊé®ËçêÔºå‰ΩÜÂèØ‰ª•Áî®ÂÖ∂‰ªñÂìàÂ∏å)
          const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        } catch (error) {
          // ÈôçÁ∫ßÂà∞ÁÆÄÂçïÂìàÂ∏å
          let hash = 0;
          const view = new Uint8Array(buffer);
          for (let i = 0; i < view.length; i++) {
            hash = ((hash << 5) - hash + view[i]) & 0xffffffff;
          }
          return Math.abs(hash).toString(16).padStart(8, '0');
        }
      }
    `}static getImageCompressionFunction(){return`
      // ÂõæÁâáÂéãÁº©
      async function compressImage(imageData, options = {}) {
        try {
          const canvas = new OffscreenCanvas(
            options.width || 800, 
            options.height || 600
          );
          const ctx = canvas.getContext('2d');
          
          if (!ctx) {
            throw new Error('Êó†Ê≥ïËé∑Âèñ Canvas ‰∏ä‰∏ãÊñá');
          }
          
          const bitmap = await createImageBitmap(imageData);
          ctx.drawImage(bitmap, 0, 0, canvas.width, canvas.height);
          
          return await canvas.convertToBlob({ 
            type: options.type || 'image/jpeg', 
            quality: options.quality || 0.8 
          });
        } catch (error) {
          throw new Error('ÂõæÁâáÂéãÁº©Â§±Ë¥•: ' + error.message);
        }
      }
    `}static getFileSlicingFunction(){return`
      // Êñá‰ª∂ÂàáÁâá
      function sliceFile(file, chunkSize) {
        const chunks = [];
        const totalChunks = Math.ceil(file.size / chunkSize);
        
        for (let i = 0; i < totalChunks; i++) {
          const start = i * chunkSize;
          const end = Math.min(start + chunkSize, file.size);
          
          chunks.push({
            index: i,
            start,
            end,
            size: end - start
          });
        }
        
        return chunks;
      }
    `}static getBatchProcessFunction(){return`
      // ÊâπÈáèÂ§ÑÁêÜÊñá‰ª∂
      async function batchProcess(files, options) {
        const results = [];
        const total = files.length;
        
        for (let i = 0; i < total; i++) {
          try {
            const file = files[i];
            const result = { 
              file: file.name, 
              size: file.size 
            };

            // ËÆ°ÁÆó MD5
            if (options.calculateMD5) {
              const buffer = await file.arrayBuffer();
              result.md5 = await calculateMD5(buffer);
            }

            // ÁîüÊàêÂàáÁâá‰ø°ÊÅØ
            if (options.generateChunks) {
              const chunkSize = options.chunkSize || 2097152; // 2MB
              result.chunks = sliceFile(file, chunkSize);
              result.totalChunks = result.chunks.length;
            }

            results.push(result);
            
            // ÂèëÈÄÅËøõÂ∫¶
            self.postMessage({
              id: options.messageId,
              type: 'PROGRESS',
              success: true,
              progress: Math.round(((i + 1) / total) * 100)
            });

          } catch (error) {
            results.push({ 
              file: files[i].name, 
              error: error.message 
            });
          }
        }
        
        return results;
      }
    `}static getMessageHandler(){return`
      // Ê∂àÊÅØÂ§ÑÁêÜÂô®
      self.onmessage = async function(event) {
        const { id, type, payload } = event.data;
        
        try {
          let result;
          
          switch (type) {
            case 'MD5_CALCULATE': {
              const buffer = await payload.file.arrayBuffer();
              result = await calculateMD5(buffer);
              break;
            }
              
            case 'COMPRESS_IMAGE':
              result = await compressImage(payload.imageData, payload.options);
              break;
              
            case 'SLICE_FILE':
              result = sliceFile(payload.file, payload.chunkSize);
              break;
              
            case 'BATCH_PROCESS':
              result = await batchProcess(payload.files, { 
                ...payload.options, 
                messageId: id 
              });
              break;
              
            default:
              throw new Error('Êú™Áü•ÁöÑÊ∂àÊÅØÁ±ªÂûã: ' + type);
          }

          self.postMessage({
            id,
            type,
            success: true,
            data: result
          });

        } catch (error) {
          self.postMessage({
            id,
            type,
            success: false,
            error: error.message
          });
        }
      };
      
      // ÈîôËØØÂ§ÑÁêÜ
      self.onerror = function(error) {
        console.error('Worker ÂÜÖÈÉ®ÈîôËØØ:', error);
      };
    `}}class tr{constructor(e){w(this,"worker",null);w(this,"messageHandlers",new Map);w(this,"progressHandlers",new Map);w(this,"messageId",0);w(this,"isInitialized",!1);this.initWorker(e)}initWorker(e){try{if(e)this.worker=new Worker(e);else{const t=new Blob([er.generate()],{type:"application/javascript"}),s=URL.createObjectURL(t);this.worker=new Worker(s),URL.revokeObjectURL(s)}this.setupWorkerHandlers(),this.isInitialized=!0}catch(t){console.warn("Worker ÂàùÂßãÂåñÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®‰∏ªÁ∫øÁ®ãÊ®°Âºè:",t),this.worker=null,this.isInitialized=!1}}setupWorkerHandlers(){this.worker&&(this.worker.onmessage=e=>{const t=e.data;if(t.type==="PROGRESS"){const r=this.progressHandlers.get(t.id);r&&t.progress!==void 0&&r(t.progress);return}const s=this.messageHandlers.get(t.id);s&&(s(t),this.cleanupHandlers(t.id))},this.worker.onerror=e=>{console.error("Worker ÈîôËØØ:",e),this.handleWorkerError(e)})}cleanupHandlers(e){this.messageHandlers.delete(e),this.progressHandlers.delete(e)}handleWorkerError(e){this.messageHandlers.forEach((t,s)=>{t({id:s,type:"MD5_CALCULATE",success:!1,error:e.message||"Worker ÂèëÁîüÈîôËØØ"})}),this.messageHandlers.clear(),this.progressHandlers.clear()}sendMessage(e,t,s){return new Promise((r,n)=>{const o=(++this.messageId).toString();if(!this.worker||!this.isInitialized){this.fallbackToMainThread(e,t,s).then(r).catch(n);return}const f=setTimeout(()=>{this.cleanupHandlers(o),n(new Error(`Worker ÂìçÂ∫îË∂ÖÊó∂ (${Ae.TIMEOUT}ms)`))},Ae.TIMEOUT);s&&this.progressHandlers.set(o,s),this.messageHandlers.set(o,p=>{clearTimeout(f),p.success?r(p.data):n(new Error(p.error||"Worker Â§ÑÁêÜÂ§±Ë¥•"))});try{this.worker.postMessage({id:o,type:e,payload:t})}catch(p){clearTimeout(f),this.cleanupHandlers(o),n(new Error(`ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•: ${p.message}`))}})}async fallbackToMainThread(e,t,s){switch(e){case"MD5_CALCULATE":return await this.calculateMD5InMainThread(t.file);case"SLICE_FILE":return this.sliceFileInMainThread(t.file,t.chunkSize);case"BATCH_PROCESS":return await this.batchProcessInMainThread(t.files,t.options,s);case"COMPRESS_IMAGE":throw new Error("‰∏ªÁ∫øÁ®ã‰∏çÊîØÊåÅÂõæÁâáÂéãÁº©ÔºåËØ∑‰ΩøÁî® Worker Ê®°Âºè");default:throw new Error(`‰∏çÊîØÊåÅÁöÑÊìç‰ΩúÁ±ªÂûã: ${e}`)}}async calculateMD5InMainThread(e){try{return await Ye(e)}catch(t){throw new Error(`MD5 ËÆ°ÁÆóÂ§±Ë¥•: ${t.message}`)}}sliceFileInMainThread(e,t){const s=[],r=Math.ceil(e.size/t);for(let n=0;n<r;n++){const o=n*t,f=Math.min(o+t,e.size);s.push({index:n,start:o,end:f,size:f-o})}return s}async batchProcessInMainThread(e,t,s){const r=[],n=e.length;for(let o=0;o<n;o++)try{const f=e[o],p={file:f.name,size:f.size};if(t.calculateMD5&&(p.md5=await this.calculateMD5InMainThread(f)),t.generateChunks){const v=t.chunkSize||Ae.DEFAULT_CHUNK_SIZE;p.chunks=this.sliceFileInMainThread(f,v),p.totalChunks=p.chunks.length}r.push(p),s&&s(Math.round((o+1)/n*100))}catch(f){r.push({file:e[o].name,error:f.message})}return r}async calculateMD5(e){return this.sendMessage("MD5_CALCULATE",{file:e})}async compressImage(e,t){return this.sendMessage("COMPRESS_IMAGE",{imageData:e,options:t})}async sliceFile(e,t){return this.sendMessage("SLICE_FILE",{file:e,chunkSize:t})}async batchProcess(e,t={}){return this.sendMessage("BATCH_PROCESS",{files:e,options:t},t.onProgress)}isAvailable(){return this.worker!==null&&this.isInitialized}getWorkerStatus(){return{available:this.isAvailable(),pendingMessages:this.messageHandlers.size,activeProgressTrackers:this.progressHandlers.size}}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.messageHandlers.clear(),this.progressHandlers.clear(),this.isInitialized=!1}reinitialize(e){this.terminate(),this.initWorker(e)}}class sr{constructor(e){w(this,"speedHistory",[]);w(this,"maxHistorySize",10);w(this,"currentNetworkInfo",{type:"unknown",downlink:10,rtt:100,effectiveType:"4g",saveData:!1});w(this,"adaptiveConfig");this.config=e,this.adaptiveConfig={chunkSize:e.chunkSize,maxConcurrentFiles:e.maxConcurrentFiles,maxConcurrentChunks:e.maxConcurrentChunks,retryDelay:e.retryDelay,timeout:e.timeout,lastUpdate:Date.now()},this.initNetworkListener()}initNetworkListener(){if(!("connection"in navigator))return;const e=navigator.connection;e&&(this.updateNetworkInfo(e),e.addEventListener("change",()=>{this.updateNetworkInfo(e),this.recalculateAdaptiveConfig()}))}updateNetworkInfo(e){this.currentNetworkInfo={type:e.type||"unknown",downlink:e.downlink||10,rtt:e.rtt||100,effectiveType:e.effectiveType||"4g",saveData:e.saveData||!1}}adaptToConnection(e){this.updateNetworkInfo(e),this.recalculateAdaptiveConfig(),this.config.maxConcurrentFiles=this.adaptiveConfig.maxConcurrentFiles,this.config.maxConcurrentChunks=this.adaptiveConfig.maxConcurrentChunks,this.config.chunkSize=this.adaptiveConfig.chunkSize}recalculateAdaptiveConfig(){const{effectiveType:e,downlink:t,rtt:s,saveData:r}=this.currentNetworkInfo,n={"slow-2g":{files:1,chunks:2,chunkSize:256*1024,retryDelay:5e3,timeout:6e4,maxConcurrentFiles:10,maxConcurrentChunks:10},"2g":{files:1,chunks:2,chunkSize:512*1024,retryDelay:3e3,timeout:45e3,maxConcurrentFiles:10,maxConcurrentChunks:10},"3g":{files:2,chunks:4,chunkSize:1024*1024,retryDelay:2e3,timeout:3e4,maxConcurrentFiles:10,maxConcurrentChunks:10},"4g":{files:3,chunks:6,chunkSize:2*1024*1024,retryDelay:1e3,timeout:2e4,maxConcurrentFiles:10,maxConcurrentChunks:10},"5g":{files:4,chunks:8,chunkSize:4*1024*1024,retryDelay:500,timeout:15e3,maxConcurrentFiles:10,maxConcurrentChunks:10}};let o=n[e]||n["4g"];if(t<1?(o.files=Math.max(1,o.files-1),o.chunks=Math.max(2,o.chunks-2),o.chunkSize=Math.max(256*1024,o.chunkSize/2)):t>10&&(o.files=Math.min(6,o.files+1),o.chunks=Math.min(12,o.chunks+2),o.chunkSize=Math.min(8*1024*1024,o.chunkSize*2)),s>300?(o.chunks=Math.max(2,o.chunks-1),o.timeout=o.timeout*1.5):s<50&&(o.chunks=Math.min(12,o.chunks+1)),r&&(o.files=1,o.chunks=Math.min(2,o.chunks),o.chunkSize=Math.min(512*1024,o.chunkSize)),this.speedHistory.length>0){const f=this.getAverageSpeed();f<100?(o.chunkSize=Math.min(512*1024,o.chunkSize),o.chunks=Math.min(3,o.chunks)):f>1e3&&(o.chunkSize=Math.min(8*1024*1024,o.chunkSize*1.5),o.chunks=Math.min(10,o.chunks+1))}o.files=Math.min(o.files,this.config.maxConcurrentFiles),o.chunks=Math.min(o.chunks,this.config.maxConcurrentChunks),o.chunkSize=Math.max(this.config.minChunkSize||M.UPLOAD.MIN_CHUNK_SIZE,Math.min(this.config.maxChunkSize||M.UPLOAD.MAX_CHUNK_SIZE,o.chunkSize)),this.adaptiveConfig={...o,lastUpdate:Date.now()}}getAdaptiveConfig(){Date.now()-this.adaptiveConfig.lastUpdate>5e3&&this.recalculateAdaptiveConfig();const e=this.evaluateNetworkQuality(),t=this.getRecommendedStrategy(e);return{...this.adaptiveConfig,networkQuality:e,recommendedStrategy:t}}evaluateNetworkQuality(){const{effectiveType:e,downlink:t,rtt:s}=this.currentNetworkInfo,r=this.getAverageSpeed();let n=0;return n+=({"slow-2g":0,"2g":1,"3g":2,"4g":3,"5g":4}[e]||3)*2,t>10?n+=3:t>5?n+=2:t>1&&(n+=1),s<100?n+=2:s<200&&(n+=1),r>500?n+=3:r>200?n+=2:r>100&&(n+=1),n>=10?"good":n>=5?"fair":"poor"}getRecommendedStrategy(e){return{good:"È´òÂπ∂ÂèëÂ§ßÂàÜÁâáÁ≠ñÁï•ÔºöÂª∫ËÆÆ‰ΩøÁî®ËæÉÂ§ßÂàÜÁâá(2-4MB)ÔºåÂ§öÂπ∂Âèë‰∏ä‰º†",fair:"ÂùáË°°Á≠ñÁï•ÔºöÂª∫ËÆÆ‰ΩøÁî®‰∏≠Á≠âÂàÜÁâá(1MB)ÔºåÈÄÇÂ∫¶Âπ∂Âèë",poor:"‰øùÂÆàÁ≠ñÁï•ÔºöÂª∫ËÆÆ‰ΩøÁî®Â∞èÂàÜÁâá(256-512KB)Ôºå‰ΩéÂπ∂ÂèëÔºåÂêØÁî®Êñ≠ÁÇπÁª≠‰º†"}[e]}getNetworkQuality(e){return this.addSpeedToHistory(e),e>M.NETWORK.QUALITY_THRESHOLDS.GOOD?"good":e>M.NETWORK.QUALITY_THRESHOLDS.FAIR?"fair":"poor"}addSpeedToHistory(e){this.speedHistory.push(e),this.speedHistory.length>this.maxHistorySize&&this.speedHistory.shift()}getAverageSpeed(){return this.speedHistory.length===0?0:this.speedHistory.reduce((t,s)=>t+s,0)/this.speedHistory.length}getConcurrentChunks(e){const t={poor:M.CONCURRENT.POOR_NETWORK,fair:M.CONCURRENT.FAIR_NETWORK,good:M.CONCURRENT.GOOD_NETWORK};return Math.min(this.adaptiveConfig.maxConcurrentChunks,t[e])}updateSpeed(e){this.addSpeedToHistory(e);const t=this.getAverageSpeed();Math.abs(e-t)/t>.5&&this.recalculateAdaptiveConfig()}getNetworkSummary(){const e=this.evaluateNetworkQuality();return{type:this.currentNetworkInfo.effectiveType,quality:e,downlink:this.currentNetworkInfo.downlink,rtt:this.currentNetworkInfo.rtt,averageSpeed:this.getAverageSpeed(),recommendation:this.getRecommendedStrategy(e)}}triggerAdaptation(){if("connection"in navigator){const e=navigator.connection;this.adaptToConnection(e)}}updateConfig(e){this.config=e,this.recalculateAdaptiveConfig()}reset(){this.speedHistory=[],this.adaptiveConfig.lastUpdate=0,this.recalculateAdaptiveConfig()}}class _e{static async generateImagePreview(e,t=200,s=200){return new Promise((r,n)=>{const o=new FileReader;o.onload=f=>{var v;const p=new Image;p.onload=()=>{try{const m=document.createElement("canvas"),C=m.getContext("2d");if(!C){n(new Error("Êó†Ê≥ïËé∑Âèñ Canvas ‰∏ä‰∏ãÊñá"));return}const b=Math.min(t/p.width,s/p.height,1);m.width=p.width*b,m.height=p.height*b,C.drawImage(p,0,0,m.width,m.height);const A=m.toDataURL("image/jpeg",.8);r(A)}catch(m){n(m)}},p.onerror=()=>{n(new Error("ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•"))},p.src=(v=f.target)==null?void 0:v.result},o.onerror=()=>{n(new Error("Êñá‰ª∂ËØªÂèñÂ§±Ë¥•"))},o.readAsDataURL(e)})}static async generateVideoPreview(e,t=200,s=200,r=1){return new Promise((n,o)=>{const f=document.createElement("video"),p=URL.createObjectURL(e);f.preload="metadata",f.muted=!0,f.playsInline=!0;const v=()=>{URL.revokeObjectURL(p),f.remove()},m=setTimeout(()=>{v(),o(new Error("ËßÜÈ¢ëÈ¢ÑËßàÁîüÊàêË∂ÖÊó∂"))},1e4);f.onloadedmetadata=()=>{f.currentTime=Math.min(r,f.duration)},f.onseeked=()=>{try{clearTimeout(m);const C=document.createElement("canvas"),b=C.getContext("2d");if(!b){v(),o(new Error("Êó†Ê≥ïËé∑Âèñ Canvas ‰∏ä‰∏ãÊñá"));return}const A=Math.min(t/f.videoWidth,s/f.videoHeight,1);C.width=f.videoWidth*A,C.height=f.videoHeight*A,b.drawImage(f,0,0,C.width,C.height);const W=C.toDataURL("image/jpeg",.8);v(),n(W)}catch(C){v(),o(C)}},f.onerror=()=>{clearTimeout(m),v(),o(new Error("ËßÜÈ¢ëÂä†ËΩΩÂ§±Ë¥•"))},f.src=p})}static async batchGenerate(e,t=200,s=200){const r=e.map(async n=>{try{return n.type.startsWith("image/")?await this.generateImagePreview(n,t,s):n.type.startsWith("video/")?await this.generateVideoPreview(n,t,s):null}catch(o){return console.warn(`ÁîüÊàêÈ¢ÑËßàÂ§±Ë¥•: ${n.name}`,o),null}});return Promise.all(r)}static getFileIcon(e){var n;const t=e.type.toLowerCase();(n=e.name.split(".").pop())!=null&&n.toLowerCase();const s={"application/pdf":"üìÑ","application/msword":"üìù","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"üìù","application/vnd.ms-excel":"üìä","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"üìä","application/zip":"üóúÔ∏è","application/x-rar-compressed":"üóúÔ∏è","application/x-7z-compressed":"üóúÔ∏è",audio:"üéµ",default:"üìé"};if(s[t])return s[t];const r=t.split("/")[0];return s[r]?s[r]:s.default}static canGeneratePreview(e){return e.type.startsWith("image/")||e.type.startsWith("video/")}}class rr{constructor(e){w(this,"permits");w(this,"queue",[]);this.permits=e}async acquire(){return new Promise(e=>{this.permits>0?(this.permits--,e()):this.queue.push(e)})}release(){this.permits++;const e=this.queue.shift();e&&(this.permits--,e())}}class nr{constructor(e,t,s,r,n,o,f,p){w(this,"uploadPromise");w(this,"completed",!1);w(this,"aborted",!1);w(this,"isPausing",!1);this.task=e,this.config=t,this.chunkManager=s,this.cacheManager=r,this.retryStrategy=n,this.callbackManager=o,this.progressManager=f,this.uploadController=p}async start(){return this.uploadPromise=this.upload(),this.uploadPromise}async wait(){this.uploadPromise&&await this.uploadPromise}isCompleted(){return this.completed}isAborted(){return this.aborted}async upload(){try{if(this.checkIfShouldStop())return;if(this.initializeUpload(),await this.checkDeduplication()){this.handleSuccess();return}if(this.checkIfShouldStop())return;if(await this.createChunks(),await this.uploadChunks(),this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ‰ªªÂä° ${this.task.file.name} Âú®‰∏ä‰º†ÂàÜÁâáÂêéÂ§Ñ‰∫é${this.task.status}Áä∂ÊÄÅ`);return}const t=await this.mergeChunks();this.task.result=t,this.checkIfShouldStop()||this.handleSuccess()}catch(e){if(this.isAbortError(e)){console.log(`üõë ‰ªªÂä° ${this.task.file.name} Ë¢´‰∏≠Ê≠¢`),this.aborted=!0;return}await this.handleError(e)}finally{this.completed=!0,this.progressManager.updateFileProgress(this.task),this.cleanup()}}initializeUpload(){this.task.status=k.UPLOADING,this.task.startTime=Date.now(),this.callbackManager.emit("onFileStart",this.task)}checkIfShouldStop(){const e=this.task.status;return e===k.PAUSED||this.uploadController.shouldPause(this.task.id)?(e!==k.PAUSED&&this.markAsPaused(),!0):e===k.CANCELLED}markAsPaused(){this.task.status=k.PAUSED,this.task.pausedTime=Date.now(),this.isPausing=!0,this.config.enableResume&&this.config.enableCache&&this.saveProgress()}isAbortError(e){var t;return(e==null?void 0:e.name)==="AbortError"||(e==null?void 0:e.code)==="ABORT_ERR"||((t=e==null?void 0:e.message)==null?void 0:t.includes("aborted"))}async checkDeduplication(){if(!this.config.enableDeduplication||!this.config.checkFileUrl)return!1;const e=this.getCacheKey();if(this.config.enableCache&&this.cacheManager.get(e)==="uploaded")return console.log(`‚úÖ Êñá‰ª∂ ${this.task.file.name} ÂëΩ‰∏≠Êú¨Âú∞ÁºìÂ≠ò,Ë∑≥Ëøá‰∏ä‰º†`),!0;try{const t=this.config.checkFileTransformer({task:this.task,customParams:this.config.customParams}),s=this.uploadController.getTaskAbortSignal(this.task.id);if(!s)return console.warn("‚ö†Ô∏è Êó†Ê≥ïËé∑Âèñ AbortSignal,Ë∑≥ËøáÁßí‰º†Ê£ÄÊü•"),!1;const r=await fetch(this.config.checkFileUrl,{method:"POST",headers:this.getHeaders(t),body:this.getRequestBody(t),signal:s});if(!r.ok)return console.warn(`‚ö†Ô∏è Áßí‰º†Ê£ÄÊü•Â§±Ë¥•: ${r.status}`),!1;const n=await r.json();if((n==null?void 0:n.exists)===!0||(n==null?void 0:n.uploaded)===!0)return console.log(`‚úÖ Êñá‰ª∂ ${this.task.file.name} Â∑≤Â≠òÂú®‰∫éÊúçÂä°Á´Ø,ÂêØÁî®Áßí‰º†`),this.config.enableCache&&this.cacheManager.set(e,"uploaded"),n.fileInfo&&(this.task.result=n.fileInfo),!0}catch(t){this.isAbortError(t)||console.warn("‚ö†Ô∏è Áßí‰º†Ê£ÄÊü•Â§±Ë¥•:",t)}return!1}getCacheKey(){return`file_${this.task.file.name}_${this.task.file.size}_${this.task.file.lastModified}`}async createChunks(){if(this.task.chunks&&this.task.chunks.length>0){console.log(`‚ÑπÔ∏è ‰ªªÂä° ${this.task.file.name} Â∑≤Êúâ${this.task.chunks.length}‰∏™ÂàÜÁâá,Ë∑≥ËøáÂàõÂª∫`);return}const e=this.config.enableNetworkAdaptation?this.chunkManager.calculateOptimalChunkSize(this.task.file.size,this.progressManager.getAverageSpeed()):this.task.options.chunkSize||this.config.chunkSize;await this.chunkManager.createChunks(this.task,e),console.log(`üì¶ ‰ªªÂä° ${this.task.file.name} ÂàõÂª∫‰∫Ü ${this.task.totalChunks} ‰∏™ÂàÜÁâá,ÊØèÁâá${(e/1024/1024).toFixed(2)}MB`)}async uploadChunks(){const e=this.config.maxConcurrentChunks,t=new rr(e),s=[];console.log(`üöÄ ÂºÄÂßã‰∏ä‰º† ${this.task.chunks.length} ‰∏™ÂàÜÁâá,Âπ∂ÂèëÊï∞: ${e}`);for(let f=0;f<this.task.chunks.length;f++){const p=this.task.chunks[f];if(this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ‰ªªÂä° ${this.task.file.name} ÂÅúÊ≠¢ÂàõÂª∫Êñ∞ÁöÑÂàÜÁâá‰∏ä‰º†‰ªªÂä°`);break}if(p.status===D.SUCCESS){console.log(`‚úì ÂàÜÁâá ${p.index} Â∑≤‰∏ä‰º†ÊàêÂäü,Ë∑≥Ëøá`);continue}const v=this.uploadSingleChunk(p,t);s.push(v)}console.log(`‚è≥ Á≠âÂæÖ ${s.length} ‰∏™ÂàÜÁâá‰∏ä‰º†‰ªªÂä°ÂÆåÊàê...`),await Promise.allSettled(s);const r=this.task.chunks.filter(f=>f.status===D.SUCCESS).length,n=this.task.chunks.filter(f=>f.status===D.PENDING).length,o=this.task.chunks.filter(f=>f.status===D.ERROR).length;console.log(`üìä ÂàÜÁâá‰∏ä‰º†ÁªìÊûú: ÊàêÂäü${r}/${this.task.totalChunks}, ÂæÖ‰∏ä‰º†${n}, Â§±Ë¥•${o}`),this.isPausing&&this.config.enableResume&&this.config.enableCache&&(this.saveProgress(),console.log(`üíæ ‰ªªÂä° ${this.task.file.name} ËøõÂ∫¶Â∑≤‰øùÂ≠ò`))}async uploadSingleChunk(e,t){await t.acquire();try{if(this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ÂàÜÁâá ${e.index} ‰∏çÂºÄÂßã‰∏ä‰º†,‰ªªÂä°Â∑≤ÂÅúÊ≠¢`);return}const s=this.task.options.maxRetries||this.config.maxRetries;let r=null;for(let n=0;n<=s;n++)try{if(this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ÂàÜÁâá ${e.index} Âú®Á¨¨${n+1}Ê¨°Â∞ùËØïÂâçÊ£ÄÊµãÂà∞‰ªªÂä°ÊöÇÂÅú`),e.status!==D.SUCCESS&&(e.status=D.PENDING);return}const f=this.uploadController.createChunkAbortController(this.task.id,e.index).signal;console.log(`‚¨ÜÔ∏è ÂºÄÂßã‰∏ä‰º†ÂàÜÁâá ${e.index}/${this.task.totalChunks} (Â∞ùËØï ${n+1}/${s+1})`),await this.chunkManager.uploadChunk(this.task,e,f),this.task.uploadedChunks++,this.progressManager.updateFileProgress(this.task),await this.callbackManager.emit("onFileProgress",this.task),await this.callbackManager.emit("onChunkSuccess",this.task,e),console.log(`‚úÖ ÂàÜÁâá ${e.index} ‰∏ä‰º†ÊàêÂäü (${this.task.uploadedChunks}/${this.task.totalChunks})`);return}catch(o){if(r=o,this.isAbortError(o)){console.log(`üõë ÂàÜÁâá ${e.index} ‰∏ä‰º†Ë¢´‰∏≠Ê≠¢`),e.status!==D.SUCCESS&&(e.status=D.PENDING);return}if(e.error=o,console.error(`‚ùå ÂàÜÁâá ${e.index} ‰∏ä‰º†Â§±Ë¥• (Â∞ùËØï ${n+1}/${s+1}):`,o.message),n<s&&this.retryStrategy.shouldRetry(this.task,o)){const f=this.retryStrategy.calculateDelay(n,!0);if(console.log(`üîÑ ÂàÜÁâá ${e.index} Â∞ÜÂú® ${f}ms ÂêéÈáçËØï`),e.status=D.RETRYING,await qe(f),this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ÂàÜÁâá ${e.index} ÈáçËØïÂâçÊ£ÄÊµãÂà∞‰ªªÂä°ÊöÇÂÅú`),e.status=D.PENDING;return}continue}throw e.status=D.ERROR,await this.callbackManager.emit("onChunkError",this.task,e,o),o}if(r)throw r}finally{t.release()}}async mergeChunks(){console.log(`üîó ÂºÄÂßãÂêàÂπ∂ ${this.task.totalChunks} ‰∏™ÂàÜÁâá...`);const e=this.task.progress,t=Math.max(e,M.PROGRESS.MERGE_START);this.task.progress<t&&(this.task.progress=t,await this.callbackManager.emit("onFileProgress",this.task),console.log(`üìä ÂêàÂπ∂Èò∂ÊÆµÂºÄÂßã: ${this.task.progress.toFixed(2)}%`));const s=this.uploadController.getTaskAbortSignal(this.task.id);if(!s)throw new Error("Êó†Ê≥ïÂàõÂª∫ AbortSignal");try{const r=Math.max(this.task.progress,M.PROGRESS.MERGE_START+(M.PROGRESS.MERGE_END-M.PROGRESS.MERGE_START)*.4);this.task.progress<r&&(this.task.progress=r,await this.callbackManager.emit("onFileProgress",this.task),console.log(`üìä ÂêàÂπ∂ËØ∑Ê±Ç‰∏≠: ${this.task.progress.toFixed(2)}%`));const n=await this.chunkManager.mergeChunks(this.task,s),o=Math.max(this.task.progress,M.PROGRESS.MERGE_END);return this.task.progress<o&&(this.task.progress=o,await this.callbackManager.emit("onFileProgress",this.task),console.log(`üìä ÂêàÂπ∂Âç≥Â∞ÜÂÆåÊàê: ${this.task.progress.toFixed(2)}%`)),console.log("‚úÖ ÂàÜÁâáÂêàÂπ∂ÊàêÂäü"),n}catch(r){throw this.isAbortError(r)?new Error("ÂêàÂπ∂Êìç‰ΩúË¢´‰∏≠Ê≠¢"):(console.error("‚ùå ÂàÜÁâáÂêàÂπ∂Â§±Ë¥•:",r),r)}}handleSuccess(){this.task.progress=M.PROGRESS.COMPLETE||100,this.task.status=k.SUCCESS,this.task.endTime=Date.now();const e=this.task.endTime-(this.task.startTime||this.task.endTime),t=(this.task.file.size/1024/1024).toFixed(2),s=e>0?(this.task.file.size/1024/(e/1e3)).toFixed(2):"0";console.log(`‚úÖ ‰ªªÂä° ${this.task.file.name} ‰∏ä‰º†ÊàêÂäü (100%)`),console.log(`   - Êñá‰ª∂Â§ßÂ∞è: ${t}MB`),console.log(`   - ÊÄªËÄóÊó∂: ${(e/1e3).toFixed(2)}s`),console.log(`   - Âπ≥ÂùáÈÄüÂ∫¶: ${s}KB/s`),this.config.enableCache&&this.cacheManager.remove(`progress_${this.task.id}`),this.callbackManager.emit("onFileSuccess",this.task)}async handleError(e){this.task.status===k.UPLOADING&&(this.task.status=k.ERROR,this.task.error=e,this.task.endTime=Date.now(),console.error(`‚ùå ‰ªªÂä° ${this.task.file.name} ‰∏ä‰º†Â§±Ë¥•:`,e.message),await this.callbackManager.emit("onFileError",this.task,e))}saveProgress(){const e=`progress_${this.task.id}`,t={taskId:this.task.id,fileName:this.task.file.name,fileSize:this.task.file.size,uploadedChunks:this.task.uploadedChunks,totalChunks:this.task.totalChunks,uploadedSize:this.task.uploadedSize,progress:this.task.progress,status:this.task.status,pausedTime:this.task.pausedTime,chunks:this.task.chunks.map(s=>({index:s.index,start:s.start,end:s.end,size:s.size,status:s.status,etag:s.etag,hash:s.hash}))};this.cacheManager.set(e,t),console.log(`üíæ ‰øùÂ≠ò‰ªªÂä° ${this.task.file.name} ÁöÑËøõÂ∫¶: ${this.task.uploadedChunks}/${this.task.totalChunks} ‰∏™ÂàÜÁâá`)}cleanup(){this.uploadController.cleanupTask(this.task.id)}getHeaders(e){const t=e instanceof FormData;return{...this.config.headers,...t?{}:{"Content-Type":"application/json"}}}getRequestBody(e){return e instanceof FormData?e:JSON.stringify(e)}}const ir=({task:d,chunk:e,customParams:t={}})=>{const s=new FormData;return s.append("file",e.blob,d.file.name),s.append("chunkIndex",String(e.index)),s.append("chunkSize",String(e.size)),s.append("totalChunks",String(d.totalChunks)),s.append("fileMD5",d.fileMD5),s.append("fileName",d.file.name),s.append("fileSize",String(d.file.size)),s.append("taskId",d.id),Object.entries(t).forEach(([r,n])=>{s.append(r,String(n))}),s},ar=({task:d,customParams:e={}})=>({fileMD5:d.fileMD5,fileName:d.file.name,fileSize:d.file.size,totalChunks:d.totalChunks,taskId:d.id,...e}),or=({task:d,customParams:e={}})=>({fileMD5:d.fileMD5,fileName:d.file.name,fileSize:d.file.size,...e});class lr{constructor(e={}){w(this,"config");w(this,"callbackManager");w(this,"uploadController");w(this,"progressManager");w(this,"chunkManager");w(this,"cacheManager");w(this,"networkAdapter");w(this,"fileValidator");w(this,"taskQueueManager");w(this,"retryStrategy");w(this,"workerManager");w(this,"uploadQueue",N([]));w(this,"activeUploads",N(new Map));w(this,"completedUploads",N([]));w(this,"isUploading",N(!1));w(this,"isAddingFiles",N(!1));w(this,"addFilesPromise");w(this,"addFilesAbortController");w(this,"totalProgress",G(()=>this.progressManager.totalProgress.value));w(this,"uploadSpeed",G(()=>this.progressManager.uploadSpeed.value));w(this,"networkQuality",G(()=>this.progressManager.networkQuality.value));w(this,"isPaused",G(()=>this.uploadController.isPaused.value));w(this,"uploadStats",G(()=>this.progressManager.calculateStats(this.uploadQueue.value,this.activeUploads.value,this.completedUploads.value)));w(this,"speedCalculator",new Xe);w(this,"adaptiveConfig",{lastAdjustTime:0,adjustInterval:M.NETWORK.ADJUST_INTERVAL});this.config=this.mergeConfig(e),this.cacheManager=new Ks,this.callbackManager=new Vs,this.progressManager=new Ys,this.uploadController=new Gs,this.networkAdapter=new sr(this.config),this.fileValidator=new js(this.config),this.taskQueueManager=new Js,this.retryStrategy=new Xs(this.config),this.chunkManager=new Zs(this.config,(t,s,r)=>this.progressManager.updateChunkProgress(t,s,r)),this.config.useWorker&&(this.workerManager=new tr),this.setupWatchers(),this.setupNetworkMonitoring()}mergeConfig(e){return{maxConcurrentFiles:M.CONCURRENT.DEFAULT_FILES,maxConcurrentChunks:M.CONCURRENT.DEFAULT_CHUNKS,chunkSize:M.UPLOAD.CHUNK_SIZE,minChunkSize:M.UPLOAD.MIN_CHUNK_SIZE,maxChunkSize:M.UPLOAD.MAX_CHUNK_SIZE,maxRetries:M.RETRY.MAX_RETRIES,retryDelay:M.RETRY.BASE_DELAY,retryBackoff:M.RETRY.BACKOFF_MULTIPLIER,uploadChunkUrl:"",mergeChunksUrl:"",checkFileUrl:"",headers:{},timeout:M.UPLOAD.TIMEOUT,customParams:{},maxFileSize:M.UPLOAD.MAX_FILESIZE,maxFiles:M.UPLOAD.MAX_FILES,enableResume:!0,enableDeduplication:!1,useWorker:!0,enableCache:!0,enableNetworkAdaptation:!0,enableSmartRetry:!0,enableCompression:M.COMPRESSION.ENABLE_COMPRESSION,compressionQuality:M.COMPRESSION.COMPRESSION_QUALITY,enablePreview:M.PREVIEW.ENABLE_PREVIEW,previewMaxWidth:M.PREVIEW.PREVIEW_MAX_WIDTH,previewMaxHeight:M.PREVIEW.PREVIEW_MAX_HEIGHT,chunkUploadTransformer:ir,mergeChunksTransformer:ar,checkFileTransformer:or,...e}}updateConfig(e){return this.config={...this.config,...e},console.log("üìù ÈÖçÁΩÆÂ∑≤Êõ¥Êñ∞",this.config),"enableNetworkAdaptation"in e&&this.setupNetworkMonitoring(),this}setChunkUploadTransformer(e){return this.config.chunkUploadTransformer=e,this}setMergeChunksTransformer(e){return this.config.mergeChunksTransformer=e,this}setCheckFileTransformer(e){return this.config.checkFileTransformer=e,this}setTransformers(e){return e.chunkUpload&&(this.config.chunkUploadTransformer=e.chunkUpload),e.mergeChunks&&(this.config.mergeChunksTransformer=e.mergeChunks),e.checkFile&&(this.config.checkFileTransformer=e.checkFile),this}setupWatchers(){le([this.uploadQueue,this.activeUploads,this.completedUploads],()=>{this.callbackManager.emit("onQueueChange",this.uploadStats.value),this.progressManager.updateTotalProgress(this.getAllTasks()),this.config.enableNetworkAdaptation&&this.adjustPerformance()},{deep:!0}),le(this.uploadSpeed,e=>{this.callbackManager.emit("onSpeedChange",e)}),le(this.totalProgress,e=>{this.callbackManager.emit("onTotalProgress",e,this.uploadStats.value)})}setupNetworkMonitoring(){if(!this.config.enableNetworkAdaptation||!("connection"in navigator))return;const e=navigator.connection,t=()=>this.networkAdapter.adaptToConnection(e);e==null||e.addEventListener("change",t),t()}adjustPerformance(){if(!this.config.enableNetworkAdaptation)return;const e=Date.now();if(e-this.adaptiveConfig.lastAdjustTime<this.adaptiveConfig.adjustInterval)return;this.adaptiveConfig.lastAdjustTime=e;const t=this.uploadSpeed.value,s=this.activeUploads.value.size;t<50&&s>1?(this.config.maxConcurrentFiles=Math.max(1,this.config.maxConcurrentFiles-1),this.config.maxConcurrentChunks=Math.max(2,this.config.maxConcurrentChunks-1),console.log(`üìâ ÁΩëÁªúÈÄüÂ∫¶ÊÖ¢,Ë∞ÉÊï¥Âπ∂ÂèëÊï∞: Êñá‰ª∂=${this.config.maxConcurrentFiles}, ÂàÜÁâá=${this.config.maxConcurrentChunks}`)):t>500&&s===this.config.maxConcurrentFiles&&(this.config.maxConcurrentFiles=Math.min(6,this.config.maxConcurrentFiles+1),this.config.maxConcurrentChunks=Math.min(12,this.config.maxConcurrentChunks+1),console.log(`üìà ÁΩëÁªúÈÄüÂ∫¶Âø´,Ë∞ÉÊï¥Âπ∂ÂèëÊï∞: Êñá‰ª∂=${this.config.maxConcurrentFiles}, ÂàÜÁâá=${this.config.maxConcurrentChunks}`));const r=this.networkAdapter.getAdaptiveConfig();r.chunkSize&&(this.config.chunkSize=r.chunkSize)}async addFiles(e,t={}){if(this.isAddingFiles.value&&this.addFilesAbortController&&(console.log("‚ö†Ô∏è Ê≠£Âú®Ê∑ªÂä†Êñá‰ª∂ÔºåÂèñÊ∂à‰πãÂâçÁöÑÊìç‰Ωú"),this.addFilesAbortController.abort(),this.addFilesPromise))try{await this.addFilesPromise}catch{}this.isAddingFiles.value=!0,this.addFilesAbortController=new AbortController,this.addFilesPromise=this.doAddFiles(e,t,this.addFilesAbortController.signal);try{await this.addFilesPromise}finally{this.isAddingFiles.value=!1,this.addFilesAbortController=void 0,this.addFilesPromise=void 0}return this}async doAddFiles(e,t,s){const r=this.normalizeFiles(e),n=this.uploadQueue.value.length+this.activeUploads.value.size,{valid:o}=this.fileValidator.validate(r,n);if(o.length===0){console.log("‚ö†Ô∏è Ê≤°ÊúâÊúâÊïàÊñá‰ª∂");return}console.log(`üìÅ ÂºÄÂßãÂ§ÑÁêÜ ${o.length} ‰∏™Êñá‰ª∂...`);try{if(await this.batchAddFiles(o,t,s),s!=null&&s.aborted){console.log("‚ö†Ô∏è Êñá‰ª∂Ê∑ªÂä†Ë¢´‰∏≠Êñ≠");return}this.taskQueueManager.sort(this.uploadQueue.value),console.log(`‚úÖ Êñá‰ª∂Â§ÑÁêÜÂÆåÊàêÔºåÂÖ± ${o.length} ‰∏™Êñá‰ª∂`)}catch(f){if(s!=null&&s.aborted)console.log("‚ö†Ô∏è Êñá‰ª∂Ê∑ªÂä†Ë¢´ÂèñÊ∂à");else throw console.error("‚ùå Êñá‰ª∂Ê∑ªÂä†Â§±Ë¥•:",f),f}}async createSingleTask(e,t){try{const s=await this.processFileOptimized(e),r=this.taskQueueManager.createTask(e,s,t,this.config,this.speedCalculator.getAverageSpeed());return this.config.enablePreview&&this.generatePreviewAsync(s).then(n=>{}).catch(()=>{}),r}catch(s){return console.error(`ÂàõÂª∫‰ªªÂä°Â§±Ë¥•: ${e.name}`,s),null}}async batchAddFiles(e,t,s){this.config.useWorker&&this.workerManager&&e.length>20?await this.batchAddFilesWithWorker(e,t,s):await this.batchAddFilesInMainThread(e,t,s,10,10)}async batchAddFilesInMainThread(e,t,s,r=10,n=10){const o=[],f=Date.now();for(let v=0;v<e.length;v+=r){if(s!=null&&s.aborted){console.log("‚ö†Ô∏è Êñá‰ª∂Ê∑ªÂä†Ë¢´ÂèñÊ∂à");break}const m=e.slice(v,v+r),C=[];if(await Promise.all(m.map(async b=>{if(!(s!=null&&s.aborted)){if(this.isFileDuplicate(b)){console.warn(`‚ö†Ô∏è Êñá‰ª∂Â∑≤Â≠òÂú®: ${b.name}`);return}try{const A=await this.createSingleTask(b,t);A&&C.push(A)}catch(A){console.error(`Â§ÑÁêÜÊñá‰ª∂Â§±Ë¥•: ${b.name}`,A)}}})),o.push(...C),o.length>=50||v+r>=e.length){this.uploadQueue.value.push(...o),o.length=0;const b=Math.min(v+r,e.length);console.log(`üìä Â∑≤Â§ÑÁêÜ ${b}/${e.length} ‰∏™Êñá‰ª∂`)}v+r<e.length&&await this.yieldToMain(n)}o.length>0&&this.uploadQueue.value.push(...o);const p=Date.now()-f;console.log(`‚è±Ô∏è Êñá‰ª∂Â§ÑÁêÜËÄóÊó∂: ${(p/1e3).toFixed(2)}s`)}async generatePreviewAsync(e){if(!(!this.config.enablePreview||!_e.canGeneratePreview(e)))return new Promise(t=>{const s=async()=>{try{if(e.type.startsWith("image/")){const r=await _e.generateImagePreview(e);t(r)}else if(e.type.startsWith("video/")){const r=await _e.generateVideoPreview(e);t(r)}else t(void 0)}catch(r){console.warn("‚ö†Ô∏è ÁîüÊàêÈ¢ÑËßàÂ§±Ë¥•:",r),t(void 0)}};"requestIdleCallback"in window?requestIdleCallback(s):setTimeout(s,100)})}yieldToMain(e=0){return new Promise(t=>{"requestIdleCallback"in window&&e===0?requestIdleCallback(()=>t()):setTimeout(t,e)})}async batchAddFilesWithWorker(e,t,s){const n=[];try{for(let o=0;o<e.length;o+=50){if(s!=null&&s.aborted){console.log("‚ö†Ô∏è Êñá‰ª∂Ê∑ªÂä†Ë¢´ÂèñÊ∂à");break}const f=e.slice(o,o+50),p=await this.workerManager.batchProcess(f,{calculateMD5:this.config.enableDeduplication,generateChunks:!1,onProgress:m=>{m%20===0&&console.log(`üì¶ ÊâπÊ¨° ${Math.floor(o/50)+1} Â§ÑÁêÜËøõÂ∫¶: ${m}%`)}}),v=await this.createTasksBatch(f,p,t,s);n.push(...v),(n.length>=100||o+50>=e.length)&&(this.uploadQueue.value.push(...n),n.length=0),await this.yieldToMain()}n.length>0&&this.uploadQueue.value.push(...n)}catch(o){console.error("‚ö†Ô∏è Worker ÊâπÂ§ÑÁêÜÂ§±Ë¥•:",o);const f=e.slice(n.length);f.length>0&&await this.batchAddFilesInMainThread(f,t,s,10,10)}}async createTasksBatch(e,t,s,r){const n=[];for(let o=0;o<e.length&&!(r!=null&&r.aborted);o++){const f=e[o],p=t[o];if(p.error){console.warn(`‚ö†Ô∏è Êñá‰ª∂Â§ÑÁêÜÂ§±Ë¥•: ${f.name}`,p.error);continue}if(this.isFileDuplicate(f)){console.warn(`‚ö†Ô∏è Êñá‰ª∂Â∑≤Â≠òÂú®: ${f.name}`);continue}const v=await this.processFileOptimized(f),m=this.taskQueueManager.createTask(f,v,s,this.config,this.speedCalculator.getAverageSpeed(),void 0);p.md5&&(m.options.metadata={...m.options.metadata,md5:p.md5}),n.push(m)}return n}isFileDuplicate(e){const t=`${e.name}_${e.size}_${e.lastModified}`;return this.getAllTasks().some(s=>`${s.file.name}_${s.file.size}_${s.file.lastModified}`===t)}async processFileOptimized(e){if(e.size<1024*1024||!e.type.startsWith("image/")||!this.config.enableCompression||e.size<10*1024*1024)return e;try{return await Qs.compressImage(e,this.config.compressionQuality,this.config.previewMaxWidth,this.config.previewMaxHeight)}catch(t){return console.warn("‚ö†Ô∏è Êñá‰ª∂ÂéãÁº©Â§±Ë¥•:",t),e}}normalizeFiles(e){if(e instanceof File)return[e];if(e instanceof FileList)return Array.from(e);if(Array.isArray(e))return e;throw new Error("‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûã")}async start(){if(this.uploadQueue.value.length===0&&this.activeUploads.value.size===0)return await this.callbackManager.emit("onAllComplete",[]),this;this.isUploading.value=!0,this.speedCalculator.reset();try{await this.processQueue(),await this.handleUploadComplete()}catch(e){await this.callbackManager.emit("onAllError",e)}finally{this.isUploading.value=!1}return this}async processQueue(){const e=[];for(;this.uploadQueue.value.length>0||this.activeUploads.value.size>0;){if(this.uploadController.isPaused.value){console.log("‚è∏Ô∏è Ê£ÄÊµãÂà∞ÊöÇÂÅú‰ø°Âè∑,Á≠âÂæÖÊâÄÊúâÊ¥ªË∑É‰ªªÂä°ÂÆåÊàê..."),await Promise.allSettled(e.map(t=>t.wait())),console.log("‚úÖ ÊâÄÊúâÊ¥ªË∑É‰ªªÂä°Â∑≤ÂÆåÊàê,ÊöÇÂÅúÁîüÊïà");return}for(;this.uploadQueue.value.length>0&&this.activeUploads.value.size<this.config.maxConcurrentFiles&&!this.uploadController.isPaused.value;){const t=this.uploadQueue.value.shift();console.log(`üöÄ ÂêØÂä®‰ªªÂä°: ${t.file.name} (${(t.file.size/1024/1024).toFixed(2)}MB)`),this.uploadController.createAbortController(t.id);const s=new nr(t,{...this.config,getOptimalChunkSize:r=>this.config.enableNetworkAdaptation?ve.calculateOptimalChunkSize(r,this.speedCalculator.getAverageSpeed(),this.config):t.options.chunkSize||this.config.chunkSize,workerManager:this.workerManager,getNetworkConfig:()=>this.networkAdapter.getAdaptiveConfig()},this.chunkManager,this.cacheManager,this.retryStrategy,this.callbackManager,this.progressManager,this.uploadController);this.activeUploads.value.set(t.id,t),e.push(s),s.start().then(()=>{this.activeUploads.value.delete(t.id),this.completedUploads.value.some(r=>r.id===t.id)||this.completedUploads.value.push(t),this.uploadController.cleanupTask(t.id)})}if(this.activeUploads.value.size>0){const t=e.filter(s=>!s.isCompleted());t.length>0&&await Promise.race(t.map(s=>s.wait()))}await qe(M.NETWORK.POLL_INTERVAL)}console.log("‚è≥ Á≠âÂæÖÊâÄÊúâ‰ªªÂä°ÂÆåÊàê..."),await Promise.allSettled(e.map(t=>t.wait())),console.log("‚úÖ ÊâÄÊúâ‰ªªÂä°Â∑≤ÂÆåÊàê")}async handleUploadComplete(){const e=this.completedUploads.value,t=e.filter(n=>n.status===k.SUCCESS),s=e.filter(n=>n.status===k.ERROR),r=e.filter(n=>n.status===k.PAUSED);console.log(`üìä ‰∏ä‰º†ÁªüËÆ°: ÊàêÂäü${t.length}, Â§±Ë¥•${s.length}, ÊöÇÂÅú${r.length}`),s.length>0?await this.callbackManager.emit("onAllError",new Error(`${s.length}/${e.length} ‰∏™Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•`)):r.length===0&&await this.callbackManager.emit("onAllComplete",t)}pause(e){const t=this.getTask(e);return t?(console.log(`‚è∏Ô∏è ÊöÇÂÅú‰ªªÂä°: ${t.file.name}`),this.uploadController.pause(e),t.status===k.UPLOADING&&(t.status=k.PAUSED,t.pausedTime=Date.now(),this.config.enableResume&&this.config.enableCache&&(this.saveTaskProgress(t),console.log(`üíæ Â∑≤‰øùÂ≠ò‰ªªÂä°ËøõÂ∫¶: ${t.file.name} (${t.uploadedChunks}/${t.totalChunks})`)),this.callbackManager.emit("onFilePause",t)),this):(console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${e}`),this)}resume(e){const t=this.getTask(e);if(!t)return console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${e}`),this;if(t.status!==k.PAUSED)return console.warn(`‚ö†Ô∏è ‰ªªÂä° ${t.file.name} ‰∏çÊòØÊöÇÂÅúÁä∂ÊÄÅ,Êó†Ê≥ïÊÅ¢Â§ç`),this;console.log(`‚ñ∂Ô∏è ÊÅ¢Â§ç‰ªªÂä°: ${t.file.name}`),this.config.enableResume&&this.config.enableCache&&(this.restoreTaskProgress(t),console.log(`üìÇ ÊÅ¢Â§ç‰ªªÂä°ËøõÂ∫¶: ${t.file.name} (${t.uploadedChunks}/${t.totalChunks})`)),this.uploadController.resume(e),t.status=k.PENDING;const s=t.pausedTime?Date.now()-t.pausedTime:0;return t.pausedTime=0,console.log(`‚ÑπÔ∏è ‰ªªÂä° ${t.file.name} Â∑≤ÊöÇÂÅú ${(s/1e3).toFixed(2)}s`),this.completedUploads.value=this.completedUploads.value.filter(r=>r.id!==e),!this.uploadQueue.value.some(r=>r.id===e)&&!this.activeUploads.value.has(e)&&this.uploadQueue.value.unshift(t),this.callbackManager.emit("onFileResume",t),this.isUploading.value||this.start(),this}async pauseAll(){if(console.log("‚è∏Ô∏è ÂáÜÂ§áÊöÇÂÅúÊâÄÊúâ‰∏ä‰º†"),this.isAddingFiles.value&&(console.log("‚ö†Ô∏è Ê≠£Âú®Ê∑ªÂä†Êñá‰ª∂ÔºåÂÖà‰∏≠Êñ≠Ê∑ªÂä†Êìç‰Ωú"),this.addFilesAbortController&&this.addFilesAbortController.abort(),this.addFilesPromise))try{await Promise.race([this.addFilesPromise,new Promise(e=>setTimeout(e,1e3))])}catch{}return this.uploadController.pauseAll(),await this.batchPauseTasks(),console.log("‚úÖ ÊâÄÊúâ‰∏ä‰º†Â∑≤ÊöÇÂÅú"),this}async batchPauseTasks(){const e=[],t=[],s=[...Array.from(this.activeUploads.value.values()),...this.uploadQueue.value],r=[];s.forEach(o=>{(o.status===k.UPLOADING||o.status===k.PENDING)&&r.push(()=>{o.status=k.PAUSED,o.pausedTime=Date.now(),e.push(o),this.config.enableResume&&this.config.enableCache&&t.push(o)})});const n=50;for(let o=0;o<r.length;o+=n)r.slice(o,o+n).forEach(p=>p()),o+n<r.length&&await this.yieldToMain(0);t.length>0&&this.batchSaveTaskProgress(t).catch(console.error),e.length>0&&this.batchEmitCallbacks("onFilePause",e).catch(console.error)}async batchEmitCallbacks(e,t){for(let r=0;r<t.length;r+=20){const n=t.slice(r,r+20);await new Promise(o=>{const f=()=>{n.forEach(p=>{switch(e){case"onFilePause":this.callbackManager.emit("onFilePause",p);break;case"onFileResume":this.callbackManager.emit("onFileResume",p);break;case"onFileCancel":this.callbackManager.emit("onFileCancel",p);break;case"onFileStart":this.callbackManager.emit("onFileStart",p);break;case"onFileSuccess":this.callbackManager.emit("onFileSuccess",p);break;case"onFileError":this.callbackManager.emit("onFileError",p,p.error||new Error("Unknown error"));break;default:console.warn(`Unknown event: ${e}`)}}),o()};"requestIdleCallback"in window?requestIdleCallback(f):setTimeout(f,0)})}}async batchSaveTaskProgress(e){for(let s=0;s<e.length;s+=10){const r=e.slice(s,s+10);await new Promise(n=>{const o=()=>{r.forEach(f=>this.saveTaskProgress(f)),n()};"requestIdleCallback"in window?requestIdleCallback(o):setTimeout(o,0)})}}resumeAll(){console.log("‚ñ∂Ô∏è ÊÅ¢Â§çÊâÄÊúâ‰∏ä‰º†");const e=[],t=this.completedUploads.value.filter(o=>o.status===k.PAUSED);e.push(...t);const s=this.uploadQueue.value.filter(o=>o.status===k.PAUSED);if(e.push(...s),this.activeUploads.value.forEach(o=>{o.status===k.PAUSED&&e.push(o)}),e.length===0)return console.log("‚ö†Ô∏è Ê≤°ÊúâÊöÇÂÅúÁöÑ‰ªªÂä°"),this;console.log(`üìã ÊâæÂà∞ ${e.length} ‰∏™ÊöÇÂÅúÁöÑ‰ªªÂä°`);const r=[];this.config.enableResume&&this.config.enableCache&&e.forEach(o=>{r.push(o)}),r.length>0&&this.batchRestoreTaskProgress(r);const n=[];return e.forEach(o=>{o.status=k.PENDING,o.pausedTime=0,this.uploadController.resume(o.id),n.push(o)}),this.reorganizeTasks(n),this.uploadController.resumeAll(),Promise.resolve().then(()=>{n.forEach(o=>{this.callbackManager.emit("onFileResume",o)})}),this.isUploading.value||this.start(),console.log(`‚úÖ Â∑≤ÊÅ¢Â§ç ${n.length} ‰∏™‰ªªÂä°`),this}async batchRestoreTaskProgress(e){for(let s=0;s<e.length;s+=10){const r=e.slice(s,s+10);await new Promise(n=>{const o=()=>{r.forEach(f=>this.restoreTaskProgress(f)),n()};"requestIdleCallback"in window?requestIdleCallback(o):setTimeout(o,0)})}}reorganizeTasks(e){const t=new Set(e.map(n=>n.id));this.completedUploads.value=this.completedUploads.value.filter(n=>!t.has(n.id)||n.status!==k.PENDING);const s=new Set(this.uploadQueue.value.map(n=>n.id)),r=new Set(this.activeUploads.value.keys());e.forEach(n=>{!s.has(n.id)&&!r.has(n.id)&&this.uploadQueue.value.push(n)}),this.taskQueueManager.sort(this.uploadQueue.value)}cancel(e){const t=this.getTask(e);return t?(console.log(`üõë ÂèñÊ∂à‰ªªÂä°: ${t.file.name}`),this.uploadController.cancel(e),t.status=k.CANCELLED,t.endTime=Date.now(),this.removeFile(e),this.callbackManager.emit("onFileCancel",t),this):(console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${e}`),this)}async cancelAll(){if(console.log("üõë ÂèñÊ∂àÊâÄÊúâ‰∏ä‰º†"),this.isAddingFiles.value&&this.addFilesAbortController&&(this.addFilesAbortController.abort(),this.addFilesPromise))try{await Promise.race([this.addFilesPromise,new Promise(r=>setTimeout(r,500))])}catch{}this.uploadController.cancelAll();const e=this.getAllTasks(),t=[];e.forEach(r=>{t.push(()=>{r.status=k.CANCELLED,r.endTime=Date.now()})});const s=100;for(let r=0;r<t.length;r+=s)t.slice(r,r+s).forEach(o=>o()),r+s<t.length&&await this.yieldToMain(0);return this.uploadQueue.value=[],this.activeUploads.value.clear(),this.isUploading.value=!1,this.batchEmitCallbacks("onFileCancel",e).catch(console.error),console.log("‚úÖ ÊâÄÊúâ‰ªªÂä°Â∑≤ÂèñÊ∂à"),this}clear(){return this.cancelAll(),this.completedUploads.value=[],this.progressManager.reset(),this.config.enableCache&&this.cacheManager.clear(),console.log("üóëÔ∏è Â∑≤Ê∏ÖÁ©∫ÊâÄÊúâ‰ªªÂä°"),this}removeFile(e){const t=this.uploadQueue.value.findIndex(r=>r.id===e);t>-1&&this.uploadQueue.value.splice(t,1),this.activeUploads.value.has(e)&&this.activeUploads.value.delete(e);const s=this.completedUploads.value.findIndex(r=>r.id===e);return s>-1&&this.completedUploads.value.splice(s,1),this.uploadController.cleanupTask(e),this}retrySingleFile(e){const t=this.completedUploads.value.findIndex(r=>r.id===e&&r.status===k.ERROR);if(t===-1)return console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞Â§±Ë¥•ÁöÑ‰ªªÂä°: ${e}`),this;const s=this.completedUploads.value[t];return console.log(`üîÑ ÈáçËØï‰ªªÂä°: ${s.file.name}`),this.resetTaskForRetry(s),this.completedUploads.value.splice(t,1),this.uploadQueue.value.some(r=>r.id===e)||(this.uploadQueue.value.unshift(s),this.taskQueueManager.sort(this.uploadQueue.value)),this.isUploading.value||this.start(),this}retryFailed(){const e=this.completedUploads.value.filter(t=>t.status===k.ERROR);return e.length===0?(console.log("‚ÑπÔ∏è Ê≤°ÊúâÂ§±Ë¥•ÁöÑ‰ªªÂä°ÈúÄË¶ÅÈáçËØï"),this):(console.log(`üîÑ ÈáçËØï ${e.length} ‰∏™Â§±Ë¥•ÁöÑ‰ªªÂä°`),e.forEach(t=>{this.resetTaskForRetry(t),this.uploadQueue.value.push(t)}),this.completedUploads.value=this.completedUploads.value.filter(t=>t.status!==k.PENDING),this.taskQueueManager.sort(this.uploadQueue.value),!this.isUploading.value&&this.uploadQueue.value.length>0&&this.start(),this)}resetTaskForRetry(e){this.retryStrategy.resetTask(e),e.progress=0,e.startTime=null,e.endTime=null,e.uploadedChunks=0,e.speed=0,this.config.enableNetworkAdaptation&&(e.options.chunkSize=ve.calculateOptimalChunkSize(e.file.size,this.speedCalculator.getAverageSpeed(),this.config),console.log(`‚ÑπÔ∏è ‰ªªÂä° ${e.file.name} ÈáçÊñ∞ËÆ°ÁÆóÂàÜÁâáÂ§ßÂ∞è: ${(e.options.chunkSize/1024/1024).toFixed(2)}MB`)),e.chunks&&e.chunks.forEach(t=>{(t.status!==D.SUCCESS||!this.config.enableResume)&&(t.status=D.PENDING,t.retryCount=0,t.error=void 0,t.uploadTime=0)}),e.options.priority="high"}saveTaskProgress(e){var r;const t=`progress_${e.id}`,s={taskId:e.id,fileName:e.file.name,fileSize:e.file.size,uploadedChunks:e.uploadedChunks,totalChunks:e.totalChunks,uploadedSize:e.uploadedSize,progress:e.progress,status:e.status,pausedTime:e.pausedTime,chunks:((r=e.chunks)==null?void 0:r.map(n=>({index:n.index,start:n.start,end:n.end,size:n.size,status:n.status,etag:n.etag,hash:n.hash})))||[]};this.cacheManager.set(t,s),console.log(`üíæ Â∑≤‰øùÂ≠ò‰ªªÂä°ËøõÂ∫¶: ${e.file.name} (${e.uploadedChunks}/${e.totalChunks})`)}restoreTaskProgress(e){const t=`progress_${e.id}`,s=this.cacheManager.get(t);if(!s){console.log(`‚ÑπÔ∏è Êú™ÊâæÂà∞‰ªªÂä° ${e.file.name} ÁöÑÁºìÂ≠òËøõÂ∫¶`);return}e.uploadedChunks=s.uploadedChunks||0,e.uploadedSize=s.uploadedSize||0,e.progress=s.progress||0,s.chunks&&e.chunks&&s.chunks.forEach(r=>{const n=e.chunks.find(o=>o.index===r.index);n&&(n.status=r.status,n.etag=r.etag,n.hash=r.hash)}),console.log(`üìÇ Â∑≤ÊÅ¢Â§ç‰ªªÂä°ËøõÂ∫¶: ${e.file.name} (${e.uploadedChunks}/${e.totalChunks})`)}getTask(e){return this.uploadQueue.value.find(t=>t.id===e)||this.activeUploads.value.get(e)||this.completedUploads.value.find(t=>t.id===e)}getAllTasks(){return[...this.uploadQueue.value,...Array.from(this.activeUploads.value.values()),...this.completedUploads.value]}getDetailedStats(){const e=this.uploadStats.value,t=this.getAllTasks(),s=e.total>0?e.completed/e.total*100:0,r=e.total>0?e.totalSize/e.total:0,n=t.reduce((o,f)=>o+((f.endTime||Date.now())-(f.startTime||Date.now())),0);return{successRate:s,averageFileSize:r,totalUploadTime:n,networkQuality:this.networkQuality.value,cacheHitRate:0,workerEnabled:this.config.useWorker&&!!this.workerManager,currentChunkSize:this.config.chunkSize}}destroy(){this.cancelAll(),this.workerManager&&(this.workerManager.terminate(),this.workerManager=void 0),this.progressManager.reset(),this.cacheManager.clear(),console.log("üóëÔ∏è ‰∏ä‰º†ÁÆ°ÁêÜÂô®Â∑≤ÈîÄÊØÅ")}onFileStart(e){return this.callbackManager.onFileStart(e),this}onFileProgress(e){return this.callbackManager.onFileProgress(e),this}onFileSuccess(e){return this.callbackManager.onFileSuccess(e),this}onFileError(e){return this.callbackManager.onFileError(e),this}onFilePause(e){return this.callbackManager.onFilePause(e),this}onFileResume(e){return this.callbackManager.onFileResume(e),this}onFileCancel(e){return this.callbackManager.onFileCancel(e),this}onTotalProgress(e){return this.callbackManager.onTotalProgress(e),this}onAllComplete(e){return this.callbackManager.onAllComplete(e),this}onAllError(e){return this.callbackManager.onAllError(e),this}onSpeedChange(e){return this.callbackManager.onSpeedChange(e),this}onQueueChange(e){return this.callbackManager.onQueueChange(e),this}onChunkSuccess(e){return this.callbackManager.onChunkSuccess(e),this}onChunkError(e){return this.callbackManager.onChunkError(e),this}}function cr(d={}){const e=new lr(d),t=e.uploadQueue,s=e.activeUploads,r=e.completedUploads,n=e.totalProgress,o=e.uploadSpeed,f=e.isUploading,p=e.isPaused,v=e.uploadStats,m=e.networkQuality,C=()=>[...t.value,...Array.from(s.value.values()),...r.value].map(B=>{var fe,pe;return{id:B.id,name:B.file.name,status:b(B.status),percentage:B.progress,file:B.file,thumbnailUrl:(fe=B.options.metadata)==null?void 0:fe.preview,url:(pe=B.result)==null?void 0:pe.fileUrl,type:B.file.type,fullPath:B.file.webkitRelativePath||B.file.name}}),b=_=>({[k.PENDING]:"pending",[k.UPLOADING]:"uploading",[k.SUCCESS]:"finished",[k.ERROR]:"error",[k.PAUSED]:"pending",[k.CANCELLED]:"removed"})[_];return{uploadQueue:t,activeUploads:s,completedUploads:r,totalProgress:n,uploadSpeed:o,isUploading:f,isPaused:p,uploadStats:v,networkQuality:m,uploader:e,addFiles:(_,B)=>e.addFiles(_,B),start:()=>e.start(),pauseAll:()=>e.pauseAll(),pause:_=>e.pause(_),resumeAll:()=>e.resumeAll(),resume:_=>e.resume(_),cancel:_=>e.cancel(_),cancelAll:()=>e.cancelAll(),retryFailed:()=>e.retryFailed(),removeFile:_=>e.removeFile(_),clear:()=>e.clear(),getTask:_=>e.getTask(_),getDetailedStats:()=>e.getDetailedStats(),updateConfig:_=>e.updateConfig(_),destroy:()=>e.destroy(),createNaiveFileList:C,convertToNaiveStatus:b,formatFileSize:ke,formatSpeed:Hs,formatTime:Ws,retrySingleFile:_=>e.retrySingleFile(_),getProgressStatus:()=>v.value.failed>0?"error":v.value.completed===v.value.total?"success":"default",getStatusText:_=>({[k.PENDING]:"Á≠âÂæÖ‰∏≠",[k.UPLOADING]:"‰∏ä‰º†‰∏≠",[k.SUCCESS]:"ÊàêÂäü",[k.ERROR]:"Â§±Ë¥•",[k.PAUSED]:"Â∑≤ÊöÇÂÅú",[k.CANCELLED]:"Â∑≤ÂèñÊ∂à"})[_],getStatusType:_=>({[k.PENDING]:"default",[k.UPLOADING]:"info",[k.SUCCESS]:"success",[k.ERROR]:"error",[k.PAUSED]:"warning",[k.CANCELLED]:"default"})[_],getFileIcon:_=>_.startsWith("image/")?We:_.startsWith("video/")?Ge:_.startsWith("audio/")?Ts:_.includes("pdf")?Qe:_.includes("zip")||_.includes("rar")?je:Ke,getFileColor:_=>_.startsWith("image/")?"#18a058":_.startsWith("video/")?"#2080f0":_.startsWith("audio/")?"#f0a020":_.includes("pdf")?"#d03050":_.includes("zip")||_.includes("rar")?"#7c3aed":"#666"}}const ur={class:"file-item px-4 py-3 border-b border-gray-100 dark:border-gray-700 last:border-b-0 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-150"},hr={class:"flex items-start gap-3"},dr={class:"flex items-center justify-center flex-shrink-0 w-8 h-9"},fr={class:"text-sm font-medium text-gray-400 dark:text-gray-500"},pr={class:"flex flex-col w-full gap-2 min-w-0"},gr={class:"flex justify-between items-center w-full gap-2"},mr={class:"flex flex-col min-w-0 flex-1"},kr={class:"text-sm font-medium text-gray-800 dark:text-gray-100 truncate"},vr={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},wr={class:"flex items-center gap-2 flex-shrink-0"},Cr={key:0,class:"flex flex-col gap-1.5"},Sr={class:"text-xs text-gray-500 dark:text-gray-400"},yr=L({__name:"UploadFileItem",props:{task:{},index:{},showProgress:{type:Boolean,default:!1},showActions:{type:Boolean,default:!1}},emits:["remove","view","retry"],setup(d,{emit:e}){const t=e,s={image:We,video:Ge,audio:Vt,archive:je,document:Qe,default:Ke},r=u=>u.startsWith("image/")?s.image:u.startsWith("video/")?s.video:u.startsWith("audio/")?s.audio:u.includes("zip")||u.includes("rar")||u.includes("7z")?s.archive:u.includes("pdf")||u.includes("document")||u.includes("word")?s.document:s.default,n={image:"#10b981",video:"#8b5cf6",audio:"#f59e0b",archive:"#64748b",pdf:"#ef4444",document:"#3b82f6",default:"#6b7280"},o=u=>u.startsWith("image/")?n.image:u.startsWith("video/")?n.video:u.startsWith("audio/")?n.audio:u.includes("zip")||u.includes("rar")||u.includes("7z")?n.archive:u.includes("pdf")?n.pdf:u.includes("document")||u.includes("word")?n.document:n.default,f=u=>{if(!u)return"Êú™Áü•";const c=u.split("/")[0],i=u.split("/")[1];return{image:"ÂõæÁâá",video:"ËßÜÈ¢ë",audio:"Èü≥È¢ë",application:(i==null?void 0:i.toUpperCase())||"Êñá‰ª∂",text:"ÊñáÊú¨"}[c]||(i==null?void 0:i.toUpperCase())||"Êñá‰ª∂"},p=u=>{if(u===0)return"0 B";const c=1024,i=["B","KB","MB","GB"],a=Math.min(Math.floor(Math.log(u)/Math.log(c)),i.length-1);return`${(u/Math.pow(c,a)).toFixed(1)} ${i[a]}`},v=u=>{if(!u||u===0)return"0 KB/s";const c=1024,i=["B/s","KB/s","MB/s"],a=Math.min(Math.floor(Math.log(u)/Math.log(c)),i.length-1);return`${(u/Math.pow(c,a)).toFixed(1)} ${i[a]}`},m={[k.PENDING]:"ÂæÖ‰∏ä‰º†",[k.UPLOADING]:"‰∏ä‰º†‰∏≠",[k.PAUSED]:"Â∑≤ÊöÇÂÅú",[k.SUCCESS]:"Â∑≤ÂÆåÊàê",[k.ERROR]:"Â§±Ë¥•",[k.CANCELLED]:"Â∑≤ÂèñÊ∂à"},C={[k.PENDING]:"warning",[k.UPLOADING]:"info",[k.PAUSED]:"default",[k.SUCCESS]:"success",[k.ERROR]:"error",[k.CANCELLED]:"default"},b=u=>m[u]||"Êú™Áü•",A=u=>C[u],W=()=>t("remove"),O=()=>t("view"),x=()=>t("retry");return(u,c)=>{var i,a;return F(),$("div",ur,[S("div",hr,[S("div",dr,[S("span",fr,U(u.index+1),1)]),y(g(us),{style:oe({background:o(u.task.file.type)}),size:36,class:"flex items-center justify-center flex-shrink-0"},{default:E(()=>[y(g(ne),{component:r(u.task.file.type),size:18},null,8,["component"])]),_:1},8,["style"]),S("div",pr,[S("div",gr,[S("div",mr,[S("div",kr,U(u.task.file.name),1),S("div",vr,U(p(u.task.file.size))+" ¬∑ "+U(f(u.task.file.type)),1)]),S("div",wr,[y(g(Pe),{type:A(u.task.status),bordered:!1,size:"small"},{default:E(()=>[j(U(b(u.task.status)),1)]),_:1},8,["type"]),u.showActions?(F(),$(zt,{key:0},[u.task.status===g(k).PENDING?(F(),K(g(me),{key:0,size:"tiny",quaternary:"",circle:"",onClick:ye(W,["stop"])},{icon:E(()=>[y(g(ne),{component:g(Cs)},null,8,["component"])]),_:1})):V("",!0),u.task.status===g(k).SUCCESS&&((a=(i=u.task.options)==null?void 0:i.metadata)!=null&&a.preview)?(F(),K(g(me),{key:1,size:"tiny",quaternary:"",circle:"",type:"info",onClick:ye(O,["stop"])},{icon:E(()=>[y(g(ne),{component:g(Es)},null,8,["component"])]),_:1})):V("",!0),u.task.status===g(k).ERROR?(F(),K(g(me),{key:2,size:"tiny",quaternary:"",circle:"",type:"warning",onClick:ye(x,["stop"])},{icon:E(()=>[y(g(ne),{component:g(Ze)},null,8,["component"])]),_:1})):V("",!0)],64)):V("",!0)])]),u.showProgress&&u.task.status===g(k).UPLOADING?(F(),$("div",Cr,[y(g(Ve),{type:"line",percentage:u.task.progress,"show-indicator":!1,height:4,"border-radius":2},null,8,["percentage"]),S("div",Sr,U(u.task.progress)+"% ¬∑ "+U(v(u.task.speed)),1)])):V("",!0)])])])}}}),Re=Ie(yr,[["__scopeId","data-v-f3a3a4d1"]]),br={class:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-sm border border-gray-100 dark:border-gray-700 transition-colors duration-300"},Er={class:"flex items-center gap-2 text-lg font-semibold text-gray-600 dark:text-gray-300 m-0"},xr={class:"flex items-center gap-2"},Tr=L({__name:"UploadListSection",props:{title:{},icon:{},count:{},items:{},tagType:{default:"info"},defaultCollapsed:{type:Boolean,default:!1},maxHeight:{default:"400px"},itemSize:{default:48}},setup(d,{expose:e}){const t=d,s=G(()=>t.items.map((f,p)=>({...f,_index:p}))),r=N(t.defaultCollapsed),n=N();G(()=>{const f=t.items.length*t.itemSize,p=parseInt(t.maxHeight);return`${Math.min(f,p)}px`});const o=()=>{t.items.length!==0&&(r.value=!r.value)};return e({toggleCollapse:o,isCollapsed:r}),(f,p)=>(F(),$("div",br,[S("div",{class:"flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:o},[S("h3",Er,[y(g(ne),{component:f.icon,size:20},null,8,["component"]),j(" "+U(f.title),1)]),S("div",xr,[y(g(Pe),{type:f.tagType,bordered:!1,round:"",size:"small"},{default:E(()=>[j(U(f.count),1)]),_:1},8,["type"]),y(g(ne),{size:20,class:"transition-transform duration-300 ease-in-out text-gray-300 dark:text-gray-500 group-hover:text-primary",style:oe({transform:r.value?"rotate(-90deg)":"rotate(0deg)"})},{default:E(()=>[y(g(vs))]),_:1},8,["style"])])]),S("div",{ref_key:"contentRef",ref:n,class:"overflow-hidden transition-all duration-300 ease-in-out",style:oe({maxHeight:r.value?f.maxHeight:"0px",opacity:r.value?1:0})},[S("div",{style:oe({height:f.maxHeight,overflow:"hidden"})},[f.items.length>0?Ut((F(),K(g(ds),{key:0,items:s.value,"item-size":f.itemSize,"item-resizable":!1,style:oe({height:f.maxHeight}),class:"virtual-list-container"},{default:E(({item:v,index:m})=>[Nt(f.$slots,"item",{item:v,index:v._index},void 0,!0)]),_:3},8,["items","item-size","style"])),[[Dt,r.value]]):f.items.length===0?(F(),K(g(Ot),{key:1,description:"ÊöÇÊó†Êï∞ÊçÆ",size:"small",class:"py-8"})):V("",!0)],4)],4)]))}}),Fe=Ie(Tr,[["__scopeId","data-v-1c5aa306"]]),Mr={class:"flex flex-col w-full h-full gap-4"},Ar={class:"flex justify-between items-center"},_r={class:"flex flex-col xl:flex-row gap-4 w-full"},Rr={class:"flex flex-col md:flex-row gap-4 p-6 bg-white dark:bg-gray-800 rounded-lg shadow transition-all duration-300 flex-1"},Fr={class:"flex flex-col items-center justify-center py-4 px-4 text-center"},Pr={class:"mt-3 text-gray-500 dark:text-gray-400 text-sm"},Ir={class:"flex flex-col justify-between gap-4 md:w-[260px]"},zr={class:"flex flex-wrap gap-2"},Ur={class:"text-gray-400 dark:text-gray-500 text-xs text-center"},Dr={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 flex-1 min-w-[300px] transition-all duration-300"},Nr={class:"flex items-start justify-between mb-4 gap-4"},Or={class:"flex flex-wrap gap-2"},$r={class:"mb-4"},Lr={class:"mt-2 grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm text-gray-600 dark:text-gray-400 items-center"},Br={class:"flex items-center gap-2"},Hr={class:"flex items-center gap-2"},Wr={class:"smooth-time"},Gr={class:"flex items-center gap-2"},Qr={class:"flex flex-col gap-4 flex-1"},Le="WGz4LlZ0W8P3+HOaQlLRkcdCuTsJGVrvvTZfdJYY3otxprBxscciMf+yoDBGJ+9f1bA5c+xXMNCkSzTr1aflzW0TcOXtrKagFj0ZvBk//rdHwQUzXVmVkiWN+5LR2wi/oqAnl5o5KmFP5tuTifyd1CUTZdG6aUPvnnHKbYZfevBbpvmuhKqC9Ks2v/NrfBGZ",jr=L({name:"upload",__name:"index",setup(d){const e=Kt(),t=ts(),s=$t(),r=N(!1),n=Lt({maxConcurrentFiles:M.CONCURRENT.DEFAULT_FILES,maxConcurrentChunks:M.CONCURRENT.DEFAULT_CHUNKS,chunkSize:M.UPLOAD.CHUNK_SIZE,maxRetries:M.RETRY.MAX_RETRIES,enableNetworkAdaptation:!0,enableSmartRetry:!0,enableDeduplication:!1,useWorker:!1}),o=[{label:"512 KB",value:512*1024},{label:"1 MB",value:1024*1024},{label:"2 MB",value:2*1024*1024},{label:"5 MB",value:5*1024*1024},{label:"10 MB",value:10*1024*1024}],{addFiles:f,start:p,pauseAll:v,resumeAll:m,uploadQueue:C,activeUploads:b,completedUploads:A,totalProgress:W,uploadSpeed:O,uploadStats:x,isUploading:u,isPaused:c,networkQuality:i,retryFailed:a,retrySingleFile:h,removeFile:l,clear:z,updateConfig:H,formatFileSize:Q,formatSpeed:ee,formatTime:ce,getProgressStatus:ue}=cr({uploadChunkUrl:"https://testaest-v1.umi6.com/proxy-minio/upload/chunk",mergeChunksUrl:"https://testaest-v1.umi6.com/proxy-minio/upload/complete",checkFileUrl:"/api/upload/check",headers:{"custom-origin":"https://testaigc.umi6.com",origin:"https://testaigc.umi6.com",authorization:"Bearer 6992fcd36dce4d24b9ddf26a110a17cf"},chunkUploadTransformer:({task:P,chunk:T})=>{const I=new FormData;return I.append("file",T.blob),I.append("chunk_number",T.index.toString()),I.append("upload_id",P.id),I.append("Authorization",Le),I},mergeChunksTransformer:({task:P})=>({upload_id:P.id,filename:P.file.name,folder:P.file.webkitRelativePath,total_chunks:P.totalChunks,Authorization:Le}),...n}),te=N(),he=N(0);let q=0,de=0,Z=null;const _=P=>{Z&&clearInterval(Z),q=P,he.value=q,de=Date.now(),Z=window.setInterval(()=>{const T=Date.now(),I=(T-de)/1e3;q=Math.max(0,q-I),he.value=Math.round(q),de=T,q<=0&&Z&&(clearInterval(Z),Z=null)},1e3)};le(()=>x.value.estimatedTime,P=>{(Math.abs(P-q)>5||Z===null)&&(console.log(`üïê Ââ©‰ΩôÊó∂Èó¥ÂêåÊ≠•: ${q.toFixed(0)}s -> ${P}s`),_(P))},{immediate:!0}),He(()=>{Z&&clearInterval(Z)});const B=G(()=>A.value.filter(P=>P.status===k.ERROR).length),fe=G(()=>({good:"ËâØÂ•Ω",fair:"‰∏ÄËà¨",poor:"ËæÉÂ∑Æ"})[i.value]),pe=G(()=>"ÊâÄÊúâÊ†ºÂºè"),Je=G(()=>Q(M.UPLOAD.MAX_FILESIZE)),et=async P=>{if(!(!P||P.length===0))try{const T=P.map(I=>I.file);await f(T),te.value&&(te.value.value="")}catch(T){s.error(`Ê∑ªÂä†Êñá‰ª∂Â§±Ë¥•: ${T}`)}},tt=P=>{s.error(P.message)},st=P=>{s.warning(`Êñá‰ª∂Êï∞ÈáèË∂ÖÂá∫ÈôêÂà∂ÔºåÊúÄÂ§öÂÖÅËÆ∏ ${P.max} ‰∏™Êñá‰ª∂`)},rt=async()=>{await p()},nt=P=>{try{h(P),s.info("Â∑≤Âä†ÂÖ•ÈáçËØïÈòüÂàó"),p()}catch(T){s.error(`ÈáçËØïÂ§±Ë¥•: ${T}`)}},it=P=>{console.log(P,"‰ªªÂä°‰ø°ÊÅØ"),e.open({title:"Êñá‰ª∂È¢ÑËßà",content:JSON.stringify(P,null,2),width:600})},Y=()=>{H(n),s.success("ËÆæÁΩÆÂ∑≤Êõ¥Êñ∞")};return(P,T)=>{const I=ne,at=Jt,ie=me,ot=Bt,ae=Pe,lt=Ve,we=Wt,X=rs,ct=Gt,ge=Qt,ut=ss,ht=Ht,dt=jt;return F(),$("div",Mr,[S("div",Ar,[y(at,{class:"flex items-center gap-3 m-0 font-semibold"},{default:E(()=>[y(I,{component:g(be),size:22},null,8,["component"]),T[10]||(T[10]=j(" Êñá‰ª∂‰∏ä‰º†ÁÆ°ÁêÜ "))]),_:1}),y(ot,null,{default:E(()=>[y(ie,{size:"small",onClick:T[0]||(T[0]=R=>r.value=!0),quaternary:"",circle:""},{icon:E(()=>[y(I,{component:g(Ps)},null,8,["component"])]),_:1}),g(x).total>0?(F(),K(ie,{key:0,size:"small",onClick:g(z),quaternary:"",circle:"",type:"error"},{icon:E(()=>[y(I,{component:g(Zt)},null,8,["component"])]),_:1},8,["onClick"])):V("",!0)]),_:1})]),S("div",_r,[S("div",Rr,[y(g(es),{ref:"customUploadRef",abstract:!0,multiple:!0,"directory-dnd":!0,max:g(M).UPLOAD.MAX_FILES,"max-size":g(M).UPLOAD.MAX_FILESIZE,disabled:g(u)||g(c),"batch-size":100,"processing-timeout":20,onChange:et,onError:tt,onExceed:st,class:"flex-1"},{default:E(({isDragOver:R,isProcessing:se,fileCount:Ce})=>[S("div",Fr,[y(I,{component:g(be),size:56,color:R?g(t).primaryColor:g(t).primaryColorHover,class:"transition-all duration-300"},null,8,["component","color"]),S("p",Pr,U(se?"Â§ÑÁêÜ‰∏≠...":"ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§ÑÊàñÁÇπÂáªÈÄâÊã©"),1)])]),_:1},8,["max","max-size","disabled"]),S("div",Ir,[S("div",zr,[y(ie,{size:"small",onClick:g(a),disabled:B.value===0,type:"warning",class:"flex-1"},{icon:E(()=>[y(I,{component:g(Ze)},null,8,["component"])]),default:E(()=>[j(" ÈáçËØïÂ§±Ë¥• ("+U(B.value)+") ",1)]),_:1},8,["onClick","disabled"]),y(ie,{size:"small",onClick:g(v),disabled:!g(u)||g(c),class:"flex-1"},{icon:E(()=>[y(I,{component:g(As)},null,8,["component"])]),default:E(()=>[T[11]||(T[11]=j(" ÊöÇÂÅú "))]),_:1},8,["onClick","disabled"]),y(ie,{size:"small",onClick:g(m),disabled:!g(c)||g(u),class:"flex-1"},{icon:E(()=>[y(I,{component:g(Ne)},null,8,["component"])]),default:E(()=>[T[12]||(T[12]=j(" ÊÅ¢Â§ç "))]),_:1},8,["onClick","disabled"]),y(ie,{type:"primary",onClick:rt,disabled:g(C).length===0||g(u)||g(c),loading:g(u),size:"small",class:"flex-1"},{icon:E(()=>[y(I,{component:g(Ne)},null,8,["component"])]),default:E(()=>[T[13]||(T[13]=j(" ÂºÄÂßã‰∏ä‰º† "))]),_:1},8,["disabled","loading"])]),S("div",Ur," ÊîØÊåÅÊ†ºÂºè: "+U(pe.value)+" | ÊúÄÂ§ß: "+U(Je.value),1)])]),S("div",Dr,[S("div",Nr,[T[14]||(T[14]=S("h3",{class:"text-lg font-medium text-gray-600 dark:text-gray-200"},"‰∏ä‰º†ÁªüËÆ°",-1)),S("div",Or,[y(ae,{bordered:!1,type:"info",class:"flex items-center"},{icon:E(()=>[y(I,{component:g(ys)},null,8,["component"])]),default:E(()=>[j(" ÊÄªËÆ°: "+U(g(x).total),1)]),_:1}),y(ae,{bordered:!1,type:"warning",class:"flex items-center"},{icon:E(()=>[y(I,{component:g(Oe)},null,8,["component"])]),default:E(()=>[j(" ÂæÖ‰∏ä‰º†: "+U(g(x).pending),1)]),_:1}),y(ae,{bordered:!1,type:"primary",class:"flex items-center"},{icon:E(()=>[y(I,{component:g(ps)},null,8,["component"])]),default:E(()=>[j(" ‰∏ä‰º†‰∏≠: "+U(g(x).active),1)]),_:1}),y(ae,{bordered:!1,type:"success",class:"flex items-center"},{icon:E(()=>[y(I,{component:g(qt)},null,8,["component"])]),default:E(()=>[j(" Â∑≤ÂÆåÊàê: "+U(g(x).completed),1)]),_:1}),g(x).failed>0?(F(),K(ae,{key:0,bordered:!1,type:"error",class:"flex items-center"},{icon:E(()=>[y(I,{component:g(Yt)},null,8,["component"])]),default:E(()=>[j(" Â§±Ë¥•: "+U(g(x).failed),1)]),_:1})):V("",!0)])]),S("div",$r,[y(lt,{type:"line",percentage:g(W),status:g(ue)(),height:12,"border-radius":6,"fill-border-radius":6},null,8,["percentage","status"])]),S("div",Lr,[S("div",Br,[y(I,{component:g(zs)},null,8,["component"]),S("span",null,U(g(ee)(g(O))),1)]),S("div",Hr,[y(I,{component:g(Oe)},null,8,["component"]),S("span",Wr,U(g(ce)(he.value)),1)]),S("div",Gr,[y(I,{component:g(Ns)},null,8,["component"]),y(ae,{type:g(i)==="good"?"success":g(i)==="fair"?"warning":"error",size:"small",bordered:!1},{default:E(()=>[j(U(fe.value),1)]),_:1},8,["type"])])])])]),S("div",Qr,[g(C).length>0?(F(),K(Fe,{key:0,title:"ÂæÖ‰∏ä‰º†ÈòüÂàó",icon:g(Xt),count:g(C).length,"tag-type":"info",items:g(C),"default-collapsed":"","max-height":"250px"},{item:E(({item:R,index:se})=>[(F(),K(Re,{index:se,key:R.id,task:R,"show-actions":!0,onRemove:Ce=>g(l)(R.id)},null,8,["index","task","onRemove"]))]),_:1},8,["icon","count","items"])):V("",!0),g(b).size>0?(F(),K(Fe,{key:1,"max-height":"380px",title:"‰∏ä‰º†‰∏≠",icon:g(be),count:g(b).size,"tag-type":"primary",items:Array.from(g(b).values())},{item:E(({item:R,index:se})=>[(F(),K(Re,{index:se,key:R.id,task:R,"show-progress":!0},null,8,["index","task"]))]),_:1},8,["icon","count","items"])):V("",!0),g(A).length>0?(F(),K(Fe,{key:2,title:"Â∑≤ÂÆåÊàê","max-height":"250px",icon:g(ms),count:g(A).length,items:g(A),"tag-type":"success"},{item:E(({item:R,index:se})=>[y(Re,{task:R,index:se,"show-actions":!0,onRetry:Ce=>nt(R.id),onView:Ce=>it(R)},null,8,["task","index","onRetry","onView"])]),_:1},8,["icon","count","items"])):V("",!0)]),y(dt,{show:r.value,"onUpdate:show":T[9]||(T[9]=R=>r.value=R),width:400,placement:"right"},{default:E(()=>[y(ht,{title:"‰∏ä‰º†ËÆæÁΩÆ",closable:""},{default:E(()=>[y(ut,{"label-placement":"left","label-width":"120"},{default:E(()=>[y(X,{label:"Âπ∂ÂèëÊñá‰ª∂Êï∞"},{default:E(()=>[y(we,{value:n.maxConcurrentFiles,"onUpdate:value":[T[1]||(T[1]=R=>n.maxConcurrentFiles=R),Y],min:1,max:10},null,8,["value"])]),_:1}),y(X,{label:"Âπ∂ÂèëÂàÜÁâáÊï∞"},{default:E(()=>[y(we,{value:n.maxConcurrentChunks,"onUpdate:value":[T[2]||(T[2]=R=>n.maxConcurrentChunks=R),Y],min:1,max:10},null,8,["value"])]),_:1}),y(X,{label:"ÂàÜÁâáÂ§ßÂ∞è"},{default:E(()=>[y(ct,{value:n.chunkSize,"onUpdate:value":[T[3]||(T[3]=R=>n.chunkSize=R),Y],options:o},null,8,["value"])]),_:1}),y(X,{label:"ÊúÄÂ§ßÈáçËØïÊ¨°Êï∞"},{default:E(()=>[y(we,{value:n.maxRetries,"onUpdate:value":[T[4]||(T[4]=R=>n.maxRetries=R),Y],min:0,max:10},null,8,["value"])]),_:1}),y(X,{label:"ÁΩëÁªúËá™ÈÄÇÂ∫î"},{default:E(()=>[y(ge,{value:n.enableNetworkAdaptation,"onUpdate:value":[T[5]||(T[5]=R=>n.enableNetworkAdaptation=R),Y]},null,8,["value"])]),_:1}),y(X,{label:"Êô∫ËÉΩÈáçËØï"},{default:E(()=>[y(ge,{value:n.enableSmartRetry,"onUpdate:value":[T[6]||(T[6]=R=>n.enableSmartRetry=R),Y]},null,8,["value"])]),_:1}),y(X,{label:"Áßí‰º†Ê£ÄÊµã"},{default:E(()=>[y(ge,{value:n.enableDeduplication,"onUpdate:value":[T[7]||(T[7]=R=>n.enableDeduplication=R),Y]},null,8,["value"])]),_:1}),y(X,{label:"‰ΩøÁî® Worker"},{default:E(()=>[y(ge,{value:n.useWorker,"onUpdate:value":[T[8]||(T[8]=R=>n.useWorker=R),Y]},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),en=Ie(jr,[["__scopeId","data-v-92f65860"]]);export{en as default};
