var gt=Object.defineProperty;var mt=(c,e,t)=>e in c?gt(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var C=(c,e,t)=>mt(c,typeof e!="symbol"?e+"":e,t);import{a9 as vt,al as kt,z as De,ce as wt,cf as Ct,y as Se,aq as Ue,d as Q,cy as yt,at as St,D as ne,aY as bt,F as xt,r as O,m as Ne,c as V,G as He,cz as Et,cA as Tt,J as Mt,K as At,cB as _t,j as Ft,M as Pt,k as We,Q as de,cC as Rt,cD as It,a as K,o as I,b,a7 as zt,aj as Dt,e as m,b1 as Ut,af as ee,f as H,B as fe,t as W,w as E,g as v,R as he,a1 as Y,cE as Ie,a2 as Nt,v as q,cF as be,a6 as ze,cG as $t,cb as Ot,b5 as Lt,cH as Bt,cI as Ht,aD as Wt,bD as Gt,cJ as Qt,cK as jt,cL as Kt,bE as Vt}from"./index-saEpKK3w.js";import{I as Ge,V as Qe,D as je,A as Ke,a as Ve,C as pe,_ as Ze,M as Zt,T as qt,b as Yt,c as Xt,F as Jt,u as es}from"./VideocamOutline-DJj5u7Ar.js";import{u as qe}from"./use-theme-vars-BIXdptPX.js";import{N as xe}from"./text-DGFBZXUU.js";import{N as ts}from"./headers-DNWcXxPG.js";import{_ as ss}from"./Space-DXVLf2rs.js";import{_ as rs,a as as}from"./FormItem-BZT5HQcH.js";const ns=vt&&"loading"in document.createElement("img");function is(c={}){var e;const{root:t=null}=c;return{hash:`${c.rootMargin||"0px 0px 0px 0px"}-${Array.isArray(c.threshold)?c.threshold.join(","):(e=c.threshold)!==null&&e!==void 0?e:"0"}`,options:Object.assign(Object.assign({},c),{root:(typeof t=="string"?document.querySelector(t):t)||document.documentElement})}}const Ee=new WeakMap,Te=new WeakMap,Me=new WeakMap,os=(c,e,t)=>{if(!c)return()=>{};const s=is(e),{root:r}=s.options;let a;const i=Ee.get(r);i?a=i:(a=new Map,Ee.set(r,a));let d,f;a.has(s.hash)?(f=a.get(s.hash),f[1].has(c)||(d=f[0],f[1].add(c),d.observe(c))):(d=new IntersectionObserver(S=>{S.forEach(x=>{if(x.isIntersecting){const T=Te.get(x.target),U=Me.get(x.target);T&&T(),U&&(U.value=!0)}})},s.options),d.observe(c),f=[d,new Set([c])],a.set(s.hash,f));let g=!1;const k=()=>{g||(Te.delete(c),Me.delete(c),g=!0,f[1].has(c)&&(f[0].unobserve(c),f[1].delete(c)),f[1].size<=0&&a.delete(s.hash),a.size||Ee.delete(r))};return Te.set(c,k),Me.set(c,t),k},ls=kt("n-avatar-group"),cs=De("avatar",`
 width: var(--n-merged-size);
 height: var(--n-merged-size);
 color: #FFF;
 font-size: var(--n-font-size);
 display: inline-flex;
 position: relative;
 overflow: hidden;
 text-align: center;
 border: var(--n-border);
 border-radius: var(--n-border-radius);
 --n-merged-color: var(--n-color);
 background-color: var(--n-merged-color);
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
`,[wt(Se("&","--n-merged-color: var(--n-color-modal);")),Ct(Se("&","--n-merged-color: var(--n-color-popover);")),Se("img",`
 width: 100%;
 height: 100%;
 `),Ue("text",`
 white-space: nowrap;
 display: inline-block;
 position: absolute;
 left: 50%;
 top: 50%;
 `),De("icon",`
 vertical-align: bottom;
 font-size: calc(var(--n-merged-size) - 6px);
 `),Ue("text","line-height: 1.25")]),us=Object.assign(Object.assign({},He.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),hs=Q({name:"Avatar",props:us,slots:Object,setup(c){const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=xt(c),s=O(!1);let r=null;const a=O(null),i=O(null),d=()=>{const{value:h}=a;if(h&&(r===null||r!==h.innerHTML)){r=h.innerHTML;const{value:o}=i;if(o){const{offsetWidth:n,offsetHeight:u}=o,{offsetWidth:l,offsetHeight:P}=h,j=.9,Z=Math.min(n/l*j,u/P*j,1);h.style.transform=`translateX(-50%) translateY(-50%) scale(${Z})`}}},f=Ne(ls,null),g=V(()=>{const{size:h}=c;if(h)return h;const{size:o}=f||{};return o||"medium"}),k=He("Avatar","-avatar",cs,Et,c,e),S=Ne(Tt,null),x=V(()=>{if(f)return!0;const{round:h,circle:o}=c;return h!==void 0||o!==void 0?h||o:S?S.roundRef.value:!1}),T=V(()=>f?!0:c.bordered||!1),U=V(()=>{const h=g.value,o=x.value,n=T.value,{color:u}=c,{self:{borderRadius:l,fontSize:P,color:j,border:Z,colorModal:X,colorPopover:ie},common:{cubicBezierEaseInOut:ue}}=k.value;let J;return typeof h=="number"?J=`${h}px`:J=k.value.self[Mt("height",h)],{"--n-font-size":P,"--n-border":n?Z:"none","--n-border-radius":o?"50%":l,"--n-color":u||j,"--n-color-modal":u||X,"--n-color-popover":u||ie,"--n-bezier":ue,"--n-merged-size":`var(--n-avatar-size-override, ${J})`}}),B=t?At("avatar",V(()=>{const h=g.value,o=x.value,n=T.value,{color:u}=c;let l="";return h&&(typeof h=="number"?l+=`a${h}`:l+=h[0]),o&&(l+="b"),n&&(l+="c"),u&&(l+=_t(u)),l}),U,c):void 0,M=O(!c.lazy);Ft(()=>{if(c.lazy&&c.intersectionObserverOptions){let h;const o=Pt(()=>{h==null||h(),h=void 0,c.lazy&&(h=os(i.value,c.intersectionObserverOptions,M))});We(()=>{o(),h==null||h()})}}),de(()=>{var h;return c.src||((h=c.imgProps)===null||h===void 0?void 0:h.src)},()=>{s.value=!1});const p=O(!c.lazy);return{textRef:a,selfRef:i,mergedRoundRef:x,mergedClsPrefix:e,fitTextTransform:d,cssVars:t?void 0:U,themeClass:B==null?void 0:B.themeClass,onRender:B==null?void 0:B.onRender,hasLoadError:s,shouldStartLoading:M,loaded:p,mergedOnError:h=>{if(!M.value)return;s.value=!0;const{onError:o,imgProps:{onError:n}={}}=c;o==null||o(h),n==null||n(h)},mergedOnLoad:h=>{const{onLoad:o,imgProps:{onLoad:n}={}}=c;o==null||o(h),n==null||n(h),p.value=!0}}},render(){var c,e;const{$slots:t,src:s,mergedClsPrefix:r,lazy:a,onRender:i,loaded:d,hasLoadError:f,imgProps:g={}}=this;i==null||i();let k;const S=!d&&!f&&(this.renderPlaceholder?this.renderPlaceholder():(e=(c=this.$slots).placeholder)===null||e===void 0?void 0:e.call(c));return this.hasLoadError?k=this.renderFallback?this.renderFallback():yt(t.fallback,()=>[ne("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})]):k=St(t.default,x=>{if(x)return ne(bt,{onResize:this.fitTextTransform},{default:()=>ne("span",{ref:"textRef",class:`${r}-avatar__text`},x)});if(s||g.src){const T=this.src||g.src;return ne("img",Object.assign(Object.assign({},g),{loading:ns&&!this.intersectionObserverOptions&&a?"lazy":"eager",src:a&&this.intersectionObserverOptions?this.shouldStartLoading?T:void 0:T,"data-image-src":T,onLoad:this.mergedOnLoad,onError:this.mergedOnError,style:[g.style||"",{objectFit:this.objectFit},S?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}}),ne("span",{ref:"selfRef",class:[`${r}-avatar`,this.themeClass],style:this.cssVars},k,a&&S)}}),ds={scrollbarProps:Object,items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},fs=Q({name:"VirtualList",props:ds,setup(c){const e=O(null),t=O(null);function s(){const{value:k}=e;k&&k.sync()}function r(k){var S;s(),(S=c.onScroll)===null||S===void 0||S.call(c,k)}function a(k){var S;s(),(S=c.onResize)===null||S===void 0||S.call(c,k)}function i(k){var S;(S=c.onWheel)===null||S===void 0||S.call(c,k)}function d(k,S){var x,T;typeof k=="number"?(x=t.value)===null||x===void 0||x.scrollTo(k,S??0):(T=t.value)===null||T===void 0||T.scrollTo(k)}function f(){var k;return(k=t.value)===null||k===void 0?void 0:k.listElRef}function g(){var k;return(k=t.value)===null||k===void 0?void 0:k.itemsElRef}return{scrollTo:d,scrollbarInstRef:e,virtualListInstRef:t,getScrollContainer:f,getScrollContent:g,handleScroll:r,handleResize:a,handleWheel:i}},render(){return ne(It,Object.assign({},this.scrollbarProps,{ref:"scrollbarInstRef",container:this.getScrollContainer,content:this.getScrollContent}),{default:()=>ne(Rt,{ref:"virtualListInstRef",showScrollbar:!1,items:this.items,itemSize:this.itemSize,itemResizable:this.itemResizable,itemsStyle:this.itemsStyle,visibleItemsTag:this.visibleItemsTag,visibleItemsProps:this.visibleItemsProps,ignoreItemResize:this.ignoreItemResize,keyField:this.keyField,defaultScrollKey:this.defaultScrollKey,defaultScrollIndex:this.defaultScrollIndex,paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,onScroll:this.handleScroll,onResize:this.handleResize,onWheel:this.handleWheel},{default:({item:c,index:e})=>{var t,s;return(s=(t=this.$slots).default)===null||s===void 0?void 0:s.call(t,{item:c,index:e})}})})}}),ps={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},gs=Q({name:"ArrowUpOutline",render:function(e,t){return I(),K("svg",ps,t[0]||(t[0]=[b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1)]))}}),ms={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},vs=Q({name:"CheckmarkDoneOutline",render:function(e,t){return I(),K("svg",ms,t[0]||(t[0]=[b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M464 128L240 384l-96-96"},null,-1),b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M144 384l-96-96"},null,-1),b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 128L232 284"},null,-1)]))}}),ks={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ws=Q({name:"ChevronDownOutline",render:function(e,t){return I(),K("svg",ks,t[0]||(t[0]=[b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),Cs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ys=Q({name:"CloseOutline",render:function(e,t){return I(),K("svg",Cs,t[0]||(t[0]=[b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1)]))}}),Ss={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},bs=Q({name:"DocumentsOutline",render:function(e,t){return I(),K("svg",Ss,t[0]||(t[0]=[b("path",{d:"M336 264.13V436c0 24.3-19.05 44-42.95 44H107c-23.95 0-43-19.7-43-44V172a44.26 44.26 0 0 1 44-44h94.12a24.55 24.55 0 0 1 17.49 7.36l109.15 111a25.4 25.4 0 0 1 7.24 17.77z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),b("path",{d:"M200 128v108a28.34 28.34 0 0 0 28 28h108",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),b("path",{d:"M176 128V76a44.26 44.26 0 0 1 44-44h94a24.83 24.83 0 0 1 17.61 7.36l109.15 111A25.09 25.09 0 0 1 448 168v172c0 24.3-19.05 44-42.95 44H344",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),b("path",{d:"M312 32v108a28.34 28.34 0 0 0 28 28h108",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),xs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Es=Q({name:"EyeOutline",render:function(e,t){return I(),K("svg",xs,t[0]||(t[0]=[b("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),b("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),Ts={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ms=Q({name:"MusicalNoteOutline",render:function(e,t){return I(),K("svg",Ts,t[0]||(t[0]=[b("path",{d:"M240 343.31V424a32.28 32.28 0 0 1-21.88 30.65l-21.47 7.23c-25.9 8.71-52.65-10.75-52.65-38.32h0A34.29 34.29 0 0 1 167.25 391l50.87-17.12A32.29 32.29 0 0 0 240 343.24V92a16.13 16.13 0 0 1 12.06-15.66L360.49 48.2A6 6 0 0 1 368 54v57.76a16.13 16.13 0 0 1-12.12 15.67l-91.64 23.13A32.25 32.25 0 0 0 240 181.91v39.39",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),As={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},_s=Q({name:"PauseOutline",render:function(e,t){return I(),K("svg",As,t[0]||(t[0]=[b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 96h16v320h-16z"},null,-1),b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M320 96h16v320h-16z"},null,-1)]))}}),Fs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},$e=Q({name:"PlayOutline",render:function(e,t){return I(),K("svg",Fs,t[0]||(t[0]=[b("path",{d:"M112 111v290c0 17.44 17 28.52 31 20.16l247.9-148.37c12.12-7.25 12.12-26.33 0-33.58L143 90.84c-14-8.36-31 2.72-31 20.16z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),Ps={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ye=Q({name:"RefreshOutline",render:function(e,t){return I(),K("svg",Ps,t[0]||(t[0]=[b("path",{d:"M320 146s24.36-12-64-12a160 160 0 1 0 160 160",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 58l80 80l-80 80"},null,-1)]))}}),Rs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Is=Q({name:"SettingsOutline",render:function(e,t){return I(),K("svg",Rs,t[0]||(t[0]=[b("path",{d:"M262.29 192.31a64 64 0 1 0 57.4 57.4a64.13 64.13 0 0 0-57.4-57.4zM416.39 256a154.34 154.34 0 0 1-1.53 20.79l45.21 35.46a10.81 10.81 0 0 1 2.45 13.75l-42.77 74a10.81 10.81 0 0 1-13.14 4.59l-44.9-18.08a16.11 16.11 0 0 0-15.17 1.75A164.48 164.48 0 0 1 325 400.8a15.94 15.94 0 0 0-8.82 12.14l-6.73 47.89a11.08 11.08 0 0 1-10.68 9.17h-85.54a11.11 11.11 0 0 1-10.69-8.87l-6.72-47.82a16.07 16.07 0 0 0-9-12.22a155.3 155.3 0 0 1-21.46-12.57a16 16 0 0 0-15.11-1.71l-44.89 18.07a10.81 10.81 0 0 1-13.14-4.58l-42.77-74a10.8 10.8 0 0 1 2.45-13.75l38.21-30a16.05 16.05 0 0 0 6-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 0 0-6.07-13.94l-38.19-30A10.81 10.81 0 0 1 49.48 186l42.77-74a10.81 10.81 0 0 1 13.14-4.59l44.9 18.08a16.11 16.11 0 0 0 15.17-1.75A164.48 164.48 0 0 1 187 111.2a15.94 15.94 0 0 0 8.82-12.14l6.73-47.89A11.08 11.08 0 0 1 213.23 42h85.54a11.11 11.11 0 0 1 10.69 8.87l6.72 47.82a16.07 16.07 0 0 0 9 12.22a155.3 155.3 0 0 1 21.46 12.57a16 16 0 0 0 15.11 1.71l44.89-18.07a10.81 10.81 0 0 1 13.14 4.58l42.77 74a10.8 10.8 0 0 1-2.45 13.75l-38.21 30a16.05 16.05 0 0 0-6.05 14.08c.33 4.14.55 8.3.55 12.47z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),zs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ds=Q({name:"SpeedometerOutline",render:function(e,t){return I(),K("svg",zs,t[0]||(t[0]=[zt('<path d="M326.1 231.9l-47.5 75.5a31 31 0 0 1-7 7a30.11 30.11 0 0 1-35-49l75.5-47.5a10.23 10.23 0 0 1 11.7 0a10.06 10.06 0 0 1 2.3 14z" fill="currentColor"></path><path d="M256 64C132.3 64 32 164.2 32 287.9a223.18 223.18 0 0 0 56.3 148.5c1.1 1.2 2.1 2.4 3.2 3.5a25.19 25.19 0 0 0 37.1-.1a173.13 173.13 0 0 1 254.8 0a25.19 25.19 0 0 0 37.1.1l3.2-3.5A223.18 223.18 0 0 0 480 287.9C480 164.2 379.7 64 256 64z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M256 128v32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M416 288h-32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M128 288H96"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M165.49 197.49l-22.63-22.63"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M346.51 197.49l22.63-22.63"></path>',7)]))}}),Us={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Oe=Q({name:"TimeOutline",render:function(e,t){return I(),K("svg",Us,t[0]||(t[0]=[b("path",{d:"M256 64C150 64 64 150 64 256s86 192 192 192s192-86 192-192S362 64 256 64z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 128v144h96"},null,-1)]))}}),Ns={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},$s=Q({name:"WifiOutline",render:function(e,t){return I(),K("svg",Ns,t[0]||(t[0]=[b("path",{d:"M332.41 310.59a115 115 0 0 0-152.8 0",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),b("path",{d:"M393.46 249.54a201.26 201.26 0 0 0-274.92 0",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),b("path",{d:"M447.72 182.11a288 288 0 0 0-383.44 0",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),b("path",{d:"M256 416a32 32 0 1 1 32-32a32 32 0 0 1-32 32z",fill:"currentColor"},null,-1)]))}});var w=(c=>(c.PENDING="pending",c.UPLOADING="uploading",c.SUCCESS="success",c.ERROR="error",c.PAUSED="paused",c.CANCELLED="cancelled",c))(w||{}),G=(c=>(c.PENDING="pending",c.UPLOADING="uploading",c.SUCCESS="success",c.ERROR="error",c.RETRYING="retrying",c))(G||{}),Ae={exports:{}},Le;function Os(){return Le||(Le=1,(function(c,e){(function(t){c.exports=t()})(function(t){var s=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(p,h){var o=p[0],n=p[1],u=p[2],l=p[3];o+=(n&u|~n&l)+h[0]-680876936|0,o=(o<<7|o>>>25)+n|0,l+=(o&n|~o&u)+h[1]-389564586|0,l=(l<<12|l>>>20)+o|0,u+=(l&o|~l&n)+h[2]+606105819|0,u=(u<<17|u>>>15)+l|0,n+=(u&l|~u&o)+h[3]-1044525330|0,n=(n<<22|n>>>10)+u|0,o+=(n&u|~n&l)+h[4]-176418897|0,o=(o<<7|o>>>25)+n|0,l+=(o&n|~o&u)+h[5]+1200080426|0,l=(l<<12|l>>>20)+o|0,u+=(l&o|~l&n)+h[6]-1473231341|0,u=(u<<17|u>>>15)+l|0,n+=(u&l|~u&o)+h[7]-45705983|0,n=(n<<22|n>>>10)+u|0,o+=(n&u|~n&l)+h[8]+1770035416|0,o=(o<<7|o>>>25)+n|0,l+=(o&n|~o&u)+h[9]-1958414417|0,l=(l<<12|l>>>20)+o|0,u+=(l&o|~l&n)+h[10]-42063|0,u=(u<<17|u>>>15)+l|0,n+=(u&l|~u&o)+h[11]-1990404162|0,n=(n<<22|n>>>10)+u|0,o+=(n&u|~n&l)+h[12]+1804603682|0,o=(o<<7|o>>>25)+n|0,l+=(o&n|~o&u)+h[13]-40341101|0,l=(l<<12|l>>>20)+o|0,u+=(l&o|~l&n)+h[14]-1502002290|0,u=(u<<17|u>>>15)+l|0,n+=(u&l|~u&o)+h[15]+1236535329|0,n=(n<<22|n>>>10)+u|0,o+=(n&l|u&~l)+h[1]-165796510|0,o=(o<<5|o>>>27)+n|0,l+=(o&u|n&~u)+h[6]-1069501632|0,l=(l<<9|l>>>23)+o|0,u+=(l&n|o&~n)+h[11]+643717713|0,u=(u<<14|u>>>18)+l|0,n+=(u&o|l&~o)+h[0]-373897302|0,n=(n<<20|n>>>12)+u|0,o+=(n&l|u&~l)+h[5]-701558691|0,o=(o<<5|o>>>27)+n|0,l+=(o&u|n&~u)+h[10]+38016083|0,l=(l<<9|l>>>23)+o|0,u+=(l&n|o&~n)+h[15]-660478335|0,u=(u<<14|u>>>18)+l|0,n+=(u&o|l&~o)+h[4]-405537848|0,n=(n<<20|n>>>12)+u|0,o+=(n&l|u&~l)+h[9]+568446438|0,o=(o<<5|o>>>27)+n|0,l+=(o&u|n&~u)+h[14]-1019803690|0,l=(l<<9|l>>>23)+o|0,u+=(l&n|o&~n)+h[3]-187363961|0,u=(u<<14|u>>>18)+l|0,n+=(u&o|l&~o)+h[8]+1163531501|0,n=(n<<20|n>>>12)+u|0,o+=(n&l|u&~l)+h[13]-1444681467|0,o=(o<<5|o>>>27)+n|0,l+=(o&u|n&~u)+h[2]-51403784|0,l=(l<<9|l>>>23)+o|0,u+=(l&n|o&~n)+h[7]+1735328473|0,u=(u<<14|u>>>18)+l|0,n+=(u&o|l&~o)+h[12]-1926607734|0,n=(n<<20|n>>>12)+u|0,o+=(n^u^l)+h[5]-378558|0,o=(o<<4|o>>>28)+n|0,l+=(o^n^u)+h[8]-2022574463|0,l=(l<<11|l>>>21)+o|0,u+=(l^o^n)+h[11]+1839030562|0,u=(u<<16|u>>>16)+l|0,n+=(u^l^o)+h[14]-35309556|0,n=(n<<23|n>>>9)+u|0,o+=(n^u^l)+h[1]-1530992060|0,o=(o<<4|o>>>28)+n|0,l+=(o^n^u)+h[4]+1272893353|0,l=(l<<11|l>>>21)+o|0,u+=(l^o^n)+h[7]-155497632|0,u=(u<<16|u>>>16)+l|0,n+=(u^l^o)+h[10]-1094730640|0,n=(n<<23|n>>>9)+u|0,o+=(n^u^l)+h[13]+681279174|0,o=(o<<4|o>>>28)+n|0,l+=(o^n^u)+h[0]-358537222|0,l=(l<<11|l>>>21)+o|0,u+=(l^o^n)+h[3]-722521979|0,u=(u<<16|u>>>16)+l|0,n+=(u^l^o)+h[6]+76029189|0,n=(n<<23|n>>>9)+u|0,o+=(n^u^l)+h[9]-640364487|0,o=(o<<4|o>>>28)+n|0,l+=(o^n^u)+h[12]-421815835|0,l=(l<<11|l>>>21)+o|0,u+=(l^o^n)+h[15]+530742520|0,u=(u<<16|u>>>16)+l|0,n+=(u^l^o)+h[2]-995338651|0,n=(n<<23|n>>>9)+u|0,o+=(u^(n|~l))+h[0]-198630844|0,o=(o<<6|o>>>26)+n|0,l+=(n^(o|~u))+h[7]+1126891415|0,l=(l<<10|l>>>22)+o|0,u+=(o^(l|~n))+h[14]-1416354905|0,u=(u<<15|u>>>17)+l|0,n+=(l^(u|~o))+h[5]-57434055|0,n=(n<<21|n>>>11)+u|0,o+=(u^(n|~l))+h[12]+1700485571|0,o=(o<<6|o>>>26)+n|0,l+=(n^(o|~u))+h[3]-1894986606|0,l=(l<<10|l>>>22)+o|0,u+=(o^(l|~n))+h[10]-1051523|0,u=(u<<15|u>>>17)+l|0,n+=(l^(u|~o))+h[1]-2054922799|0,n=(n<<21|n>>>11)+u|0,o+=(u^(n|~l))+h[8]+1873313359|0,o=(o<<6|o>>>26)+n|0,l+=(n^(o|~u))+h[15]-30611744|0,l=(l<<10|l>>>22)+o|0,u+=(o^(l|~n))+h[6]-1560198380|0,u=(u<<15|u>>>17)+l|0,n+=(l^(u|~o))+h[13]+1309151649|0,n=(n<<21|n>>>11)+u|0,o+=(u^(n|~l))+h[4]-145523070|0,o=(o<<6|o>>>26)+n|0,l+=(n^(o|~u))+h[11]-1120210379|0,l=(l<<10|l>>>22)+o|0,u+=(o^(l|~n))+h[2]+718787259|0,u=(u<<15|u>>>17)+l|0,n+=(l^(u|~o))+h[9]-343485551|0,n=(n<<21|n>>>11)+u|0,p[0]=o+p[0]|0,p[1]=n+p[1]|0,p[2]=u+p[2]|0,p[3]=l+p[3]|0}function a(p){var h=[],o;for(o=0;o<64;o+=4)h[o>>2]=p.charCodeAt(o)+(p.charCodeAt(o+1)<<8)+(p.charCodeAt(o+2)<<16)+(p.charCodeAt(o+3)<<24);return h}function i(p){var h=[],o;for(o=0;o<64;o+=4)h[o>>2]=p[o]+(p[o+1]<<8)+(p[o+2]<<16)+(p[o+3]<<24);return h}function d(p){var h=p.length,o=[1732584193,-271733879,-1732584194,271733878],n,u,l,P,j,Z;for(n=64;n<=h;n+=64)r(o,a(p.substring(n-64,n)));for(p=p.substring(n-64),u=p.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<u;n+=1)l[n>>2]|=p.charCodeAt(n)<<(n%4<<3);if(l[n>>2]|=128<<(n%4<<3),n>55)for(r(o,l),n=0;n<16;n+=1)l[n]=0;return P=h*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),j=parseInt(P[2],16),Z=parseInt(P[1],16)||0,l[14]=j,l[15]=Z,r(o,l),o}function f(p){var h=p.length,o=[1732584193,-271733879,-1732584194,271733878],n,u,l,P,j,Z;for(n=64;n<=h;n+=64)r(o,i(p.subarray(n-64,n)));for(p=n-64<h?p.subarray(n-64):new Uint8Array(0),u=p.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<u;n+=1)l[n>>2]|=p[n]<<(n%4<<3);if(l[n>>2]|=128<<(n%4<<3),n>55)for(r(o,l),n=0;n<16;n+=1)l[n]=0;return P=h*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),j=parseInt(P[2],16),Z=parseInt(P[1],16)||0,l[14]=j,l[15]=Z,r(o,l),o}function g(p){var h="",o;for(o=0;o<4;o+=1)h+=s[p>>o*8+4&15]+s[p>>o*8&15];return h}function k(p){var h;for(h=0;h<p.length;h+=1)p[h]=g(p[h]);return p.join("")}k(d("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function p(h,o){return h=h|0||0,h<0?Math.max(h+o,0):Math.min(h,o)}ArrayBuffer.prototype.slice=function(h,o){var n=this.byteLength,u=p(h,n),l=n,P,j,Z,X;return o!==t&&(l=p(o,n)),u>l?new ArrayBuffer(0):(P=l-u,j=new ArrayBuffer(P),Z=new Uint8Array(j),X=new Uint8Array(this,u,P),Z.set(X),j)}})();function S(p){return/[\u0080-\uFFFF]/.test(p)&&(p=unescape(encodeURIComponent(p))),p}function x(p,h){var o=p.length,n=new ArrayBuffer(o),u=new Uint8Array(n),l;for(l=0;l<o;l+=1)u[l]=p.charCodeAt(l);return h?u:n}function T(p){return String.fromCharCode.apply(null,new Uint8Array(p))}function U(p,h,o){var n=new Uint8Array(p.byteLength+h.byteLength);return n.set(new Uint8Array(p)),n.set(new Uint8Array(h),p.byteLength),n}function B(p){var h=[],o=p.length,n;for(n=0;n<o-1;n+=2)h.push(parseInt(p.substr(n,2),16));return String.fromCharCode.apply(String,h)}function M(){this.reset()}return M.prototype.append=function(p){return this.appendBinary(S(p)),this},M.prototype.appendBinary=function(p){this._buff+=p,this._length+=p.length;var h=this._buff.length,o;for(o=64;o<=h;o+=64)r(this._hash,a(this._buff.substring(o-64,o)));return this._buff=this._buff.substring(o-64),this},M.prototype.end=function(p){var h=this._buff,o=h.length,n,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l;for(n=0;n<o;n+=1)u[n>>2]|=h.charCodeAt(n)<<(n%4<<3);return this._finish(u,o),l=k(this._hash),p&&(l=B(l)),this.reset(),l},M.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},M.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},M.prototype.setState=function(p){return this._buff=p.buff,this._length=p.length,this._hash=p.hash,this},M.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},M.prototype._finish=function(p,h){var o=h,n,u,l;if(p[o>>2]|=128<<(o%4<<3),o>55)for(r(this._hash,p),o=0;o<16;o+=1)p[o]=0;n=this._length*8,n=n.toString(16).match(/(.*?)(.{0,8})$/),u=parseInt(n[2],16),l=parseInt(n[1],16)||0,p[14]=u,p[15]=l,r(this._hash,p)},M.hash=function(p,h){return M.hashBinary(S(p),h)},M.hashBinary=function(p,h){var o=d(p),n=k(o);return h?B(n):n},M.ArrayBuffer=function(){this.reset()},M.ArrayBuffer.prototype.append=function(p){var h=U(this._buff.buffer,p),o=h.length,n;for(this._length+=p.byteLength,n=64;n<=o;n+=64)r(this._hash,i(h.subarray(n-64,n)));return this._buff=n-64<o?new Uint8Array(h.buffer.slice(n-64)):new Uint8Array(0),this},M.ArrayBuffer.prototype.end=function(p){var h=this._buff,o=h.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u,l;for(u=0;u<o;u+=1)n[u>>2]|=h[u]<<(u%4<<3);return this._finish(n,o),l=k(this._hash),p&&(l=B(l)),this.reset(),l},M.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},M.ArrayBuffer.prototype.getState=function(){var p=M.prototype.getState.call(this);return p.buff=T(p.buff),p},M.ArrayBuffer.prototype.setState=function(p){return p.buff=x(p.buff,!0),M.prototype.setState.call(this,p)},M.ArrayBuffer.prototype.destroy=M.prototype.destroy,M.ArrayBuffer.prototype._finish=M.prototype._finish,M.ArrayBuffer.hash=function(p,h){var o=f(new Uint8Array(p)),n=k(o);return h?B(n):n},M})})(Ae)),Ae.exports}var Ls=Os();const Bs=Dt(Ls),re={CHUNK_SIZE:2*1024*1024,SIZE_UNITS:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],SIZE_MULTIPLIER:1024,TIME_UNITS:{MINUTE:60,HOUR:3600}};function Hs(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,c=>{const e=Math.random()*16|0;return(c==="x"?e:e&3|8).toString(16)})}function ke(c,e=2){if(c===0)return"0 B";if(c<0||!Number.isFinite(c))return"Invalid";const t=re.SIZE_MULTIPLIER,s=Math.max(0,e),r=Math.min(Math.floor(Math.log(c)/Math.log(t)),re.SIZE_UNITS.length-1),a=Math.max(0,r),i=c/t**a;return Number.isFinite(i)?`${i.toFixed(s)} ${re.SIZE_UNITS[r]}`:`${c} B`}function Ws(c,e=2){if(!Number.isFinite(c)||c<0||c===0)return"0 B/s";try{const t=ke(c,e);return t==="Invalid"?"0 B/s":`${t}/s`}catch(t){return console.error("Ê†ºÂºèÂåñÈÄüÂ∫¶Â§±Ë¥•:",t),"0 B/s"}}function Gs(c,e=!1){if(c<0)return"Invalid";if(c===0)return"0s";const t=Math.floor(c/re.TIME_UNITS.HOUR),s=Math.floor(c%re.TIME_UNITS.HOUR/re.TIME_UNITS.MINUTE),r=Math.floor(c%re.TIME_UNITS.MINUTE);if(e){const a=[];return t>0&&a.push(`${t} Â∞èÊó∂`),s>0&&a.push(`${s} ÂàÜÈíü`),r>0&&a.push(`${r} Áßí`),a.join(" ")||"0 Áßí"}return t>0?`${t}h ${s}m`:s>0?`${s}m ${r}s`:`${r}s`}const Xe=c=>new Promise(e=>{setTimeout(e,c)});async function Je(c,e){return new Promise((t,s)=>{const r=new Bs.ArrayBuffer,a=new FileReader,i=re.CHUNK_SIZE,d=Math.ceil(c.size/i);let f=0;const g=()=>{const k=f*i,S=Math.min(k+i,c.size);a.readAsArrayBuffer(c.slice(k,S))};a.onload=k=>{var S;try{const x=(S=k.target)==null?void 0:S.result;if(r.append(x),f++,e){const T=Math.round(f/d*100);e(T)}if(f<d)g();else{const T=r.end();t(T)}}catch(x){s(new Error(`MD5 ËÆ°ÁÆóÂ§±Ë¥•: ${x.message}`))}},a.onerror=()=>{s(new Error("Êñá‰ª∂ËØªÂèñÂ§±Ë¥•"))},g()})}class et{constructor(e=15,t=3e4){C(this,"dataPoints",[]);C(this,"windowSize");C(this,"windowTime");C(this,"smoothingFactor",.7);C(this,"lastSpeed",0);this.windowSize=e,this.windowTime=t}addData(e,t){if(!Number.isFinite(e)||e<0||!Number.isFinite(t)||t<=0){console.warn("Invalid data point:",{size:e,time:t});return}const s=Date.now();this.dataPoints.push({size:e,time:t,timestamp:s}),this.cleanup(s)}cleanup(e){const t=e-this.windowTime;this.dataPoints=this.dataPoints.filter(s=>s.timestamp>t),this.dataPoints.length>this.windowSize&&(this.dataPoints=this.dataPoints.slice(-this.windowSize))}getSpeed(){if(this.dataPoints.length===0)return 0;const e=this.dataPoints.slice(-Math.min(5,this.dataPoints.length));if(e.length===0)return 0;const t=e.reduce((a,i)=>a+i.size,0),s=e.reduce((a,i)=>a+i.time,0);if(s<=0||!Number.isFinite(s))return this.lastSpeed;const r=t/s*1e3;return!Number.isFinite(r)||r<0?(console.warn("Invalid instant speed calculated:",r),this.lastSpeed):(this.lastSpeed===0?this.lastSpeed=r:this.lastSpeed=this.smoothingFactor*r+(1-this.smoothingFactor)*this.lastSpeed,Math.max(0,Number.isFinite(this.lastSpeed)?this.lastSpeed:0))}getAverageSpeed(){if(this.dataPoints.length===0)return 0;const e=this.dataPoints.reduce((r,a)=>r+a.size,0),t=this.dataPoints.reduce((r,a)=>r+a.time,0);if(t<=0||!Number.isFinite(e)||!Number.isFinite(t))return 0;const s=e/t*1e3;return Number.isFinite(s)?Math.max(0,s):0}getSpeedInfo(){const e=this.getSpeed(),t=this.getAverageSpeed();return{current:e,average:t,formatted:{current:this.formatSpeedSafe(e),average:this.formatSpeedSafe(t)}}}formatSpeedSafe(e){if(!Number.isFinite(e)||e<0)return"0 B/s";const t=["B/s","KB/s","MB/s","GB/s","TB/s"],s=1024;if(e===0)return"0 B/s";const r=Math.min(Math.floor(Math.log(e)/Math.log(s)),t.length-1),a=e/s**Math.max(0,r);return Number.isFinite(a)?`${a.toFixed(2)} ${t[Math.max(0,r)]}`:"0 B/s"}reset(){this.dataPoints=[],this.lastSpeed=0}getStats(){return this.dataPoints.length===0?{dataPoints:0,oldestTimestamp:null,newestTimestamp:null,totalBytes:0,totalTime:0}:{dataPoints:this.dataPoints.length,oldestTimestamp:this.dataPoints[0].timestamp,newestTimestamp:this.dataPoints[this.dataPoints.length-1].timestamp,totalBytes:this.dataPoints.reduce((e,t)=>e+t.size,0),totalTime:this.dataPoints.reduce((e,t)=>e+t.time,0)}}}class we{static calculateOptimalChunkSize(e,t,s){const{minChunkSize:r,maxChunkSize:a,chunkSize:i}=s;let d=i;return t>0&&(d=Math.round(t*1024*3)),e<10*1024*1024?d=Math.min(d,1*1024*1024):e>1024*1024*1024&&(d=Math.max(d,5*1024*1024)),Math.max(r,Math.min(a,d))}}const F={RETRY:{MAX_DELAY:3e4,CHUNK_MAX_DELAY:1e4,BASE_DELAY:1e3,BACKOFF_MULTIPLIER:1.5,MAX_RETRIES:3},NETWORK:{ADJUST_INTERVAL:1e4,POLL_INTERVAL:50,QUALITY_THRESHOLDS:{GOOD:1e3,FAIR:100}},PROGRESS:{CHUNK_WEIGHT:90,MERGE_START:92,MERGE_END:95,COMPLETE:100},CONCURRENT:{POOR_NETWORK:2,FAIR_NETWORK:4,GOOD_NETWORK:10,DEFAULT_FILES:10,DEFAULT_CHUNKS:10},RETRYABLE_ERROR_KEYWORDS:["networkerror","timeouterror","aborterror","fetch","network","timeout","5"],UPLOAD:{TIMEOUT:6e4,CHUNK_SIZE:2*1024*1024,MIN_CHUNK_SIZE:512*1024,MAX_CHUNK_SIZE:20*1024*1024,MAX_FILESIZE:1*1024*1024*1024,MAX_FILES:500},COMPRESSION:{ENABLE_COMPRESSION:!0,COMPRESSION_QUALITY:.8},PREVIEW:{ENABLE_PREVIEW:!0,PREVIEW_MAX_WIDTH:200,PREVIEW_MAX_HEIGHT:200}};class Qs{constructor(){C(this,"taskAbortControllers",new Map);C(this,"chunkAbortControllers",new Map);C(this,"isPaused",O(!1));C(this,"pausedTasks",new Set);C(this,"getTask",()=>{})}pause(e){const t=this.getTask(e);!t||t.status!==w.UPLOADING||(this.abortTask(e),t.status=w.PAUSED,t.pausedTime=Date.now(),this.pausedTasks.add(e),console.log(`‰ªªÂä° ${t.file.name} Â∑≤ÊöÇÂÅú`))}resume(e){const t=this.getTask(e);!t||t.status!==w.PAUSED||(this.createAbortController(e),t.status=w.PENDING,t.resumeTime=Date.now(),this.pausedTasks.delete(e),console.log(`‰ªªÂä° ${t.file.name} Â∑≤ÊÅ¢Â§ç`))}cancel(e){const t=this.getTask(e);t&&(this.abortTask(e),t.status=w.CANCELLED,t.endTime=Date.now(),this.pausedTasks.delete(e),console.log(`‰ªªÂä° ${t.file.name} Â∑≤ÂèñÊ∂à`))}pauseAll(){this.isPaused.value=!0,this.taskAbortControllers.forEach((e,t)=>{this.pause(t)})}resumeAll(){this.isPaused.value=!1,Array.from(this.pausedTasks).forEach(t=>{this.resume(t)})}cancelAll(){this.taskAbortControllers.forEach((e,t)=>{this.cancel(t)}),this.taskAbortControllers.clear(),this.chunkAbortControllers.clear(),this.pausedTasks.clear()}createAbortController(e){const t=new AbortController;return this.taskAbortControllers.set(e,t),t}createChunkAbortController(e,t){const s=new AbortController;return this.chunkAbortControllers.has(e)||this.chunkAbortControllers.set(e,new Map),this.chunkAbortControllers.get(e).set(t,s),s}getTaskAbortSignal(e){var t;return(t=this.taskAbortControllers.get(e))==null?void 0:t.signal}getChunkAbortSignal(e,t){var a;const s=this.taskAbortControllers.get(e),r=(a=this.chunkAbortControllers.get(e))==null?void 0:a.get(t);if(s&&r){const i=new AbortController,d=()=>i.abort();return s.signal.addEventListener("abort",d),r.signal.addEventListener("abort",d),i.signal}return(s==null?void 0:s.signal)||(r==null?void 0:r.signal)}abortTask(e){const t=this.taskAbortControllers.get(e);t&&(t.abort(),this.taskAbortControllers.delete(e));const s=this.chunkAbortControllers.get(e);s&&(s.forEach(r=>r.abort()),this.chunkAbortControllers.delete(e))}cleanupTask(e){this.taskAbortControllers.delete(e),this.chunkAbortControllers.delete(e),this.pausedTasks.delete(e)}shouldPause(e){return this.isPaused.value||this.pausedTasks.has(e)}setTaskGetter(e){this.getTask=e}}class js{static async compressImage(e,t=.8,s=1920,r=1080){return new Promise(a=>{const i=document.createElement("canvas"),d=i.getContext("2d"),f=new Image;f.onload=()=>{let{width:g,height:k}=f;if(g>s||k>r){const S=Math.min(s/g,r/k);g*=S,k*=S}i.width=g,i.height=k,d.drawImage(f,0,0,g,k),i.toBlob(S=>{const x=new File([S],e.name,{type:e.type,lastModified:Date.now()});a(x)},e.type,t)},f.src=URL.createObjectURL(e)})}}class Ks{constructor(e){this.config=e}validate(e,t=0){const s=[],r=[];console.log(`üìù ÂºÄÂßãÈ™åËØÅ ${e.length} ‰∏™Êñá‰ª∂ÔºåÂΩìÂâçÂ∑≤Êúâ ${t} ‰∏™Êñá‰ª∂`);for(const a of e){const i=t+s.length,d=this.validateSingleFile(a,i);d?(r.push({file:a,reason:d}),console.warn(`‚ùå Êñá‰ª∂ ${a.name} È™åËØÅÂ§±Ë¥•: ${d}`)):(s.push(a),console.log(`‚úÖ Êñá‰ª∂ ${a.name} È™åËØÅÈÄöËøá (${s.length}/${e.length})`))}return console.log(`üìä È™åËØÅÁªìÊûú: ÈÄöËøá ${s.length} ‰∏™ÔºåÂ§±Ë¥• ${r.length} ‰∏™`),{valid:s,errors:r}}validateSingleFile(e,t){var s;return e.size===0?"Êñá‰ª∂‰∏∫Á©∫":this.config.maxFileSize&&e.size>this.config.maxFileSize?`Êñá‰ª∂Â§ßÂ∞èË∂ÖÈôê: ${ke(e.size)} > ${ke(this.config.maxFileSize)}`:this.isAcceptedType(e)?this.config.maxFiles&&t>=this.config.maxFiles?`Â∑≤ËææÂà∞ÊúÄÂ§ßÊñá‰ª∂Êï∞ÈáèÈôêÂà∂: ${this.config.maxFiles} (ÂΩìÂâç: ${t})`:null:`Êñá‰ª∂Á±ªÂûã‰∏çÊîØÊåÅ„ÄÇÊîØÊåÅ: ${(s=this.config.accept)==null?void 0:s.join(", ")}`}isAcceptedType(e){var i,d;if(!((i=this.config.accept)!=null&&i.length))return!0;const t=(d=e.name.split(".").pop())==null?void 0:d.toLowerCase(),s=e.type.toLowerCase(),r=t&&this.config.accept.some(f=>f.toLowerCase()===`.${t}`||f.toLowerCase()===t),a=this.config.accept.some(f=>f.toLowerCase()===s||f.includes("/")&&s.startsWith(f.split("/")[0]));return r||a}}class Vs{constructor(e=1e3,t=1800*1e3){C(this,"cache",new Map);C(this,"maxSize");C(this,"ttl");this.maxSize=e,this.ttl=t}set(e,t,s){if(this.cache.has(e)&&this.cache.delete(e),this.cache.size>=this.maxSize){const r=this.cache.keys().next().value;r!==void 0&&this.cache.delete(r)}this.cache.set(e,{value:t,timestamp:Date.now()+(s??this.ttl)})}get(e){const t=this.cache.get(e);return t?Date.now()>t.timestamp?(this.cache.delete(e),null):(this.cache.delete(e),this.cache.set(e,t),t.value):null}remove(e){return this.cache.delete(e)}removeMany(e){let t=0;return e.forEach(s=>{this.cache.delete(s)&&t++}),t}removeWhere(e){let t=0;const s=[];return this.cache.forEach((r,a)=>{e(a,r.value)&&s.push(a)}),s.forEach(r=>{this.cache.delete(r)&&t++}),t}has(e){return this.cache.has(e)}isValid(e){const t=this.cache.get(e);return t?Date.now()>t.timestamp?(this.cache.delete(e),!1):!0:!1}size(){return this.cache.size}keys(){return Array.from(this.cache.keys())}cleanup(){let e=0;const t=Date.now(),s=[];return this.cache.forEach((r,a)=>{t>r.timestamp&&s.push(a)}),s.forEach(r=>{this.cache.delete(r),e++}),e}touch(e,t){const s=this.cache.get(e);return s?(s.timestamp=Date.now()+(t??this.ttl),!0):!1}stats(){let e=null,t=null;return this.cache.forEach(s=>{const r=s.timestamp;(!e||r<e)&&(e=r),(!t||r>t)&&(t=r)}),{size:this.cache.size,maxSize:this.maxSize,hitRate:0,oldestTimestamp:e,newestTimestamp:t}}clear(){this.cache.clear()}export(){const e=[];return this.cache.forEach((t,s)=>{e.push([s,t.value,t.timestamp])}),e}import(e){for(this.clear(),e.forEach(([t,s,r])=>{r>Date.now()&&this.cache.set(t,{value:s,timestamp:r})});this.cache.size>this.maxSize;){const t=this.cache.keys().next().value;t!==void 0&&this.cache.delete(t)}}}class Zs{constructor(){C(this,"callbacks",{})}onFileStart(e){return this.callbacks.onFileStart=e,this}onFileProgress(e){return this.callbacks.onFileProgress=e,this}onFileSuccess(e){return this.callbacks.onFileSuccess=e,this}onFileError(e){return this.callbacks.onFileError=e,this}onFilePause(e){return this.callbacks.onFilePause=e,this}onFileResume(e){return this.callbacks.onFileResume=e,this}onFileCancel(e){return this.callbacks.onFileCancel=e,this}onTotalProgress(e){return this.callbacks.onTotalProgress=e,this}onAllComplete(e){return this.callbacks.onAllComplete=e,this}onAllError(e){return this.callbacks.onAllError=e,this}onSpeedChange(e){return this.callbacks.onSpeedChange=e,this}onQueueChange(e){return this.callbacks.onQueueChange=e,this}onChunkSuccess(e){return this.callbacks.onChunkSuccess=e,this}onChunkError(e){return this.callbacks.onChunkError=e,this}async emit(e,...t){const s=this.callbacks[e];s&&await s(...t)}getCallbacks(){return{...this.callbacks}}}class qs{constructor(e,t){this.config=e,this.progressCallback=t}async createChunks(e,t){const s=Math.ceil(e.file.size/t),r=[];!e.fileMD5&&this.config.enableDeduplication&&(e.fileMD5=await Je(e.file));for(let a=0;a<s;a++){const i=a*t,d=Math.min(i+t,e.file.size);r.push({index:a,start:i,end:d,size:d-i,blob:e.file.slice(i,d),status:G.PENDING,retryCount:0,uploadTime:0,etag:void 0,result:void 0,error:void 0,hash:void 0})}return e.chunks=r,e.totalChunks=s,e.uploadedChunks=0,r}async uploadChunk(e,t,s){const r=performance.now();try{t.status=G.UPLOADING;const a=this.config.chunkUploadTransformer({task:e,chunk:t,customParams:this.config.customParams}),i=a instanceof FormData,d={...this.config.headers,...i?{}:{"Content-Type":"application/json"}},f=await fetch(this.config.uploadChunkUrl,{method:"POST",headers:d,body:i?a:JSON.stringify(a),signal:s});if(!f.ok)throw new Error(`HTTP ${f.status}: ${f.statusText}`);const g=await f.json();return t.status=G.SUCCESS,t.result=g,t.uploadTime=performance.now()-r,this.progressCallback(t,t.size,t.uploadTime),g}catch(a){throw t.status=G.ERROR,t.error=a,a}}async mergeChunks(e,t){const s=this.config.mergeChunksTransformer({task:e,customParams:this.config.customParams}),r=s instanceof FormData,a={...this.config.headers,...r?{}:{"Content-Type":"application/json"}},i=await fetch(this.config.mergeChunksUrl,{method:"POST",headers:a,body:r?s:JSON.stringify(s),signal:t});if(!i.ok)throw new Error(`ÂêàÂπ∂ÂàÜÂùóÂ§±Ë¥•: ${i.status} ${i.statusText}`);return await i.json()}calculateOptimalChunkSize(e,t){return we.calculateOptimalChunkSize(e,t,this.config)}}class Ys{constructor(){C(this,"history",[]);C(this,"maxHistory",10);C(this,"smoothingFactor",.3);C(this,"historyTimeout",6e4);C(this,"lastEstimatedTime",0)}update(e,t){if(!Number.isFinite(e)||e<=0)return 0;if(!Number.isFinite(t)||t<=0)return this.lastEstimatedTime>0?this.lastEstimatedTime:0;const s=e/1024/t,r=this.exponentialSmoothing(s),a=this.applyTrendCorrection(r),i=this.applyBounds(a);return this.recordHistory(i),this.lastEstimatedTime=i,Math.max(0,Math.round(i))}exponentialSmoothing(e){return this.lastEstimatedTime===0?e:this.smoothingFactor*e+(1-this.smoothingFactor)*this.lastEstimatedTime}applyTrendCorrection(e){if(this.history.length<3)return e;const t=this.history.slice(-3),s=[];for(let a=1;a<t.length;a++)s.push(t[a-1].time-t[a].time);const r=s.reduce((a,i)=>a+i,0)/s.length;return r>0&&r<10?e-Math.abs(r)*.1:e}applyBounds(e){if(this.lastEstimatedTime===0)return e;const t=this.lastEstimatedTime*1.3;if(e>t)return console.log(`‚ö†Ô∏è Êó∂Èó¥Ë∑≥Ë∑ÉËøáÂ§ßÔºåÈôêÂà∂Â¢ûÂä†: ${e.toFixed(1)}s -> ${t.toFixed(1)}s`),t;if(e>10){const s=this.lastEstimatedTime*.7;if(e<s)return console.log(`‚ö†Ô∏è Êó∂Èó¥‰∏ãÈôçËøáÂø´ÔºåÈôêÂà∂ÂáèÂ∞ë: ${e.toFixed(1)}s -> ${s.toFixed(1)}s`),s}return e}recordHistory(e){this.history.push({time:e,timestamp:Date.now()}),this.history.length>this.maxHistory&&this.history.shift();const t=Date.now()-this.historyTimeout;this.history=this.history.filter(s=>s.timestamp>t)}getTrend(){if(this.history.length<2)return"stable";const e=this.history.slice(-3),t=e[0].time,s=e[e.length-1].time,r=t-s;return r>5?"decreasing":r<-5?"increasing":"stable"}reset(){this.history=[],this.lastEstimatedTime=0}getLastEstimatedTime(){return this.lastEstimatedTime}getHistory(){return[...this.history]}}class Xs{constructor(){C(this,"speedCalculator");C(this,"timeEstimator");C(this,"totalProgress",O(0));C(this,"uploadSpeed",O(0));C(this,"networkQuality",O("good"));this.speedCalculator=new et,this.timeEstimator=new Ys}updateFileProgress(e){if(e.totalChunks>0){const t=e.uploadedChunks/e.totalChunks*100;e.progress=Math.round(t),e.speed=this.uploadSpeed.value,e.chunks&&(e.uploadedSize=e.chunks.filter(s=>s.status===G.SUCCESS).reduce((s,r)=>s+r.size,0))}}updateChunkProgress(e,t,s){this.speedCalculator.addData(t,s);const r=this.speedCalculator.getSpeed();this.uploadSpeed.value=Number.isFinite(r)?r:0,this.updateNetworkQuality()}updateTotalProgress(e){if(e.length===0){this.totalProgress.value=0;return}const t=e.reduce((r,a)=>r+a.file.size,0),s=e.reduce((r,a)=>r+a.file.size*a.progress/100,0);this.totalProgress.value=Math.min(100,Math.round(s/t*100)||0)}calculateStats(e,t,s){const r=t.size,a=e.length,i=s.filter(p=>p.status===w.SUCCESS).length,d=s.filter(p=>p.status===w.ERROR).length,f=s.filter(p=>p.status===w.PAUSED).length,g=s.filter(p=>p.status===w.CANCELLED).length,k=r+a+i+d+f+g,S=[...e,...Array.from(t.values()),...s],x=S.reduce((p,h)=>p+h.file.size,0),T=S.reduce((p,h)=>p+h.file.size*h.progress/100,0),U=x-T,B=this.speedCalculator.getAverageSpeed(),M=this.timeEstimator.update(U,B);return{completed:i,active:r,pending:a,failed:d,paused:f,cancelled:g,total:k,totalSize:x,uploadedSize:T,averageSpeed:B,instantSpeed:this.uploadSpeed.value,estimatedTime:M,networkQuality:this.networkQuality.value}}updateNetworkQuality(){const e=this.uploadSpeed.value;e<50?this.networkQuality.value="poor":e<200?this.networkQuality.value="fair":this.networkQuality.value="good"}reset(){this.totalProgress.value=0,this.uploadSpeed.value=0,this.networkQuality.value="good",this.speedCalculator.reset(),this.timeEstimator.reset()}getAverageSpeed(){return this.speedCalculator.getAverageSpeed()}getTimeTrend(){return this.timeEstimator.getTrend()}}class Js{constructor(e){this.config=e}shouldRetry(e,t){if(e.retryCount>=(e.options.maxRetries||this.config.maxRetries))return!1;const s=t.message.toLowerCase();return F.RETRYABLE_ERROR_KEYWORDS.some(r=>s.includes(r))}calculateDelay(e,t=!1){const s=t?F.RETRY.CHUNK_MAX_DELAY:F.RETRY.MAX_DELAY,r=F.RETRY.BASE_DELAY*F.RETRY.BACKOFF_MULTIPLIER**e;return Math.min(r,s)}resetTask(e){e.status=w.PENDING,e.error=null,e.chunks.forEach(t=>{t.status===G.ERROR&&(t.status=G.PENDING,t.retryCount=0,t.error=void 0)})}}class er{constructor(){C(this,"priorities",{high:3,normal:2,low:1})}sort(e){e.sort((t,s)=>{const r=this.priorities[t.options.priority||"normal"],a=this.priorities[s.options.priority||"normal"];return r!==a?a-r:t.file.size-s.file.size})}isDuplicate(e,t){return t.some(s=>s.file.name===e.name&&s.file.size===e.size&&s.file.lastModified===e.lastModified)}createTask(e,t,s,r,a,i){return{id:Hs(),file:t,originalFile:e!==t?e:void 0,status:w.PENDING,progress:0,speed:0,chunks:[],uploadedChunks:0,totalChunks:0,retryCount:0,startTime:null,endTime:null,pausedTime:0,resumeTime:0,uploadedSize:0,result:null,error:null,fileMD5:"",options:{maxRetries:r.maxRetries,chunkSize:we.calculateOptimalChunkSize(t.size,a,r),priority:"normal",customParams:{},metadata:{preview:i,originalSize:e.size,compressedSize:t.size,compressionRatio:e.size>0?t.size/e.size:1},...s}}}}const _e={TIMEOUT:3e4,DEFAULT_CHUNK_SIZE:2*1024*1024};class tr{static generate(){return`
      ${this.getMD5Function()}
      ${this.getImageCompressionFunction()}
      ${this.getFileSlicingFunction()}
      ${this.getBatchProcessFunction()}
      ${this.getMessageHandler()}
    `}static getMD5Function(){return`
      // MD5 ËÆ°ÁÆó - ‰ΩøÁî® Web Crypto API
      async function calculateMD5(buffer) {
        try {
          // ‰ΩøÁî® SHA-256 (MD5 Âú®Áé∞‰ª£ÊµèËßàÂô®‰∏≠‰∏çÊé®ËçêÔºå‰ΩÜÂèØ‰ª•Áî®ÂÖ∂‰ªñÂìàÂ∏å)
          const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        } catch (error) {
          // ÈôçÁ∫ßÂà∞ÁÆÄÂçïÂìàÂ∏å
          let hash = 0;
          const view = new Uint8Array(buffer);
          for (let i = 0; i < view.length; i++) {
            hash = ((hash << 5) - hash + view[i]) & 0xffffffff;
          }
          return Math.abs(hash).toString(16).padStart(8, '0');
        }
      }
    `}static getImageCompressionFunction(){return`
      // ÂõæÁâáÂéãÁº©
      async function compressImage(imageData, options = {}) {
        try {
          const canvas = new OffscreenCanvas(
            options.width || 800, 
            options.height || 600
          );
          const ctx = canvas.getContext('2d');
          
          if (!ctx) {
            throw new Error('Êó†Ê≥ïËé∑Âèñ Canvas ‰∏ä‰∏ãÊñá');
          }
          
          const bitmap = await createImageBitmap(imageData);
          ctx.drawImage(bitmap, 0, 0, canvas.width, canvas.height);
          
          return await canvas.convertToBlob({ 
            type: options.type || 'image/jpeg', 
            quality: options.quality || 0.8 
          });
        } catch (error) {
          throw new Error('ÂõæÁâáÂéãÁº©Â§±Ë¥•: ' + error.message);
        }
      }
    `}static getFileSlicingFunction(){return`
      // Êñá‰ª∂ÂàáÁâá
      function sliceFile(file, chunkSize) {
        const chunks = [];
        const totalChunks = Math.ceil(file.size / chunkSize);
        
        for (let i = 0; i < totalChunks; i++) {
          const start = i * chunkSize;
          const end = Math.min(start + chunkSize, file.size);
          
          chunks.push({
            index: i,
            start,
            end,
            size: end - start
          });
        }
        
        return chunks;
      }
    `}static getBatchProcessFunction(){return`
      // ÊâπÈáèÂ§ÑÁêÜÊñá‰ª∂
      async function batchProcess(files, options) {
        const results = [];
        const total = files.length;
        
        for (let i = 0; i < total; i++) {
          try {
            const file = files[i];
            const result = { 
              file: file.name, 
              size: file.size 
            };

            // ËÆ°ÁÆó MD5
            if (options.calculateMD5) {
              const buffer = await file.arrayBuffer();
              result.md5 = await calculateMD5(buffer);
            }

            // ÁîüÊàêÂàáÁâá‰ø°ÊÅØ
            if (options.generateChunks) {
              const chunkSize = options.chunkSize || 2097152; // 2MB
              result.chunks = sliceFile(file, chunkSize);
              result.totalChunks = result.chunks.length;
            }

            results.push(result);
            
            // ÂèëÈÄÅËøõÂ∫¶
            self.postMessage({
              id: options.messageId,
              type: 'PROGRESS',
              success: true,
              progress: Math.round(((i + 1) / total) * 100)
            });

          } catch (error) {
            results.push({ 
              file: files[i].name, 
              error: error.message 
            });
          }
        }
        
        return results;
      }
    `}static getMessageHandler(){return`
      // Ê∂àÊÅØÂ§ÑÁêÜÂô®
      self.onmessage = async function(event) {
        const { id, type, payload } = event.data;
        
        try {
          let result;
          
          switch (type) {
            case 'MD5_CALCULATE': {
              const buffer = await payload.file.arrayBuffer();
              result = await calculateMD5(buffer);
              break;
            }
              
            case 'COMPRESS_IMAGE':
              result = await compressImage(payload.imageData, payload.options);
              break;
              
            case 'SLICE_FILE':
              result = sliceFile(payload.file, payload.chunkSize);
              break;
              
            case 'BATCH_PROCESS':
              result = await batchProcess(payload.files, { 
                ...payload.options, 
                messageId: id 
              });
              break;
              
            default:
              throw new Error('Êú™Áü•ÁöÑÊ∂àÊÅØÁ±ªÂûã: ' + type);
          }

          self.postMessage({
            id,
            type,
            success: true,
            data: result
          });

        } catch (error) {
          self.postMessage({
            id,
            type,
            success: false,
            error: error.message
          });
        }
      };
      
      // ÈîôËØØÂ§ÑÁêÜ
      self.onerror = function(error) {
        console.error('Worker ÂÜÖÈÉ®ÈîôËØØ:', error);
      };
    `}}class sr{constructor(e){C(this,"worker",null);C(this,"messageHandlers",new Map);C(this,"progressHandlers",new Map);C(this,"messageId",0);C(this,"isInitialized",!1);this.initWorker(e)}initWorker(e){try{if(e)this.worker=new Worker(e);else{const t=new Blob([tr.generate()],{type:"application/javascript"}),s=URL.createObjectURL(t);this.worker=new Worker(s),URL.revokeObjectURL(s)}this.setupWorkerHandlers(),this.isInitialized=!0}catch(t){console.warn("Worker ÂàùÂßãÂåñÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®‰∏ªÁ∫øÁ®ãÊ®°Âºè:",t),this.worker=null,this.isInitialized=!1}}setupWorkerHandlers(){this.worker&&(this.worker.onmessage=e=>{const t=e.data;if(t.type==="PROGRESS"){const r=this.progressHandlers.get(t.id);r&&t.progress!==void 0&&r(t.progress);return}const s=this.messageHandlers.get(t.id);s&&(s(t),this.cleanupHandlers(t.id))},this.worker.onerror=e=>{console.error("Worker ÈîôËØØ:",e),this.handleWorkerError(e)})}cleanupHandlers(e){this.messageHandlers.delete(e),this.progressHandlers.delete(e)}handleWorkerError(e){this.messageHandlers.forEach((t,s)=>{t({id:s,type:"MD5_CALCULATE",success:!1,error:e.message||"Worker ÂèëÁîüÈîôËØØ"})}),this.messageHandlers.clear(),this.progressHandlers.clear()}sendMessage(e,t,s){return new Promise((r,a)=>{const i=(++this.messageId).toString();if(!this.worker||!this.isInitialized){this.fallbackToMainThread(e,t,s).then(r).catch(a);return}const d=setTimeout(()=>{this.cleanupHandlers(i),a(new Error(`Worker ÂìçÂ∫îË∂ÖÊó∂ (${_e.TIMEOUT}ms)`))},_e.TIMEOUT);s&&this.progressHandlers.set(i,s),this.messageHandlers.set(i,f=>{clearTimeout(d),f.success?r(f.data):a(new Error(f.error||"Worker Â§ÑÁêÜÂ§±Ë¥•"))});try{this.worker.postMessage({id:i,type:e,payload:t})}catch(f){clearTimeout(d),this.cleanupHandlers(i),a(new Error(`ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•: ${f.message}`))}})}async fallbackToMainThread(e,t,s){switch(e){case"MD5_CALCULATE":return await this.calculateMD5InMainThread(t.file);case"SLICE_FILE":return this.sliceFileInMainThread(t.file,t.chunkSize);case"BATCH_PROCESS":return await this.batchProcessInMainThread(t.files,t.options,s);case"COMPRESS_IMAGE":throw new Error("‰∏ªÁ∫øÁ®ã‰∏çÊîØÊåÅÂõæÁâáÂéãÁº©ÔºåËØ∑‰ΩøÁî® Worker Ê®°Âºè");default:throw new Error(`‰∏çÊîØÊåÅÁöÑÊìç‰ΩúÁ±ªÂûã: ${e}`)}}async calculateMD5InMainThread(e){try{return await Je(e)}catch(t){throw new Error(`MD5 ËÆ°ÁÆóÂ§±Ë¥•: ${t.message}`)}}sliceFileInMainThread(e,t){const s=[],r=Math.ceil(e.size/t);for(let a=0;a<r;a++){const i=a*t,d=Math.min(i+t,e.size);s.push({index:a,start:i,end:d,size:d-i})}return s}async batchProcessInMainThread(e,t,s){const r=[],a=e.length;for(let i=0;i<a;i++)try{const d=e[i],f={file:d.name,size:d.size};if(t.calculateMD5&&(f.md5=await this.calculateMD5InMainThread(d)),t.generateChunks){const g=t.chunkSize||_e.DEFAULT_CHUNK_SIZE;f.chunks=this.sliceFileInMainThread(d,g),f.totalChunks=f.chunks.length}r.push(f),s&&s(Math.round((i+1)/a*100))}catch(d){r.push({file:e[i].name,error:d.message})}return r}async calculateMD5(e){return this.sendMessage("MD5_CALCULATE",{file:e})}async compressImage(e,t){return this.sendMessage("COMPRESS_IMAGE",{imageData:e,options:t})}async sliceFile(e,t){return this.sendMessage("SLICE_FILE",{file:e,chunkSize:t})}async batchProcess(e,t={}){return this.sendMessage("BATCH_PROCESS",{files:e,options:t},t.onProgress)}isAvailable(){return this.worker!==null&&this.isInitialized}getWorkerStatus(){return{available:this.isAvailable(),pendingMessages:this.messageHandlers.size,activeProgressTrackers:this.progressHandlers.size}}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.messageHandlers.clear(),this.progressHandlers.clear(),this.isInitialized=!1}reinitialize(e){this.terminate(),this.initWorker(e)}}class rr{constructor(e){C(this,"speedHistory",[]);C(this,"maxHistorySize",10);C(this,"currentNetworkInfo",{type:"unknown",downlink:10,rtt:100,effectiveType:"4g",saveData:!1});C(this,"adaptiveConfig");this.config=e,this.adaptiveConfig={chunkSize:e.chunkSize,maxConcurrentFiles:e.maxConcurrentFiles,maxConcurrentChunks:e.maxConcurrentChunks,retryDelay:e.retryDelay,timeout:e.timeout,lastUpdate:Date.now()},this.initNetworkListener()}initNetworkListener(){if(!("connection"in navigator))return;const e=navigator.connection;e&&(this.updateNetworkInfo(e),e.addEventListener("change",()=>{this.updateNetworkInfo(e),this.recalculateAdaptiveConfig()}))}updateNetworkInfo(e){this.currentNetworkInfo={type:e.type||"unknown",downlink:e.downlink||10,rtt:e.rtt||100,effectiveType:e.effectiveType||"4g",saveData:e.saveData||!1}}adaptToConnection(e){this.updateNetworkInfo(e),this.recalculateAdaptiveConfig(),this.config.maxConcurrentFiles=this.adaptiveConfig.maxConcurrentFiles,this.config.maxConcurrentChunks=this.adaptiveConfig.maxConcurrentChunks,this.config.chunkSize=this.adaptiveConfig.chunkSize}recalculateAdaptiveConfig(){const{effectiveType:e,downlink:t,rtt:s,saveData:r}=this.currentNetworkInfo,a={"slow-2g":{files:1,chunks:2,chunkSize:256*1024,retryDelay:5e3,timeout:6e4,maxConcurrentFiles:10,maxConcurrentChunks:10},"2g":{files:1,chunks:2,chunkSize:512*1024,retryDelay:3e3,timeout:45e3,maxConcurrentFiles:10,maxConcurrentChunks:10},"3g":{files:2,chunks:4,chunkSize:1024*1024,retryDelay:2e3,timeout:3e4,maxConcurrentFiles:10,maxConcurrentChunks:10},"4g":{files:3,chunks:6,chunkSize:2*1024*1024,retryDelay:1e3,timeout:2e4,maxConcurrentFiles:10,maxConcurrentChunks:10},"5g":{files:4,chunks:8,chunkSize:4*1024*1024,retryDelay:500,timeout:15e3,maxConcurrentFiles:10,maxConcurrentChunks:10}},i=a[e]||a["4g"];if(t<1?(i.files=Math.max(1,i.files-1),i.chunks=Math.max(2,i.chunks-2),i.chunkSize=Math.max(256*1024,i.chunkSize/2)):t>10&&(i.files=Math.min(6,i.files+1),i.chunks=Math.min(12,i.chunks+2),i.chunkSize=Math.min(8*1024*1024,i.chunkSize*2)),s>300?(i.chunks=Math.max(2,i.chunks-1),i.timeout*=1.5):s<50&&(i.chunks=Math.min(12,i.chunks+1)),r&&(i.files=1,i.chunks=Math.min(2,i.chunks),i.chunkSize=Math.min(512*1024,i.chunkSize)),this.speedHistory.length>0){const d=this.getAverageSpeed();d<100?(i.chunkSize=Math.min(512*1024,i.chunkSize),i.chunks=Math.min(3,i.chunks)):d>1e3&&(i.chunkSize=Math.min(8*1024*1024,i.chunkSize*1.5),i.chunks=Math.min(10,i.chunks+1))}i.files=Math.min(i.files,this.config.maxConcurrentFiles),i.chunks=Math.min(i.chunks,this.config.maxConcurrentChunks),i.chunkSize=Math.max(this.config.minChunkSize||F.UPLOAD.MIN_CHUNK_SIZE,Math.min(this.config.maxChunkSize||F.UPLOAD.MAX_CHUNK_SIZE,i.chunkSize)),this.adaptiveConfig={...i,lastUpdate:Date.now()}}getAdaptiveConfig(){Date.now()-this.adaptiveConfig.lastUpdate>5e3&&this.recalculateAdaptiveConfig();const e=this.evaluateNetworkQuality(),t=this.getRecommendedStrategy(e);return{...this.adaptiveConfig,networkQuality:e,recommendedStrategy:t}}evaluateNetworkQuality(){const{effectiveType:e,downlink:t,rtt:s}=this.currentNetworkInfo,r=this.getAverageSpeed();let a=0;return a+=({"slow-2g":0,"2g":1,"3g":2,"4g":3,"5g":4}[e]||3)*2,t>10?a+=3:t>5?a+=2:t>1&&(a+=1),s<100?a+=2:s<200&&(a+=1),r>500?a+=3:r>200?a+=2:r>100&&(a+=1),a>=10?"good":a>=5?"fair":"poor"}getRecommendedStrategy(e){return{good:"È´òÂπ∂ÂèëÂ§ßÂàÜÁâáÁ≠ñÁï•ÔºöÂª∫ËÆÆ‰ΩøÁî®ËæÉÂ§ßÂàÜÁâá(2-4MB)ÔºåÂ§öÂπ∂Âèë‰∏ä‰º†",fair:"ÂùáË°°Á≠ñÁï•ÔºöÂª∫ËÆÆ‰ΩøÁî®‰∏≠Á≠âÂàÜÁâá(1MB)ÔºåÈÄÇÂ∫¶Âπ∂Âèë",poor:"‰øùÂÆàÁ≠ñÁï•ÔºöÂª∫ËÆÆ‰ΩøÁî®Â∞èÂàÜÁâá(256-512KB)Ôºå‰ΩéÂπ∂ÂèëÔºåÂêØÁî®Êñ≠ÁÇπÁª≠‰º†"}[e]}getNetworkQuality(e){return this.addSpeedToHistory(e),e>F.NETWORK.QUALITY_THRESHOLDS.GOOD?"good":e>F.NETWORK.QUALITY_THRESHOLDS.FAIR?"fair":"poor"}addSpeedToHistory(e){this.speedHistory.push(e),this.speedHistory.length>this.maxHistorySize&&this.speedHistory.shift()}getAverageSpeed(){return this.speedHistory.length===0?0:this.speedHistory.reduce((t,s)=>t+s,0)/this.speedHistory.length}getConcurrentChunks(e){const t={poor:F.CONCURRENT.POOR_NETWORK,fair:F.CONCURRENT.FAIR_NETWORK,good:F.CONCURRENT.GOOD_NETWORK};return Math.min(this.adaptiveConfig.maxConcurrentChunks,t[e])}updateSpeed(e){this.addSpeedToHistory(e);const t=this.getAverageSpeed();Math.abs(e-t)/t>.5&&this.recalculateAdaptiveConfig()}getNetworkSummary(){const e=this.evaluateNetworkQuality();return{type:this.currentNetworkInfo.effectiveType,quality:e,downlink:this.currentNetworkInfo.downlink,rtt:this.currentNetworkInfo.rtt,averageSpeed:this.getAverageSpeed(),recommendation:this.getRecommendedStrategy(e)}}triggerAdaptation(){if("connection"in navigator){const e=navigator.connection;this.adaptToConnection(e)}}updateConfig(e){this.config=e,this.recalculateAdaptiveConfig()}reset(){this.speedHistory=[],this.adaptiveConfig.lastUpdate=0,this.recalculateAdaptiveConfig()}}class Fe{static async generateImagePreview(e,t=200,s=200){return new Promise((r,a)=>{const i=new FileReader;i.onload=d=>{var g;const f=new Image;f.onload=()=>{try{const k=document.createElement("canvas"),S=k.getContext("2d");if(!S){a(new Error("Êó†Ê≥ïËé∑Âèñ Canvas ‰∏ä‰∏ãÊñá"));return}const x=Math.min(t/f.width,s/f.height,1);k.width=f.width*x,k.height=f.height*x,S.drawImage(f,0,0,k.width,k.height);const T=k.toDataURL("image/jpeg",.8);r(T)}catch(k){a(k)}},f.onerror=()=>{a(new Error("ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•"))},f.src=(g=d.target)==null?void 0:g.result},i.onerror=()=>{a(new Error("Êñá‰ª∂ËØªÂèñÂ§±Ë¥•"))},i.readAsDataURL(e)})}static async generateVideoPreview(e,t=200,s=200,r=1){return new Promise((a,i)=>{const d=document.createElement("video"),f=URL.createObjectURL(e);d.preload="metadata",d.muted=!0,d.playsInline=!0;const g=()=>{URL.revokeObjectURL(f),d.remove()},k=setTimeout(()=>{g(),i(new Error("ËßÜÈ¢ëÈ¢ÑËßàÁîüÊàêË∂ÖÊó∂"))},1e4);d.onloadedmetadata=()=>{d.currentTime=Math.min(r,d.duration)},d.onseeked=()=>{try{clearTimeout(k);const S=document.createElement("canvas"),x=S.getContext("2d");if(!x){g(),i(new Error("Êó†Ê≥ïËé∑Âèñ Canvas ‰∏ä‰∏ãÊñá"));return}const T=Math.min(t/d.videoWidth,s/d.videoHeight,1);S.width=d.videoWidth*T,S.height=d.videoHeight*T,x.drawImage(d,0,0,S.width,S.height);const U=S.toDataURL("image/jpeg",.8);g(),a(U)}catch(S){g(),i(S)}},d.onerror=()=>{clearTimeout(k),g(),i(new Error("ËßÜÈ¢ëÂä†ËΩΩÂ§±Ë¥•"))},d.src=f})}static async batchGenerate(e,t=200,s=200){const r=e.map(async a=>{try{return a.type.startsWith("image/")?await this.generateImagePreview(a,t,s):a.type.startsWith("video/")?await this.generateVideoPreview(a,t,s):null}catch(i){return console.warn(`ÁîüÊàêÈ¢ÑËßàÂ§±Ë¥•: ${a.name}`,i),null}});return Promise.all(r)}static getFileIcon(e){var a;const t=e.type.toLowerCase();(a=e.name.split(".").pop())!=null&&a.toLowerCase();const s={"application/pdf":"üìÑ","application/msword":"üìù","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"üìù","application/vnd.ms-excel":"üìä","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"üìä","application/zip":"üóúÔ∏è","application/x-rar-compressed":"üóúÔ∏è","application/x-7z-compressed":"üóúÔ∏è",audio:"üéµ",default:"üìé"};if(s[t])return s[t];const r=t.split("/")[0];return s[r]?s[r]:s.default}static canGeneratePreview(e){return e.type.startsWith("image/")||e.type.startsWith("video/")}}class ar{constructor(e){C(this,"permits");C(this,"queue",[]);this.permits=e}async acquire(){return new Promise(e=>{this.permits>0?(this.permits--,e()):this.queue.push(e)})}release(){this.permits++;const e=this.queue.shift();e&&(this.permits--,e())}}class nr{constructor(e,t,s,r,a,i,d,f){C(this,"uploadPromise");C(this,"completed",!1);C(this,"aborted",!1);C(this,"isPausing",!1);this.task=e,this.config=t,this.chunkManager=s,this.cacheManager=r,this.retryStrategy=a,this.callbackManager=i,this.progressManager=d,this.uploadController=f}async start(){return this.uploadPromise=this.upload(),this.uploadPromise}async wait(){this.uploadPromise&&await this.uploadPromise}isCompleted(){return this.completed}isAborted(){return this.aborted}async upload(){try{if(this.checkIfShouldStop())return;if(this.initializeUpload(),await this.checkDeduplication()){this.handleSuccess();return}if(this.checkIfShouldStop())return;if(await this.createChunks(),await this.uploadChunks(),this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ‰ªªÂä° ${this.task.file.name} Âú®‰∏ä‰º†ÂàÜÁâáÂêéÂ§Ñ‰∫é${this.task.status}Áä∂ÊÄÅ`);return}const t=await this.mergeChunks();this.task.result=t,this.checkIfShouldStop()||this.handleSuccess()}catch(e){if(this.isAbortError(e)){console.log(`üõë ‰ªªÂä° ${this.task.file.name} Ë¢´‰∏≠Ê≠¢`),this.aborted=!0;return}await this.handleError(e)}finally{this.completed=!0,this.progressManager.updateFileProgress(this.task),this.cleanup()}}initializeUpload(){this.task.status=w.UPLOADING,this.task.startTime=Date.now(),this.callbackManager.emit("onFileStart",this.task)}checkIfShouldStop(){const e=this.task.status;return e===w.PAUSED||this.uploadController.shouldPause(this.task.id)?(e!==w.PAUSED&&this.markAsPaused(),!0):e===w.CANCELLED}markAsPaused(){this.task.status=w.PAUSED,this.task.pausedTime=Date.now(),this.isPausing=!0,this.config.enableResume&&this.config.enableCache&&this.saveProgress()}isAbortError(e){var t;return(e==null?void 0:e.name)==="AbortError"||(e==null?void 0:e.code)==="ABORT_ERR"||((t=e==null?void 0:e.message)==null?void 0:t.includes("aborted"))}async checkDeduplication(){if(!this.config.enableDeduplication||!this.config.checkFileUrl)return!1;const e=this.getCacheKey();if(this.config.enableCache&&this.cacheManager.get(e)==="uploaded")return console.log(`‚úÖ Êñá‰ª∂ ${this.task.file.name} ÂëΩ‰∏≠Êú¨Âú∞ÁºìÂ≠ò,Ë∑≥Ëøá‰∏ä‰º†`),!0;try{const t=this.config.checkFileTransformer({task:this.task,customParams:this.config.customParams}),s=this.uploadController.getTaskAbortSignal(this.task.id);if(!s)return console.warn("‚ö†Ô∏è Êó†Ê≥ïËé∑Âèñ AbortSignal,Ë∑≥ËøáÁßí‰º†Ê£ÄÊü•"),!1;const r=await fetch(this.config.checkFileUrl,{method:"POST",headers:this.getHeaders(t),body:this.getRequestBody(t),signal:s});if(!r.ok)return console.warn(`‚ö†Ô∏è Áßí‰º†Ê£ÄÊü•Â§±Ë¥•: ${r.status}`),!1;const a=await r.json();if((a==null?void 0:a.exists)===!0||(a==null?void 0:a.uploaded)===!0)return console.log(`‚úÖ Êñá‰ª∂ ${this.task.file.name} Â∑≤Â≠òÂú®‰∫éÊúçÂä°Á´Ø,ÂêØÁî®Áßí‰º†`),this.config.enableCache&&this.cacheManager.set(e,"uploaded"),a.fileInfo&&(this.task.result=a.fileInfo),!0}catch(t){this.isAbortError(t)||console.warn("‚ö†Ô∏è Áßí‰º†Ê£ÄÊü•Â§±Ë¥•:",t)}return!1}getCacheKey(){return`file_${this.task.file.name}_${this.task.file.size}_${this.task.file.lastModified}`}async createChunks(){if(this.task.chunks&&this.task.chunks.length>0){console.log(`‚ÑπÔ∏è ‰ªªÂä° ${this.task.file.name} Â∑≤Êúâ${this.task.chunks.length}‰∏™ÂàÜÁâá,Ë∑≥ËøáÂàõÂª∫`);return}const e=this.config.enableNetworkAdaptation?this.chunkManager.calculateOptimalChunkSize(this.task.file.size,this.progressManager.getAverageSpeed()):this.task.options.chunkSize||this.config.chunkSize;await this.chunkManager.createChunks(this.task,e),console.log(`üì¶ ‰ªªÂä° ${this.task.file.name} ÂàõÂª∫‰∫Ü ${this.task.totalChunks} ‰∏™ÂàÜÁâá,ÊØèÁâá${(e/1024/1024).toFixed(2)}MB`)}async uploadChunks(){const e=this.config.maxConcurrentChunks,t=new ar(e),s=[];console.log(`üöÄ ÂºÄÂßã‰∏ä‰º† ${this.task.chunks.length} ‰∏™ÂàÜÁâá,Âπ∂ÂèëÊï∞: ${e}`);for(let d=0;d<this.task.chunks.length;d++){const f=this.task.chunks[d];if(this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ‰ªªÂä° ${this.task.file.name} ÂÅúÊ≠¢ÂàõÂª∫Êñ∞ÁöÑÂàÜÁâá‰∏ä‰º†‰ªªÂä°`);break}if(f.status===G.SUCCESS){console.log(`‚úì ÂàÜÁâá ${f.index} Â∑≤‰∏ä‰º†ÊàêÂäü,Ë∑≥Ëøá`);continue}const g=this.uploadSingleChunk(f,t);s.push(g)}console.log(`‚è≥ Á≠âÂæÖ ${s.length} ‰∏™ÂàÜÁâá‰∏ä‰º†‰ªªÂä°ÂÆåÊàê...`),await Promise.allSettled(s);const r=this.task.chunks.filter(d=>d.status===G.SUCCESS).length,a=this.task.chunks.filter(d=>d.status===G.PENDING).length,i=this.task.chunks.filter(d=>d.status===G.ERROR).length;console.log(`üìä ÂàÜÁâá‰∏ä‰º†ÁªìÊûú: ÊàêÂäü${r}/${this.task.totalChunks}, ÂæÖ‰∏ä‰º†${a}, Â§±Ë¥•${i}`),this.isPausing&&this.config.enableResume&&this.config.enableCache&&(this.saveProgress(),console.log(`üíæ ‰ªªÂä° ${this.task.file.name} ËøõÂ∫¶Â∑≤‰øùÂ≠ò`))}async uploadSingleChunk(e,t){await t.acquire();try{if(this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ÂàÜÁâá ${e.index} ‰∏çÂºÄÂßã‰∏ä‰º†,‰ªªÂä°Â∑≤ÂÅúÊ≠¢`);return}const s=this.task.options.maxRetries||this.config.maxRetries;let r=null;for(let a=0;a<=s;a++)try{if(this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ÂàÜÁâá ${e.index} Âú®Á¨¨${a+1}Ê¨°Â∞ùËØïÂâçÊ£ÄÊµãÂà∞‰ªªÂä°ÊöÇÂÅú`),e.status!==G.SUCCESS&&(e.status=G.PENDING);return}const d=this.uploadController.createChunkAbortController(this.task.id,e.index).signal;console.log(`‚¨ÜÔ∏è ÂºÄÂßã‰∏ä‰º†ÂàÜÁâá ${e.index}/${this.task.totalChunks} (Â∞ùËØï ${a+1}/${s+1})`),await this.chunkManager.uploadChunk(this.task,e,d),this.task.uploadedChunks++,this.progressManager.updateFileProgress(this.task),await this.callbackManager.emit("onFileProgress",this.task),await this.callbackManager.emit("onChunkSuccess",this.task,e),console.log(`‚úÖ ÂàÜÁâá ${e.index} ‰∏ä‰º†ÊàêÂäü (${this.task.uploadedChunks}/${this.task.totalChunks})`);return}catch(i){if(r=i,this.isAbortError(i)){console.log(`üõë ÂàÜÁâá ${e.index} ‰∏ä‰º†Ë¢´‰∏≠Ê≠¢`),e.status!==G.SUCCESS&&(e.status=G.PENDING);return}if(e.error=i,console.error(`‚ùå ÂàÜÁâá ${e.index} ‰∏ä‰º†Â§±Ë¥• (Â∞ùËØï ${a+1}/${s+1}):`,i.message),a<s&&this.retryStrategy.shouldRetry(this.task,i)){const d=this.retryStrategy.calculateDelay(a,!0);if(console.log(`üîÑ ÂàÜÁâá ${e.index} Â∞ÜÂú® ${d}ms ÂêéÈáçËØï`),e.status=G.RETRYING,await Xe(d),this.checkIfShouldStop()){console.log(`‚è∏Ô∏è ÂàÜÁâá ${e.index} ÈáçËØïÂâçÊ£ÄÊµãÂà∞‰ªªÂä°ÊöÇÂÅú`),e.status=G.PENDING;return}continue}throw e.status=G.ERROR,await this.callbackManager.emit("onChunkError",this.task,e,i),i}if(r)throw r}finally{t.release()}}async mergeChunks(){console.log(`üîó ÂºÄÂßãÂêàÂπ∂ ${this.task.totalChunks} ‰∏™ÂàÜÁâá...`);const e=this.task.progress,t=Math.max(e,F.PROGRESS.MERGE_START);this.task.progress<t&&(this.task.progress=t,await this.callbackManager.emit("onFileProgress",this.task),console.log(`üìä ÂêàÂπ∂Èò∂ÊÆµÂºÄÂßã: ${this.task.progress.toFixed(2)}%`));const s=this.uploadController.getTaskAbortSignal(this.task.id);if(!s)throw new Error("Êó†Ê≥ïÂàõÂª∫ AbortSignal");try{const r=Math.max(this.task.progress,F.PROGRESS.MERGE_START+(F.PROGRESS.MERGE_END-F.PROGRESS.MERGE_START)*.4);this.task.progress<r&&(this.task.progress=r,await this.callbackManager.emit("onFileProgress",this.task),console.log(`üìä ÂêàÂπ∂ËØ∑Ê±Ç‰∏≠: ${this.task.progress.toFixed(2)}%`));const a=await this.chunkManager.mergeChunks(this.task,s),i=Math.max(this.task.progress,F.PROGRESS.MERGE_END);return this.task.progress<i&&(this.task.progress=i,await this.callbackManager.emit("onFileProgress",this.task),console.log(`üìä ÂêàÂπ∂Âç≥Â∞ÜÂÆåÊàê: ${this.task.progress.toFixed(2)}%`)),console.log("‚úÖ ÂàÜÁâáÂêàÂπ∂ÊàêÂäü"),a}catch(r){throw this.isAbortError(r)?new Error("ÂêàÂπ∂Êìç‰ΩúË¢´‰∏≠Ê≠¢"):(console.error("‚ùå ÂàÜÁâáÂêàÂπ∂Â§±Ë¥•:",r),r)}}handleSuccess(){this.task.progress=F.PROGRESS.COMPLETE||100,this.task.status=w.SUCCESS,this.task.endTime=Date.now();const e=this.task.endTime-(this.task.startTime||this.task.endTime),t=(this.task.file.size/1024/1024).toFixed(2),s=e>0?(this.task.file.size/1024/(e/1e3)).toFixed(2):"0";console.log(`‚úÖ ‰ªªÂä° ${this.task.file.name} ‰∏ä‰º†ÊàêÂäü (100%)`),console.log(`   - Êñá‰ª∂Â§ßÂ∞è: ${t}MB`),console.log(`   - ÊÄªËÄóÊó∂: ${(e/1e3).toFixed(2)}s`),console.log(`   - Âπ≥ÂùáÈÄüÂ∫¶: ${s}KB/s`),this.config.enableCache&&this.cacheManager.remove(`progress_${this.task.id}`),this.callbackManager.emit("onFileSuccess",this.task)}async handleError(e){this.task.status===w.UPLOADING&&(this.task.status=w.ERROR,this.task.error=e,this.task.endTime=Date.now(),console.error(`‚ùå ‰ªªÂä° ${this.task.file.name} ‰∏ä‰º†Â§±Ë¥•:`,e.message),await this.callbackManager.emit("onFileError",this.task,e))}saveProgress(){const e=`progress_${this.task.id}`,t={taskId:this.task.id,fileName:this.task.file.name,fileSize:this.task.file.size,uploadedChunks:this.task.uploadedChunks,totalChunks:this.task.totalChunks,uploadedSize:this.task.uploadedSize,progress:this.task.progress,status:this.task.status,pausedTime:this.task.pausedTime,chunks:this.task.chunks.map(s=>({index:s.index,start:s.start,end:s.end,size:s.size,status:s.status,etag:s.etag,hash:s.hash}))};this.cacheManager.set(e,t),console.log(`üíæ ‰øùÂ≠ò‰ªªÂä° ${this.task.file.name} ÁöÑËøõÂ∫¶: ${this.task.uploadedChunks}/${this.task.totalChunks} ‰∏™ÂàÜÁâá`)}cleanup(){this.uploadController.cleanupTask(this.task.id)}getHeaders(e){const t=e instanceof FormData;return{...this.config.headers,...t?{}:{"Content-Type":"application/json"}}}getRequestBody(e){return e instanceof FormData?e:JSON.stringify(e)}}const ir=({task:c,chunk:e,customParams:t={}})=>{const s=new FormData;return s.append("file",e.blob,c.file.name),s.append("chunkIndex",String(e.index)),s.append("chunkSize",String(e.size)),s.append("totalChunks",String(c.totalChunks)),s.append("fileMD5",c.fileMD5),s.append("fileName",c.file.name),s.append("fileSize",String(c.file.size)),s.append("taskId",c.id),Object.entries(t).forEach(([r,a])=>{s.append(r,String(a))}),s},or=({task:c,customParams:e={}})=>({fileMD5:c.fileMD5,fileName:c.file.name,fileSize:c.file.size,totalChunks:c.totalChunks,taskId:c.id,...e}),lr=({task:c,customParams:e={}})=>({fileMD5:c.fileMD5,fileName:c.file.name,fileSize:c.file.size,...e});class cr{constructor(e={}){C(this,"config");C(this,"callbackManager");C(this,"uploadController");C(this,"progressManager");C(this,"chunkManager");C(this,"cacheManager");C(this,"networkAdapter");C(this,"fileValidator");C(this,"taskQueueManager");C(this,"retryStrategy");C(this,"workerManager");C(this,"uploadQueue",O([]));C(this,"activeUploads",O(new Map));C(this,"completedUploads",O([]));C(this,"isUploading",O(!1));C(this,"isAddingFiles",O(!1));C(this,"addFilesPromise");C(this,"addFilesAbortController");C(this,"totalProgress",V(()=>this.progressManager.totalProgress.value));C(this,"uploadSpeed",V(()=>this.progressManager.uploadSpeed.value));C(this,"networkQuality",V(()=>this.progressManager.networkQuality.value));C(this,"isPaused",V(()=>this.uploadController.isPaused.value));C(this,"uploadStats",V(()=>this.progressManager.calculateStats(this.uploadQueue.value,this.activeUploads.value,this.completedUploads.value)));C(this,"speedCalculator",new et);C(this,"adaptiveConfig",{lastAdjustTime:0,adjustInterval:F.NETWORK.ADJUST_INTERVAL});this.config=this.mergeConfig(e),this.cacheManager=new Vs,this.callbackManager=new Zs,this.progressManager=new Xs,this.uploadController=new Qs,this.networkAdapter=new rr(this.config),this.fileValidator=new Ks(this.config),this.taskQueueManager=new er,this.retryStrategy=new Js(this.config),this.chunkManager=new qs(this.config,(t,s,r)=>this.progressManager.updateChunkProgress(t,s,r)),this.config.useWorker&&(this.workerManager=new sr),this.setupWatchers(),this.setupNetworkMonitoring()}mergeConfig(e){return{maxConcurrentFiles:F.CONCURRENT.DEFAULT_FILES,maxConcurrentChunks:F.CONCURRENT.DEFAULT_CHUNKS,chunkSize:F.UPLOAD.CHUNK_SIZE,minChunkSize:F.UPLOAD.MIN_CHUNK_SIZE,maxChunkSize:F.UPLOAD.MAX_CHUNK_SIZE,maxRetries:F.RETRY.MAX_RETRIES,retryDelay:F.RETRY.BASE_DELAY,retryBackoff:F.RETRY.BACKOFF_MULTIPLIER,uploadChunkUrl:"",mergeChunksUrl:"",checkFileUrl:"",headers:{},timeout:F.UPLOAD.TIMEOUT,customParams:{},maxFileSize:F.UPLOAD.MAX_FILESIZE,maxFiles:F.UPLOAD.MAX_FILES,enableResume:!0,enableDeduplication:!1,useWorker:!0,enableCache:!0,enableNetworkAdaptation:!0,enableSmartRetry:!0,enableCompression:F.COMPRESSION.ENABLE_COMPRESSION,compressionQuality:F.COMPRESSION.COMPRESSION_QUALITY,enablePreview:F.PREVIEW.ENABLE_PREVIEW,previewMaxWidth:F.PREVIEW.PREVIEW_MAX_WIDTH,previewMaxHeight:F.PREVIEW.PREVIEW_MAX_HEIGHT,chunkUploadTransformer:ir,mergeChunksTransformer:or,checkFileTransformer:lr,...e}}updateConfig(e){return this.config={...this.config,...e},console.log("üìù ÈÖçÁΩÆÂ∑≤Êõ¥Êñ∞",this.config),"enableNetworkAdaptation"in e&&this.setupNetworkMonitoring(),this}setChunkUploadTransformer(e){return this.config.chunkUploadTransformer=e,this}setMergeChunksTransformer(e){return this.config.mergeChunksTransformer=e,this}setCheckFileTransformer(e){return this.config.checkFileTransformer=e,this}setTransformers(e){return e.chunkUpload&&(this.config.chunkUploadTransformer=e.chunkUpload),e.mergeChunks&&(this.config.mergeChunksTransformer=e.mergeChunks),e.checkFile&&(this.config.checkFileTransformer=e.checkFile),this}setupWatchers(){de([this.uploadQueue,this.activeUploads,this.completedUploads],()=>{this.callbackManager.emit("onQueueChange",this.uploadStats.value),this.progressManager.updateTotalProgress(this.getAllTasks()),this.config.enableNetworkAdaptation&&this.adjustPerformance()},{deep:!0}),de(this.uploadSpeed,e=>{this.callbackManager.emit("onSpeedChange",e)}),de(this.totalProgress,e=>{this.callbackManager.emit("onTotalProgress",e,this.uploadStats.value)})}setupNetworkMonitoring(){if(!this.config.enableNetworkAdaptation||!("connection"in navigator))return;const e=navigator.connection,t=()=>this.networkAdapter.adaptToConnection(e);e==null||e.addEventListener("change",t),t()}adjustPerformance(){if(!this.config.enableNetworkAdaptation)return;const e=Date.now();if(e-this.adaptiveConfig.lastAdjustTime<this.adaptiveConfig.adjustInterval)return;this.adaptiveConfig.lastAdjustTime=e;const t=this.uploadSpeed.value,s=this.activeUploads.value.size;t<50&&s>1?(this.config.maxConcurrentFiles=Math.max(1,this.config.maxConcurrentFiles-1),this.config.maxConcurrentChunks=Math.max(2,this.config.maxConcurrentChunks-1),console.log(`üìâ ÁΩëÁªúÈÄüÂ∫¶ÊÖ¢,Ë∞ÉÊï¥Âπ∂ÂèëÊï∞: Êñá‰ª∂=${this.config.maxConcurrentFiles}, ÂàÜÁâá=${this.config.maxConcurrentChunks}`)):t>500&&s===this.config.maxConcurrentFiles&&(this.config.maxConcurrentFiles=Math.min(6,this.config.maxConcurrentFiles+1),this.config.maxConcurrentChunks=Math.min(12,this.config.maxConcurrentChunks+1),console.log(`üìà ÁΩëÁªúÈÄüÂ∫¶Âø´,Ë∞ÉÊï¥Âπ∂ÂèëÊï∞: Êñá‰ª∂=${this.config.maxConcurrentFiles}, ÂàÜÁâá=${this.config.maxConcurrentChunks}`));const r=this.networkAdapter.getAdaptiveConfig();r.chunkSize&&(this.config.chunkSize=r.chunkSize)}async addFiles(e,t={}){if(this.isAddingFiles.value&&this.addFilesAbortController&&(console.log("‚ö†Ô∏è Ê≠£Âú®Ê∑ªÂä†Êñá‰ª∂ÔºåÂèñÊ∂à‰πãÂâçÁöÑÊìç‰Ωú"),this.addFilesAbortController.abort(),this.addFilesPromise))try{await this.addFilesPromise}catch{}this.isAddingFiles.value=!0,this.addFilesAbortController=new AbortController,this.addFilesPromise=this.doAddFiles(e,t,this.addFilesAbortController.signal);try{await this.addFilesPromise}finally{this.isAddingFiles.value=!1,this.addFilesAbortController=void 0,this.addFilesPromise=void 0}return this}async doAddFiles(e,t,s){const r=this.normalizeFiles(e),a=this.uploadQueue.value.length+this.activeUploads.value.size,{valid:i}=this.fileValidator.validate(r,a);if(i.length===0){console.log("‚ö†Ô∏è Ê≤°ÊúâÊúâÊïàÊñá‰ª∂");return}console.log(`üìÅ ÂºÄÂßãÂ§ÑÁêÜ ${i.length} ‰∏™Êñá‰ª∂...`);try{if(await this.batchAddFiles(i,t,s),s!=null&&s.aborted){console.log("‚ö†Ô∏è Êñá‰ª∂Ê∑ªÂä†Ë¢´‰∏≠Êñ≠");return}this.taskQueueManager.sort(this.uploadQueue.value),console.log(`‚úÖ Êñá‰ª∂Â§ÑÁêÜÂÆåÊàêÔºåÂÖ± ${i.length} ‰∏™Êñá‰ª∂`)}catch(d){if(s!=null&&s.aborted)console.log("‚ö†Ô∏è Êñá‰ª∂Ê∑ªÂä†Ë¢´ÂèñÊ∂à");else throw console.error("‚ùå Êñá‰ª∂Ê∑ªÂä†Â§±Ë¥•:",d),d}}async createSingleTask(e,t){try{const s=await this.processFileOptimized(e),r=this.taskQueueManager.createTask(e,s,t,this.config,this.speedCalculator.getAverageSpeed());return this.config.enablePreview&&this.generatePreviewAsync(s).then(a=>{}).catch(()=>{}),r}catch(s){return console.error(`ÂàõÂª∫‰ªªÂä°Â§±Ë¥•: ${e.name}`,s),null}}async batchAddFiles(e,t,s){this.config.useWorker&&this.workerManager&&e.length>20?await this.batchAddFilesWithWorker(e,t,s):await this.batchAddFilesInMainThread(e,t,s,10,10)}async batchAddFilesInMainThread(e,t,s,r=10,a=10){const i=[],d=Date.now();for(let g=0;g<e.length;g+=r){if(s!=null&&s.aborted){console.log("‚ö†Ô∏è Êñá‰ª∂Ê∑ªÂä†Ë¢´ÂèñÊ∂à");break}const k=e.slice(g,g+r),S=[];if(await Promise.all(k.map(async x=>{if(!(s!=null&&s.aborted)){if(this.isFileDuplicate(x)){console.warn(`‚ö†Ô∏è Êñá‰ª∂Â∑≤Â≠òÂú®: ${x.name}`);return}try{const T=await this.createSingleTask(x,t);T&&S.push(T)}catch(T){console.error(`Â§ÑÁêÜÊñá‰ª∂Â§±Ë¥•: ${x.name}`,T)}}})),i.push(...S),i.length>=50||g+r>=e.length){this.uploadQueue.value.push(...i),i.length=0;const x=Math.min(g+r,e.length);console.log(`üìä Â∑≤Â§ÑÁêÜ ${x}/${e.length} ‰∏™Êñá‰ª∂`)}g+r<e.length&&await this.yieldToMain(a)}i.length>0&&this.uploadQueue.value.push(...i);const f=Date.now()-d;console.log(`‚è±Ô∏è Êñá‰ª∂Â§ÑÁêÜËÄóÊó∂: ${(f/1e3).toFixed(2)}s`)}async generatePreviewAsync(e){if(!(!this.config.enablePreview||!Fe.canGeneratePreview(e)))return new Promise(t=>{const s=async()=>{try{if(e.type.startsWith("image/")){const r=await Fe.generateImagePreview(e);t(r)}else if(e.type.startsWith("video/")){const r=await Fe.generateVideoPreview(e);t(r)}else t(void 0)}catch(r){console.warn("‚ö†Ô∏è ÁîüÊàêÈ¢ÑËßàÂ§±Ë¥•:",r),t(void 0)}};"requestIdleCallback"in window?requestIdleCallback(s):setTimeout(s,100)})}yieldToMain(e=0){return new Promise(t=>{"requestIdleCallback"in window&&e===0?requestIdleCallback(()=>t()):setTimeout(t,e)})}async batchAddFilesWithWorker(e,t,s){const a=[];try{for(let i=0;i<e.length;i+=50){if(s!=null&&s.aborted){console.log("‚ö†Ô∏è Êñá‰ª∂Ê∑ªÂä†Ë¢´ÂèñÊ∂à");break}const d=e.slice(i,i+50),f=await this.workerManager.batchProcess(d,{calculateMD5:this.config.enableDeduplication,generateChunks:!1,onProgress:k=>{k%20===0&&console.log(`üì¶ ÊâπÊ¨° ${Math.floor(i/50)+1} Â§ÑÁêÜËøõÂ∫¶: ${k}%`)}}),g=await this.createTasksBatch(d,f,t,s);a.push(...g),(a.length>=100||i+50>=e.length)&&(this.uploadQueue.value.push(...a),a.length=0),await this.yieldToMain()}a.length>0&&this.uploadQueue.value.push(...a)}catch(i){console.error("‚ö†Ô∏è Worker ÊâπÂ§ÑÁêÜÂ§±Ë¥•:",i);const d=e.slice(a.length);d.length>0&&await this.batchAddFilesInMainThread(d,t,s,10,10)}}async createTasksBatch(e,t,s,r){const a=[];for(let i=0;i<e.length&&!(r!=null&&r.aborted);i++){const d=e[i],f=t[i];if(f.error){console.warn(`‚ö†Ô∏è Êñá‰ª∂Â§ÑÁêÜÂ§±Ë¥•: ${d.name}`,f.error);continue}if(this.isFileDuplicate(d)){console.warn(`‚ö†Ô∏è Êñá‰ª∂Â∑≤Â≠òÂú®: ${d.name}`);continue}const g=await this.processFileOptimized(d),k=this.taskQueueManager.createTask(d,g,s,this.config,this.speedCalculator.getAverageSpeed(),void 0);f.md5&&(k.options.metadata={...k.options.metadata,md5:f.md5}),a.push(k)}return a}isFileDuplicate(e){const t=`${e.name}_${e.size}_${e.lastModified}`;return this.getAllTasks().some(s=>`${s.file.name}_${s.file.size}_${s.file.lastModified}`===t)}async processFileOptimized(e){if(e.size<1024*1024||!e.type.startsWith("image/")||!this.config.enableCompression||e.size<10*1024*1024)return e;try{return await js.compressImage(e,this.config.compressionQuality,this.config.previewMaxWidth,this.config.previewMaxHeight)}catch(t){return console.warn("‚ö†Ô∏è Êñá‰ª∂ÂéãÁº©Â§±Ë¥•:",t),e}}normalizeFiles(e){if(e instanceof File)return[e];if(e instanceof FileList)return Array.from(e);if(Array.isArray(e))return e;throw new Error("‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Á±ªÂûã")}async start(){if(this.uploadQueue.value.length===0&&this.activeUploads.value.size===0)return await this.callbackManager.emit("onAllComplete",[]),this;this.isUploading.value=!0,this.speedCalculator.reset();try{await this.processQueue(),await this.handleUploadComplete()}catch(e){await this.callbackManager.emit("onAllError",e)}finally{this.isUploading.value=!1}return this}async processQueue(){const e=[];for(;this.uploadQueue.value.length>0||this.activeUploads.value.size>0;){if(this.uploadController.isPaused.value){console.log("‚è∏Ô∏è Ê£ÄÊµãÂà∞ÊöÇÂÅú‰ø°Âè∑,Á≠âÂæÖÊâÄÊúâÊ¥ªË∑É‰ªªÂä°ÂÆåÊàê..."),await Promise.allSettled(e.map(t=>t.wait())),console.log("‚úÖ ÊâÄÊúâÊ¥ªË∑É‰ªªÂä°Â∑≤ÂÆåÊàê,ÊöÇÂÅúÁîüÊïà");return}for(;this.uploadQueue.value.length>0&&this.activeUploads.value.size<this.config.maxConcurrentFiles&&!this.uploadController.isPaused.value;){const t=this.uploadQueue.value.shift();console.log(`üöÄ ÂêØÂä®‰ªªÂä°: ${t.file.name} (${(t.file.size/1024/1024).toFixed(2)}MB)`),this.uploadController.createAbortController(t.id);const s=new nr(t,{...this.config,getOptimalChunkSize:r=>this.config.enableNetworkAdaptation?we.calculateOptimalChunkSize(r,this.speedCalculator.getAverageSpeed(),this.config):t.options.chunkSize||this.config.chunkSize,workerManager:this.workerManager,getNetworkConfig:()=>this.networkAdapter.getAdaptiveConfig()},this.chunkManager,this.cacheManager,this.retryStrategy,this.callbackManager,this.progressManager,this.uploadController);this.activeUploads.value.set(t.id,t),e.push(s),s.start().then(()=>{this.activeUploads.value.delete(t.id),this.completedUploads.value.some(r=>r.id===t.id)||this.completedUploads.value.push(t),this.uploadController.cleanupTask(t.id)})}if(this.activeUploads.value.size>0){const t=e.filter(s=>!s.isCompleted());t.length>0&&await Promise.race(t.map(s=>s.wait()))}await Xe(F.NETWORK.POLL_INTERVAL)}console.log("‚è≥ Á≠âÂæÖÊâÄÊúâ‰ªªÂä°ÂÆåÊàê..."),await Promise.allSettled(e.map(t=>t.wait())),console.log("‚úÖ ÊâÄÊúâ‰ªªÂä°Â∑≤ÂÆåÊàê")}async handleUploadComplete(){const e=this.completedUploads.value,t=e.filter(a=>a.status===w.SUCCESS),s=e.filter(a=>a.status===w.ERROR),r=e.filter(a=>a.status===w.PAUSED);console.log(`üìä ‰∏ä‰º†ÁªüËÆ°: ÊàêÂäü${t.length}, Â§±Ë¥•${s.length}, ÊöÇÂÅú${r.length}`),s.length>0?await this.callbackManager.emit("onAllError",new Error(`${s.length}/${e.length} ‰∏™Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•`)):r.length===0&&await this.callbackManager.emit("onAllComplete",t)}pause(e){const t=this.getTask(e);return t?(console.log(`‚è∏Ô∏è ÊöÇÂÅú‰ªªÂä°: ${t.file.name}`),this.uploadController.pause(e),t.status===w.UPLOADING&&(t.status=w.PAUSED,t.pausedTime=Date.now(),this.config.enableResume&&this.config.enableCache&&(this.saveTaskProgress(t),console.log(`üíæ Â∑≤‰øùÂ≠ò‰ªªÂä°ËøõÂ∫¶: ${t.file.name} (${t.uploadedChunks}/${t.totalChunks})`)),this.callbackManager.emit("onFilePause",t)),this):(console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${e}`),this)}resume(e){const t=this.getTask(e);if(!t)return console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${e}`),this;if(t.status!==w.PAUSED)return console.warn(`‚ö†Ô∏è ‰ªªÂä° ${t.file.name} ‰∏çÊòØÊöÇÂÅúÁä∂ÊÄÅ,Êó†Ê≥ïÊÅ¢Â§ç`),this;console.log(`‚ñ∂Ô∏è ÊÅ¢Â§ç‰ªªÂä°: ${t.file.name}`),this.config.enableResume&&this.config.enableCache&&(this.restoreTaskProgress(t),console.log(`üìÇ ÊÅ¢Â§ç‰ªªÂä°ËøõÂ∫¶: ${t.file.name} (${t.uploadedChunks}/${t.totalChunks})`)),this.uploadController.resume(e),t.status=w.PENDING;const s=t.pausedTime?Date.now()-t.pausedTime:0;return t.pausedTime=0,console.log(`‚ÑπÔ∏è ‰ªªÂä° ${t.file.name} Â∑≤ÊöÇÂÅú ${(s/1e3).toFixed(2)}s`),this.completedUploads.value=this.completedUploads.value.filter(r=>r.id!==e),!this.uploadQueue.value.some(r=>r.id===e)&&!this.activeUploads.value.has(e)&&this.uploadQueue.value.unshift(t),this.callbackManager.emit("onFileResume",t),this.isUploading.value||this.start(),this}async pauseAll(){if(console.log("‚è∏Ô∏è ÂáÜÂ§áÊöÇÂÅúÊâÄÊúâ‰∏ä‰º†"),this.isAddingFiles.value&&(console.log("‚ö†Ô∏è Ê≠£Âú®Ê∑ªÂä†Êñá‰ª∂ÔºåÂÖà‰∏≠Êñ≠Ê∑ªÂä†Êìç‰Ωú"),this.addFilesAbortController&&this.addFilesAbortController.abort(),this.addFilesPromise))try{await Promise.race([this.addFilesPromise,new Promise(e=>setTimeout(e,1e3))])}catch{}return this.uploadController.pauseAll(),await this.batchPauseTasks(),console.log("‚úÖ ÊâÄÊúâ‰∏ä‰º†Â∑≤ÊöÇÂÅú"),this}async batchPauseTasks(){const e=[],t=[],s=[...Array.from(this.activeUploads.value.values()),...this.uploadQueue.value],r=[];s.forEach(i=>{(i.status===w.UPLOADING||i.status===w.PENDING)&&r.push(()=>{i.status=w.PAUSED,i.pausedTime=Date.now(),e.push(i),this.config.enableResume&&this.config.enableCache&&t.push(i)})});const a=50;for(let i=0;i<r.length;i+=a)r.slice(i,i+a).forEach(f=>f()),i+a<r.length&&await this.yieldToMain(0);t.length>0&&this.batchSaveTaskProgress(t).catch(console.error),e.length>0&&this.batchEmitCallbacks("onFilePause",e).catch(console.error)}async batchEmitCallbacks(e,t){for(let r=0;r<t.length;r+=20){const a=t.slice(r,r+20);await new Promise(i=>{const d=()=>{a.forEach(f=>{switch(e){case"onFilePause":this.callbackManager.emit("onFilePause",f);break;case"onFileResume":this.callbackManager.emit("onFileResume",f);break;case"onFileCancel":this.callbackManager.emit("onFileCancel",f);break;case"onFileStart":this.callbackManager.emit("onFileStart",f);break;case"onFileSuccess":this.callbackManager.emit("onFileSuccess",f);break;case"onFileError":this.callbackManager.emit("onFileError",f,f.error||new Error("Unknown error"));break;default:console.warn(`Unknown event: ${e}`)}}),i()};"requestIdleCallback"in window?requestIdleCallback(d):setTimeout(d,0)})}}async batchSaveTaskProgress(e){for(let s=0;s<e.length;s+=10){const r=e.slice(s,s+10);await new Promise(a=>{const i=()=>{r.forEach(d=>this.saveTaskProgress(d)),a()};"requestIdleCallback"in window?requestIdleCallback(i):setTimeout(i,0)})}}resumeAll(){console.log("‚ñ∂Ô∏è ÊÅ¢Â§çÊâÄÊúâ‰∏ä‰º†");const e=[],t=this.completedUploads.value.filter(i=>i.status===w.PAUSED);e.push(...t);const s=this.uploadQueue.value.filter(i=>i.status===w.PAUSED);if(e.push(...s),this.activeUploads.value.forEach(i=>{i.status===w.PAUSED&&e.push(i)}),e.length===0)return console.log("‚ö†Ô∏è Ê≤°ÊúâÊöÇÂÅúÁöÑ‰ªªÂä°"),this;console.log(`üìã ÊâæÂà∞ ${e.length} ‰∏™ÊöÇÂÅúÁöÑ‰ªªÂä°`);const r=[];this.config.enableResume&&this.config.enableCache&&e.forEach(i=>{r.push(i)}),r.length>0&&this.batchRestoreTaskProgress(r);const a=[];return e.forEach(i=>{i.status=w.PENDING,i.pausedTime=0,this.uploadController.resume(i.id),a.push(i)}),this.reorganizeTasks(a),this.uploadController.resumeAll(),Promise.resolve().then(()=>{a.forEach(i=>{this.callbackManager.emit("onFileResume",i)})}),this.isUploading.value||this.start(),console.log(`‚úÖ Â∑≤ÊÅ¢Â§ç ${a.length} ‰∏™‰ªªÂä°`),this}async batchRestoreTaskProgress(e){for(let s=0;s<e.length;s+=10){const r=e.slice(s,s+10);await new Promise(a=>{const i=()=>{r.forEach(d=>this.restoreTaskProgress(d)),a()};"requestIdleCallback"in window?requestIdleCallback(i):setTimeout(i,0)})}}reorganizeTasks(e){const t=new Set(e.map(a=>a.id));this.completedUploads.value=this.completedUploads.value.filter(a=>!t.has(a.id)||a.status!==w.PENDING);const s=new Set(this.uploadQueue.value.map(a=>a.id)),r=new Set(this.activeUploads.value.keys());e.forEach(a=>{!s.has(a.id)&&!r.has(a.id)&&this.uploadQueue.value.push(a)}),this.taskQueueManager.sort(this.uploadQueue.value)}cancel(e){const t=this.getTask(e);return t?(console.log(`üõë ÂèñÊ∂à‰ªªÂä°: ${t.file.name}`),this.uploadController.cancel(e),t.status=w.CANCELLED,t.endTime=Date.now(),this.removeFile(e),this.callbackManager.emit("onFileCancel",t),this):(console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°: ${e}`),this)}async cancelAll(){if(console.log("üõë ÂèñÊ∂àÊâÄÊúâ‰∏ä‰º†"),this.isAddingFiles.value&&this.addFilesAbortController&&(this.addFilesAbortController.abort(),this.addFilesPromise))try{await Promise.race([this.addFilesPromise,new Promise(r=>setTimeout(r,500))])}catch{}this.uploadController.cancelAll();const e=this.getAllTasks(),t=[];e.forEach(r=>{t.push(()=>{r.status=w.CANCELLED,r.endTime=Date.now()})});const s=100;for(let r=0;r<t.length;r+=s)t.slice(r,r+s).forEach(i=>i()),r+s<t.length&&await this.yieldToMain(0);return this.uploadQueue.value=[],this.activeUploads.value.clear(),this.isUploading.value=!1,this.batchEmitCallbacks("onFileCancel",e).catch(console.error),console.log("‚úÖ ÊâÄÊúâ‰ªªÂä°Â∑≤ÂèñÊ∂à"),this}clear(){return this.cancelAll(),this.completedUploads.value=[],this.progressManager.reset(),this.config.enableCache&&this.cacheManager.clear(),console.log("üóëÔ∏è Â∑≤Ê∏ÖÁ©∫ÊâÄÊúâ‰ªªÂä°"),this}removeFile(e){const t=this.uploadQueue.value.findIndex(r=>r.id===e);t>-1&&this.uploadQueue.value.splice(t,1),this.activeUploads.value.has(e)&&this.activeUploads.value.delete(e);const s=this.completedUploads.value.findIndex(r=>r.id===e);return s>-1&&this.completedUploads.value.splice(s,1),this.uploadController.cleanupTask(e),this}retrySingleFile(e){const t=this.completedUploads.value.findIndex(r=>r.id===e&&r.status===w.ERROR);if(t===-1)return console.warn(`‚ö†Ô∏è Êú™ÊâæÂà∞Â§±Ë¥•ÁöÑ‰ªªÂä°: ${e}`),this;const s=this.completedUploads.value[t];return console.log(`üîÑ ÈáçËØï‰ªªÂä°: ${s.file.name}`),this.resetTaskForRetry(s),this.completedUploads.value.splice(t,1),this.uploadQueue.value.some(r=>r.id===e)||(this.uploadQueue.value.unshift(s),this.taskQueueManager.sort(this.uploadQueue.value)),this.isUploading.value||this.start(),this}retryFailed(){const e=this.completedUploads.value.filter(t=>t.status===w.ERROR);return e.length===0?(console.log("‚ÑπÔ∏è Ê≤°ÊúâÂ§±Ë¥•ÁöÑ‰ªªÂä°ÈúÄË¶ÅÈáçËØï"),this):(console.log(`üîÑ ÈáçËØï ${e.length} ‰∏™Â§±Ë¥•ÁöÑ‰ªªÂä°`),e.forEach(t=>{this.resetTaskForRetry(t),this.uploadQueue.value.push(t)}),this.completedUploads.value=this.completedUploads.value.filter(t=>t.status!==w.PENDING),this.taskQueueManager.sort(this.uploadQueue.value),!this.isUploading.value&&this.uploadQueue.value.length>0&&this.start(),this)}resetTaskForRetry(e){this.retryStrategy.resetTask(e),e.progress=0,e.startTime=null,e.endTime=null,e.uploadedChunks=0,e.speed=0,this.config.enableNetworkAdaptation&&(e.options.chunkSize=we.calculateOptimalChunkSize(e.file.size,this.speedCalculator.getAverageSpeed(),this.config),console.log(`‚ÑπÔ∏è ‰ªªÂä° ${e.file.name} ÈáçÊñ∞ËÆ°ÁÆóÂàÜÁâáÂ§ßÂ∞è: ${(e.options.chunkSize/1024/1024).toFixed(2)}MB`)),e.chunks&&e.chunks.forEach(t=>{(t.status!==G.SUCCESS||!this.config.enableResume)&&(t.status=G.PENDING,t.retryCount=0,t.error=void 0,t.uploadTime=0)}),e.options.priority="high"}saveTaskProgress(e){var r;const t=`progress_${e.id}`,s={taskId:e.id,fileName:e.file.name,fileSize:e.file.size,uploadedChunks:e.uploadedChunks,totalChunks:e.totalChunks,uploadedSize:e.uploadedSize,progress:e.progress,status:e.status,pausedTime:e.pausedTime,chunks:((r=e.chunks)==null?void 0:r.map(a=>({index:a.index,start:a.start,end:a.end,size:a.size,status:a.status,etag:a.etag,hash:a.hash})))||[]};this.cacheManager.set(t,s),console.log(`üíæ Â∑≤‰øùÂ≠ò‰ªªÂä°ËøõÂ∫¶: ${e.file.name} (${e.uploadedChunks}/${e.totalChunks})`)}restoreTaskProgress(e){const t=`progress_${e.id}`,s=this.cacheManager.get(t);if(!s){console.log(`‚ÑπÔ∏è Êú™ÊâæÂà∞‰ªªÂä° ${e.file.name} ÁöÑÁºìÂ≠òËøõÂ∫¶`);return}e.uploadedChunks=s.uploadedChunks||0,e.uploadedSize=s.uploadedSize||0,e.progress=s.progress||0,s.chunks&&e.chunks&&s.chunks.forEach(r=>{const a=e.chunks.find(i=>i.index===r.index);a&&(a.status=r.status,a.etag=r.etag,a.hash=r.hash)}),console.log(`üìÇ Â∑≤ÊÅ¢Â§ç‰ªªÂä°ËøõÂ∫¶: ${e.file.name} (${e.uploadedChunks}/${e.totalChunks})`)}getTask(e){return this.uploadQueue.value.find(t=>t.id===e)||this.activeUploads.value.get(e)||this.completedUploads.value.find(t=>t.id===e)}getAllTasks(){return[...this.uploadQueue.value,...Array.from(this.activeUploads.value.values()),...this.completedUploads.value]}getDetailedStats(){const e=this.uploadStats.value,t=this.getAllTasks(),s=e.total>0?e.completed/e.total*100:0,r=e.total>0?e.totalSize/e.total:0,a=t.reduce((i,d)=>i+((d.endTime||Date.now())-(d.startTime||Date.now())),0);return{successRate:s,averageFileSize:r,totalUploadTime:a,networkQuality:this.networkQuality.value,cacheHitRate:0,workerEnabled:this.config.useWorker&&!!this.workerManager,currentChunkSize:this.config.chunkSize}}destroy(){this.cancelAll(),this.workerManager&&(this.workerManager.terminate(),this.workerManager=void 0),this.progressManager.reset(),this.cacheManager.clear(),console.log("üóëÔ∏è ‰∏ä‰º†ÁÆ°ÁêÜÂô®Â∑≤ÈîÄÊØÅ")}onFileStart(e){return this.callbackManager.onFileStart(e),this}onFileProgress(e){return this.callbackManager.onFileProgress(e),this}onFileSuccess(e){return this.callbackManager.onFileSuccess(e),this}onFileError(e){return this.callbackManager.onFileError(e),this}onFilePause(e){return this.callbackManager.onFilePause(e),this}onFileResume(e){return this.callbackManager.onFileResume(e),this}onFileCancel(e){return this.callbackManager.onFileCancel(e),this}onTotalProgress(e){return this.callbackManager.onTotalProgress(e),this}onAllComplete(e){return this.callbackManager.onAllComplete(e),this}onAllError(e){return this.callbackManager.onAllError(e),this}onSpeedChange(e){return this.callbackManager.onSpeedChange(e),this}onQueueChange(e){return this.callbackManager.onQueueChange(e),this}onChunkSuccess(e){return this.callbackManager.onChunkSuccess(e),this}onChunkError(e){return this.callbackManager.onChunkError(e),this}}function ur(c={}){const e=new cr(c),t=e.uploadQueue,s=e.activeUploads,r=e.completedUploads,a=e.totalProgress,i=e.uploadSpeed,d=e.isUploading,f=e.isPaused,g=e.uploadStats,k=e.networkQuality,S=()=>[...t.value,...Array.from(s.value.values()),...r.value].map(N=>{var ge,me;return{id:N.id,name:N.file.name,status:x(N.status),percentage:N.progress,file:N.file,thumbnailUrl:(ge=N.options.metadata)==null?void 0:ge.preview,url:(me=N.result)==null?void 0:me.fileUrl,type:N.file.type,fullPath:N.file.webkitRelativePath||N.file.name}}),x=A=>({[w.PENDING]:"pending",[w.UPLOADING]:"uploading",[w.SUCCESS]:"finished",[w.ERROR]:"error",[w.PAUSED]:"pending",[w.CANCELLED]:"removed"})[A];return{uploadQueue:t,activeUploads:s,completedUploads:r,totalProgress:a,uploadSpeed:i,isUploading:d,isPaused:f,uploadStats:g,networkQuality:k,uploader:e,addFiles:(A,N)=>e.addFiles(A,N),start:()=>e.start(),pauseAll:()=>e.pauseAll(),pause:A=>e.pause(A),resumeAll:()=>e.resumeAll(),resume:A=>e.resume(A),cancel:A=>e.cancel(A),cancelAll:()=>e.cancelAll(),retryFailed:()=>e.retryFailed(),removeFile:A=>e.removeFile(A),clear:()=>e.clear(),getTask:A=>e.getTask(A),getDetailedStats:()=>e.getDetailedStats(),updateConfig:A=>e.updateConfig(A),destroy:()=>e.destroy(),createNaiveFileList:S,convertToNaiveStatus:x,formatFileSize:ke,formatSpeed:Ws,formatTime:Gs,retrySingleFile:A=>e.retrySingleFile(A),getProgressStatus:()=>g.value.failed>0?"error":g.value.completed===g.value.total?"success":"default",getStatusText:A=>({[w.PENDING]:"Á≠âÂæÖ‰∏≠",[w.UPLOADING]:"‰∏ä‰º†‰∏≠",[w.SUCCESS]:"ÊàêÂäü",[w.ERROR]:"Â§±Ë¥•",[w.PAUSED]:"Â∑≤ÊöÇÂÅú",[w.CANCELLED]:"Â∑≤ÂèñÊ∂à"})[A],getStatusType:A=>({[w.PENDING]:"default",[w.UPLOADING]:"info",[w.SUCCESS]:"success",[w.ERROR]:"error",[w.PAUSED]:"warning",[w.CANCELLED]:"default"})[A],getFileIcon:A=>A.startsWith("image/")?Ge:A.startsWith("video/")?Qe:A.startsWith("audio/")?Ms:A.includes("pdf")?je:A.includes("zip")||A.includes("rar")?Ke:Ve,getFileColor:A=>A.startsWith("image/")?"#18a058":A.startsWith("video/")?"#2080f0":A.startsWith("audio/")?"#f0a020":A.includes("pdf")?"#d03050":A.includes("zip")||A.includes("rar")?"#7c3aed":"#666"}}class hr{constructor(e,t){C(this,"allowDirectory");C(this,"allowDirectoryDnd");this.allowDirectory=e,this.allowDirectoryDnd=t}createHandler(e){return{onDragOver:t=>{t.preventDefault(),t.stopPropagation(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy")},onDragLeave:t=>{t.preventDefault(),t.stopPropagation()},onDrop:async t=>{var a,i;t.preventDefault(),t.stopPropagation();const s=(a=t.dataTransfer)==null?void 0:a.items,r=(i=t.dataTransfer)==null?void 0:i.files;try{if(s&&s.length>0){const d=await this.extractFiles(s);if(d.length>0){e(d);return}}r&&r.length>0&&e(Array.from(r))}catch(d){console.error("Êñá‰ª∂ÊãñÊãΩËß£ÊûêÂ§±Ë¥•:",d)}}}}async extractFiles(e){const t=[],s=[];if(!!!(e[0]&&e[0].webkitGetAsEntry)){for(const a of Array.from(e)){const i=a.getAsFile();i&&t.push(i)}return t}for(const a of Array.from(e))a.kind==="file"&&s.push((async()=>{var d;const i=(d=a.webkitGetAsEntry)==null?void 0:d.call(a);if(i)if(i.isDirectory&&(this.allowDirectory||this.allowDirectoryDnd)){const f=await this.readDirectory(i);t.push(...f)}else if(i.isFile){const f=await this.getFileFromEntry(i);f&&t.push(f)}else{const f=a.getAsFile();f&&t.push(f)}})());return await Promise.allSettled(s),t}async readDirectory(e){const t=[],s=e.createReader();return new Promise(r=>{const a=()=>{s.readEntries(async i=>{if(!i.length){r(t);return}const d=[];for(const f of i)f.isFile?d.push((async()=>{const g=await this.getFileFromEntry(f);g&&t.push(g)})()):f.isDirectory&&d.push((async()=>{const g=await this.readDirectory(f);t.push(...g)})());await Promise.allSettled(d),a()},i=>{console.error(`ËØªÂèñÁõÆÂΩïÂ§±Ë¥• (${e.fullPath}):`,i),r(t)})};a()})}getFileFromEntry(e){return new Promise(t=>{e.file(s=>{try{Object.defineProperty(s,"webkitRelativePath",{value:e.fullPath.replace(/^\//,""),configurable:!0})}catch(r){console.warn("Êó†Ê≥ïËÆæÁΩÆ webkitRelativePath:",r)}t(s)},s=>{console.error(`Ëé∑ÂèñÊñá‰ª∂Â§±Ë¥• (${e.fullPath}):`,s),t(null)})})}}class dr{constructor(e){C(this,"config");C(this,"queue",[]);C(this,"isProcessing",!1);C(this,"counter",0);this.config=e}generateFileId(){return`file_${Date.now()}_${++this.counter}`}createUploadFileInfo(e){const t=e.webkitRelativePath||e.name;return{id:this.generateFileId(),name:e.name,status:"pending",percentage:0,file:e,fullPath:t}}async processFiles(e,t,s){if(this.isProcessing){this.queue.push(...e);return}this.isProcessing=!0;try{for(await this.runBatches(e,t,s);this.queue.length>0;){const r=this.queue.splice(0,this.config.batchSize);await this.runBatches(r,t,s)}}finally{this.isProcessing=!1}}async runBatches(e,t,s){const{batchSize:r,idleTimeout:a,maxConcurrent:i}=this.config;for(let d=0;d<e.length;d+=r){const f=e.slice(d,d+r);await this.runWithConcurrency(f,i,async g=>{const k=this.createUploadFileInfo(g);if(t)try{if(!await t.validate(g))return}catch(S){console.warn(`Êñá‰ª∂È™åËØÅÂ§±Ë¥•: ${g.name}`,S);return}s==null||s(k)}),d+r<e.length&&await this.waitForIdle(a)}}async runWithConcurrency(e,t,s){const r=[];for(const a of e){const i=Promise.resolve().then(()=>s(a)).finally(()=>{const d=r.indexOf(i);d>=0&&r.splice(d,1)});r.push(i),r.length>=t&&await Promise.race(r)}await Promise.all(r)}waitForIdle(e){return new Promise(t=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(t,{timeout:e}):setTimeout(t,e)})}}const fr=Q({name:"CustomUpload",props:{multiple:{type:Boolean,default:!1},accept:{type:String,default:""},directory:{type:Boolean,default:!1},directoryDnd:{type:Boolean,default:!1},abstract:{type:Boolean,default:!1},max:{type:Number,default:1/0},maxSize:{type:Number,default:1/0},disabled:{type:Boolean,default:!1},batchSize:{type:Number,default:100},processingTimeout:{type:Number,default:20},concurrentLimit:{type:Number,default:5}},emits:["change","error","exceed"],setup(c,{slots:e,emit:t,expose:s}){const r=O(),a=O(!1),i=O(!1),d=O(!1),f=O(0),g=qe(),k=new dr({batchSize:c.batchSize,idleTimeout:c.processingTimeout,maxConcurrent:c.concurrentLimit}),S=new hr(c.directory,c.directoryDnd),x=V(()=>c.accept?c.accept.split(",").map(y=>y.trim().toLowerCase()):[]),T=V(()=>c.max===1/0||f.value<c.max),U=V(()=>c.disabled||!T.value),B=y=>y<1024?`${y} B`:y<1024*1024?`${(y/1024).toFixed(2)} KB`:`${(y/(1024*1024)).toFixed(2)} MB`,M=y=>y.startsWith(".")?y:`.${y}`,h={validate:y=>{const L=`.${y.name.toLowerCase().split(".").pop()}`;return x.value.length>0&&!x.value.some(N=>L===M(N).toLowerCase())?(t("error",{file:y,message:`Êñá‰ª∂Á±ªÂûã‰∏çÊîØÊåÅ: ${y.name}`}),!1):c.maxSize!==1/0&&y.size>c.maxSize?(t("error",{file:y,message:`Êñá‰ª∂Â§ßÂ∞èË∂ÖÂá∫ÈôêÂà∂: ${y.name} (${B(y.size)} / ${B(c.maxSize)})`}),!1):!0},getErrorMessage:y=>`Êñá‰ª∂È™åËØÅÂ§±Ë¥•: ${y.name}`},o=async y=>{if(c.disabled||y.length===0)return;const D=c.max===1/0?y.length:Math.max(0,c.max-f.value);if(D===0){t("exceed",{files:y,max:c.max});return}const L=y.slice(0,D);L.length<y.length&&t("exceed",{files:y.slice(D),max:c.max}),d.value=!0;const A=[];try{await k.processFiles(L,h,N=>{A.push({id:N.id,name:N.name,file:N.file,fullPath:N.fullPath,size:N.file.size,type:N.file.type,status:"pending",percentage:0}),f.value++}),A.length>0&&t("change",A)}finally{d.value=!1}},n=y=>{var D;U.value||(y==null||y.preventDefault(),y==null||y.stopPropagation(),(D=r.value)==null||D.click())},u=y=>{var L;const D=y.target;(L=D.files)!=null&&L.length&&(o(Array.from(D.files)),D.value="")},l=S.createHandler(o),P=y=>{U.value||(y.preventDefault(),y.stopPropagation(),l.onDragOver(y),a.value=!0)},j=y=>{c.disabled||(y.preventDefault(),y.stopPropagation(),l.onDragLeave(y),a.value=!1)},Z=async y=>{U.value||(y.preventDefault(),y.stopPropagation(),a.value=!1,await l.onDrop(y))},X=()=>{U.value||(i.value=!0)},ie=()=>{i.value=!1};s({triggerFileSelect:n,reset:()=>{f.value=0}});const J=()=>{let y=g.value.dividerColor,D="transparent";return a.value?(y=g.value.primaryColor,D=`${g.value.primaryColor}12`):i.value&&!U.value?(y=g.value.primaryColorHover,D=`${g.value.primaryColor}08`):U.value&&(y=g.value.borderColor,D=g.value.actionColor),{borderColor:y,backgroundColor:D,opacity:U.value?.6:1,cursor:U.value?"not-allowed":"pointer"}},oe=()=>{let y="scale(1)",D=g.value.textColor3;return a.value?(y="scale(1.1)",D=g.value.primaryColor):i.value&&(y="scale(1.05)",D=g.value.primaryColorHover),{transform:y,color:D}};return()=>{var D;const y=m("input",Ut({ref:r,type:"file",multiple:c.multiple,accept:c.accept},c.directory?{webkitdirectory:!0}:{},{class:"hidden",onChange:u,disabled:U.value}),null);return c.abstract?m("div",{class:"inline-block w-full"},[y,m("div",{class:"relative overflow-hidden border-2 rounded-lg border-dashed transition-all duration-200 ease-in-out",style:J(),onClick:n,onDrop:Z,onDragover:P,onDragleave:j,onDragenter:L=>L.preventDefault(),onMouseenter:X,onMouseleave:ie},[((D=e.default)==null?void 0:D.call(e,{isDragOver:a.value,isProcessing:d.value,canAddMore:T.value,fileCount:f.value,maxFiles:c.max}))||m("div",{class:"px-6 py-4 text-center"},[m("div",{class:"mb-4 inline-flex items-center justify-center transition-all duration-300",style:oe()},[m(ee,{size:48},{default:()=>[m(pe,null,null)]})]),m(xe,{class:"mb-2 block text-base font-medium",style:{color:g.value.textColor1}},{default:()=>[a.value?"ÈáäÊîæ‰ª•‰∏ä‰º†Êñá‰ª∂":"ÁÇπÂáªÊàñÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Âå∫Âüü"]}),m(xe,{depth:3,class:"mb-3 block text-sm",style:{color:g.value.textColor3}},{default:()=>[c.multiple?"ÊîØÊåÅÂçï‰∏™ÊàñÊâπÈáè‰∏ä‰º†":"ÊîØÊåÅÂçï‰∏™Êñá‰ª∂‰∏ä‰º†"]}),m("div",{class:"inline-flex items-center rounded-full px-3 py-1.5 text-xs font-medium",style:{backgroundColor:g.value.buttonColor2,color:g.value.textColor2}},[m("span",null,[H("Â∑≤‰∏ä‰º†: ")]),m("span",{class:"ml-1 font-semibold",style:{color:g.value.primaryColor}},[f.value]),m("span",{class:"mx-1"},[H("/")]),m("span",null,[c.max===1/0?"‚àû":c.max])]),d.value&&m("div",{class:"mt-5 flex items-center justify-center gap-2 rounded-lg px-4 py-2",style:{backgroundColor:`${g.value.primaryColor}10`,borderLeft:`3px solid ${g.value.primaryColor}`}},[m("div",{class:"h-4 w-4 animate-spin border-2 border-t-transparent rounded-full",style:{borderColor:g.value.primaryColor}},null),m(xe,{style:{color:g.value.primaryColor}},{default:()=>[H("Ê≠£Âú®Â§ÑÁêÜÊñá‰ª∂...")]})])])]),!T.value&&c.max!==1/0&&m("div",{class:"mt-3 rounded-md px-3 py-2 text-center text-xs",style:{backgroundColor:`${g.value.warningColor}15`,color:g.value.warningColor,border:`1px solid ${g.value.warningColor}40`}},[H("‚ö†Ô∏è Â∑≤ËææÂà∞ÊúÄÂ§ßÊñá‰ª∂Êï∞ÈáèÈôêÂà∂ ("),c.max,H(")")])]):m("div",{class:"inline-block"},[y,m(fe,{onClick:n,disabled:U.value,loading:d.value,size:"medium",secondary:!0,style:{borderRadius:g.value.borderRadius}},{default:()=>{var L;return[((L=e.default)==null?void 0:L.call(e))||m("span",{class:"flex items-center gap-2"},[m(ee,{size:18},{default:()=>[m(pe,null,null)]}),m("span",null,[H("ÈÄâÊã©Êñá‰ª∂")])])]}}),!T.value&&c.max!==1/0&&m("div",{class:"mt-2 inline-block rounded px-2 py-1 text-xs",style:{backgroundColor:`${g.value.warningColor}15`,color:g.value.warningColor}},[H("Â∑≤ËææÂà∞ÈôêÂà∂ ("),c.max,H(")")])])}}}),pr={class:"file-item border-b border-gray-100 px-4 py-3 transition-colors duration-150 last:border-b-0 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50"},gr={class:"flex items-start gap-3"},mr={class:"h-9 w-8 flex flex-shrink-0 items-center justify-center"},vr={class:"text-sm text-gray-400 font-medium dark:text-gray-500"},kr={class:"min-w-0 w-full flex flex-col gap-2"},wr={class:"w-full flex items-center justify-between gap-2"},Cr={class:"min-w-0 flex flex-col flex-1"},yr={class:"truncate text-sm text-gray-800 font-medium dark:text-gray-100"},Sr={class:"mt-0.5 text-xs text-gray-500 dark:text-gray-400"},br={class:"flex flex-shrink-0 items-center gap-2"},xr={key:0,class:"flex flex-col gap-1.5"},Er={class:"text-xs text-gray-500 dark:text-gray-400"},Tr=Q({__name:"UploadFileItem",props:{task:{},index:{},showProgress:{type:Boolean,default:!1},showActions:{type:Boolean,default:!1}},emits:["remove","view","retry"],setup(c,{emit:e}){const{task:t,showProgress:s,showActions:r}=c,a=e,i={image:Ge,video:Qe,audio:Zt,archive:Ke,document:je,default:Ve},d=n=>n.startsWith("image/")?i.image:n.startsWith("video/")?i.video:n.startsWith("audio/")?i.audio:n.includes("zip")||n.includes("rar")||n.includes("7z")?i.archive:n.includes("pdf")||n.includes("document")||n.includes("word")?i.document:i.default,f={image:"#10b981",video:"#8b5cf6",audio:"#f59e0b",archive:"#64748b",pdf:"#ef4444",document:"#3b82f6",default:"#6b7280"},g=n=>n.startsWith("image/")?f.image:n.startsWith("video/")?f.video:n.startsWith("audio/")?f.audio:n.includes("zip")||n.includes("rar")||n.includes("7z")?f.archive:n.includes("pdf")?f.pdf:n.includes("document")||n.includes("word")?f.document:f.default,k=n=>{if(!n)return"Êú™Áü•";const u=n.split("/")[0],l=n.split("/")[1];return{image:"ÂõæÁâá",video:"ËßÜÈ¢ë",audio:"Èü≥È¢ë",application:(l==null?void 0:l.toUpperCase())||"Êñá‰ª∂",text:"ÊñáÊú¨"}[u]||(l==null?void 0:l.toUpperCase())||"Êñá‰ª∂"},S=n=>{if(n===0)return"0 B";const u=1024,l=["B","KB","MB","GB"],P=Math.min(Math.floor(Math.log(n)/Math.log(u)),l.length-1);return`${(n/u**P).toFixed(1)} ${l[P]}`},x=n=>{if(!n||n===0)return"0 KB/s";const u=1024,l=["B/s","KB/s","MB/s"],P=Math.min(Math.floor(Math.log(n)/Math.log(u)),l.length-1);return`${(n/u**P).toFixed(1)} ${l[P]}`},T={[w.PENDING]:"ÂæÖ‰∏ä‰º†",[w.UPLOADING]:"‰∏ä‰º†‰∏≠",[w.PAUSED]:"Â∑≤ÊöÇÂÅú",[w.SUCCESS]:"Â∑≤ÂÆåÊàê",[w.ERROR]:"Â§±Ë¥•",[w.CANCELLED]:"Â∑≤ÂèñÊ∂à"},U={[w.PENDING]:"warning",[w.UPLOADING]:"info",[w.PAUSED]:"default",[w.SUCCESS]:"success",[w.ERROR]:"error",[w.CANCELLED]:"default"},B=n=>T[n]||"Êú™Áü•",M=n=>U[n],p=()=>a("remove"),h=()=>a("view"),o=()=>a("retry");return(n,u)=>{var l,P;return I(),K("div",pr,[b("div",gr,[b("div",mr,[b("span",vr,W(n.index+1),1)]),m(v(hs),{style:he({background:g(t.file.type)}),size:36,class:"flex flex-shrink-0 items-center justify-center"},{default:E(()=>[m(v(ee),{component:d(t.file.type),size:18},null,8,["component"])]),_:1},8,["style"]),b("div",kr,[b("div",wr,[b("div",Cr,[b("div",yr,W(t.file.name),1),b("div",Sr,W(S(t.file.size))+" ¬∑ "+W(k(t.file.type)),1)]),b("div",br,[m(v(Ie),{type:M(t.status),bordered:!1,size:"small"},{default:E(()=>[H(W(B(t.status)),1)]),_:1},8,["type"]),r?(I(),K(Nt,{key:0},[t.status===v(w).PENDING?(I(),q(v(fe),{key:0,size:"tiny",quaternary:"",circle:"",onClick:be(p,["stop"])},{icon:E(()=>[m(v(ee),{component:v(ys)},null,8,["component"])]),_:1})):Y("",!0),t.status===v(w).SUCCESS&&((P=(l=t.options)==null?void 0:l.metadata)!=null&&P.preview)?(I(),q(v(fe),{key:1,size:"tiny",quaternary:"",circle:"",type:"info",onClick:be(h,["stop"])},{icon:E(()=>[m(v(ee),{component:v(Es)},null,8,["component"])]),_:1})):Y("",!0),t.status===v(w).ERROR?(I(),q(v(fe),{key:2,size:"tiny",quaternary:"",circle:"",type:"warning",onClick:be(o,["stop"])},{icon:E(()=>[m(v(ee),{component:v(Ye)},null,8,["component"])]),_:1})):Y("",!0)],64)):Y("",!0)])]),s&&t.status===v(w).UPLOADING?(I(),K("div",xr,[m(v(Ze),{type:"line",percentage:t.progress,"show-indicator":!1,height:4,"border-radius":2},null,8,["percentage"]),b("div",Er,W(t.progress)+"% ¬∑ "+W(x(t.speed)),1)])):Y("",!0)])])])}}}),Pe=ze(Tr,[["__scopeId","data-v-db38943c"]]),Mr={class:"overflow-hidden border border-gray-100 rounded-lg bg-white shadow-sm transition-colors duration-300 dark:border-gray-700 dark:bg-gray-800"},Ar={class:"m-0 flex items-center gap-2 text-lg text-gray-600 font-semibold dark:text-gray-300"},_r={class:"flex items-center gap-2"},Fr=Q({__name:"UploadListSection",props:{title:{},icon:{},count:{},items:{},tagType:{default:"info"},defaultCollapsed:{type:Boolean,default:!1},maxHeight:{default:"400px"},itemSize:{default:48}},setup(c,{expose:e}){const t=c,s=V(()=>t.items.map((d,f)=>({...d,_index:f}))),r=O(t.defaultCollapsed),a=O(),i=()=>{t.items.length!==0&&(r.value=!r.value)};return e({toggleCollapse:i,isCollapsed:r}),(d,f)=>(I(),K("div",Mr,[b("div",{class:"flex cursor-pointer items-center justify-between border-b border-gray-100 px-4 py-3 transition-colors dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50",onClick:i},[b("h3",Ar,[m(v(ee),{component:d.icon,size:20},null,8,["component"]),H(" "+W(d.title),1)]),b("div",_r,[m(v(Ie),{type:d.tagType,bordered:!1,round:"",size:"small"},{default:E(()=>[H(W(d.count),1)]),_:1},8,["type"]),m(v(ee),{size:20,class:"text-gray-300 transition-transform duration-300 ease-in-out dark:text-gray-500 group-hover:text-primary",style:he({transform:r.value?"rotate(-90deg)":"rotate(0deg)"})},{default:E(()=>[m(v(ws))]),_:1},8,["style"])])]),b("div",{ref_key:"contentRef",ref:a,class:"overflow-hidden transition-all duration-300 ease-in-out",style:he({maxHeight:r.value?d.maxHeight:"0px",opacity:r.value?1:0})},[b("div",{style:he({height:d.maxHeight,overflow:"hidden"})},[d.items.length>0?$t((I(),q(v(fs),{key:0,items:s.value,"item-size":d.itemSize,"item-resizable":!1,style:he({height:d.maxHeight}),class:"virtual-list-container"},{default:E(({item:g,index:k})=>[Lt(d.$slots,"item",{item:g,index:g._index},void 0,!0)]),_:3},8,["items","item-size","style"])),[[Ot,r.value]]):d.items.length===0?(I(),q(v(Bt),{key:1,description:"ÊöÇÊó†Êï∞ÊçÆ",size:"small",class:"py-8"})):Y("",!0)],4)],4)]))}}),Re=ze(Fr,[["__scopeId","data-v-0b3fec07"]]),Pr={class:"h-full w-full flex flex-col gap-4"},Rr={class:"flex items-center justify-between"},Ir={class:"w-full flex flex-col gap-4 xl:flex-row"},zr={class:"flex flex-col flex-1 gap-4 rounded-lg bg-white p-6 shadow transition-all duration-300 md:flex-row dark:bg-gray-800"},Dr={class:"flex flex-col items-center justify-center px-4 py-4 text-center"},Ur={class:"mt-3 text-sm text-gray-500 dark:text-gray-400"},Nr={class:"flex flex-col justify-between gap-4 md:w-[260px]"},$r={class:"flex flex-wrap gap-2"},Or={class:"text-center text-xs text-gray-400 dark:text-gray-500"},Lr={class:"min-w-[300px] flex-1 rounded-lg bg-white p-6 shadow transition-all duration-300 dark:bg-gray-800"},Br={class:"mb-4 flex items-start justify-between gap-4"},Hr={class:"flex flex-wrap gap-2"},Wr={class:"mb-4"},Gr={class:"grid grid-cols-1 mt-2 items-center gap-3 text-sm text-gray-600 sm:grid-cols-3 dark:text-gray-400"},Qr={class:"flex items-center gap-2"},jr={class:"flex items-center gap-2"},Kr={class:"smooth-time"},Vr={class:"flex items-center gap-2"},Zr={class:"flex flex-col flex-1 gap-4"},Be="WGz4LlZ0W8P3+HOaQlLRkcdCuTsJGVrvvTZfdJYY3otxprBxscciMf+yoDBGJ+9f1bA5c+xXMNCkSzTr1aflzW0TcOXtrKagFj0ZvBk//rdHwQUzXVmVkiWN+5LR2wi/oqAnl5o5KmFP5tuTifyd1CUTZdG6aUPvnnHKbYZfevBbpvmuhKqC9Ks2v/NrfBGZ",qr=Q({name:"upload",__name:"index",setup(c){const e=es(),t=qe(),s=Ht(),r=O(!1),a=Wt({maxConcurrentFiles:F.CONCURRENT.DEFAULT_FILES,maxConcurrentChunks:F.CONCURRENT.DEFAULT_CHUNKS,chunkSize:F.UPLOAD.CHUNK_SIZE,maxRetries:F.RETRY.MAX_RETRIES,enableNetworkAdaptation:!0,enableSmartRetry:!0,enableDeduplication:!1,useWorker:!1}),i=[{label:"512 KB",value:512*1024},{label:"1 MB",value:1024*1024},{label:"2 MB",value:2*1024*1024},{label:"5 MB",value:5*1024*1024},{label:"10 MB",value:10*1024*1024}],{addFiles:d,start:f,pauseAll:g,resumeAll:k,uploadQueue:S,activeUploads:x,completedUploads:T,totalProgress:U,uploadSpeed:B,uploadStats:M,isUploading:p,isPaused:h,networkQuality:o,retryFailed:n,retrySingleFile:u,removeFile:l,clear:P,updateConfig:j,formatFileSize:Z,formatSpeed:X,formatTime:ie,getProgressStatus:ue}=ur({uploadChunkUrl:"https://testaest-v1.umi6.com/proxy-minio/upload/chunk",mergeChunksUrl:"https://testaest-v1.umi6.com/proxy-minio/upload/complete",checkFileUrl:"/api/upload/check",headers:{"custom-origin":"https://testaigc.umi6.com",origin:"https://testaigc.umi6.com",authorization:"Bearer 6992fcd36dce4d24b9ddf26a110a17cf"},chunkUploadTransformer:({task:z,chunk:_})=>{const $=new FormData;return $.append("file",_.blob),$.append("chunk_number",_.index.toString()),$.append("upload_id",z.id),$.append("Authorization",Be),$},mergeChunksTransformer:({task:z})=>({upload_id:z.id,filename:z.file.name,folder:z.file.webkitRelativePath,total_chunks:z.totalChunks,Authorization:Be}),...a}),J=O(),oe=O(0);let y=0,D=0,L=null;const A=z=>{L&&clearInterval(L),y=z,oe.value=y,D=Date.now(),L=window.setInterval(()=>{const _=Date.now(),$=(_-D)/1e3;y=Math.max(0,y-$),oe.value=Math.round(y),D=_,y<=0&&L&&(clearInterval(L),L=null)},1e3)};de(()=>M.value.estimatedTime,z=>{(Math.abs(z-y)>5||L===null)&&(console.log(`üïê Ââ©‰ΩôÊó∂Èó¥ÂêåÊ≠•: ${y.toFixed(0)}s -> ${z}s`),A(z))},{immediate:!0}),We(()=>{L&&clearInterval(L)});const N=V(()=>T.value.filter(z=>z.status===w.ERROR).length),ge=V(()=>({good:"ËâØÂ•Ω",fair:"‰∏ÄËà¨",poor:"ËæÉÂ∑Æ"})[o.value]),me=V(()=>"ÊâÄÊúâÊ†ºÂºè"),tt=V(()=>Z(F.UPLOAD.MAX_FILESIZE)),st=async z=>{if(!(!z||z.length===0))try{const _=z.map($=>$.file);await d(_),J.value&&(J.value.value="")}catch(_){s.error(`Ê∑ªÂä†Êñá‰ª∂Â§±Ë¥•: ${_}`)}},rt=z=>{s.error(z.message)},at=z=>{s.warning(`Êñá‰ª∂Êï∞ÈáèË∂ÖÂá∫ÈôêÂà∂ÔºåÊúÄÂ§öÂÖÅËÆ∏ ${z.max} ‰∏™Êñá‰ª∂`)},nt=async()=>{await f()},it=z=>{try{u(z),s.info("Â∑≤Âä†ÂÖ•ÈáçËØïÈòüÂàó"),f()}catch(_){s.error(`ÈáçËØïÂ§±Ë¥•: ${_}`)}},ot=z=>{console.log(z,"‰ªªÂä°‰ø°ÊÅØ"),e.open({title:"Êñá‰ª∂È¢ÑËßà",content:JSON.stringify(z,null,2),width:600})},te=()=>{j(a),s.success("ËÆæÁΩÆÂ∑≤Êõ¥Êñ∞")};return(z,_)=>{const $=ee,lt=ts,le=fe,ct=ss,ce=Ie,ut=Ze,Ce=Qt,se=as,ht=jt,ve=Kt,dt=rs,ft=Gt,pt=Vt;return I(),K("div",Pr,[b("div",Rr,[m(lt,{class:"m-0 flex items-center gap-3 font-semibold"},{default:E(()=>[m($,{component:v(pe),size:22},null,8,["component"]),_[10]||(_[10]=H(" Êñá‰ª∂‰∏ä‰º†ÁÆ°ÁêÜ "))]),_:1}),m(ct,null,{default:E(()=>[m(le,{size:"small",quaternary:"",circle:"",onClick:_[0]||(_[0]=R=>r.value=!0)},{icon:E(()=>[m($,{component:v(Is)},null,8,["component"])]),_:1}),v(M).total>0?(I(),q(le,{key:0,size:"small",quaternary:"",circle:"",type:"error",onClick:v(P)},{icon:E(()=>[m($,{component:v(qt)},null,8,["component"])]),_:1},8,["onClick"])):Y("",!0)]),_:1})]),b("div",Ir,[b("div",zr,[m(v(fr),{abstract:!0,multiple:!0,"directory-dnd":!0,max:v(F).UPLOAD.MAX_FILES,"max-size":v(F).UPLOAD.MAX_FILESIZE,disabled:v(p)||v(h),"batch-size":100,"processing-timeout":20,class:"flex-1",onChange:st,onError:rt,onExceed:at},{default:E(({isDragOver:R,isProcessing:ae,fileCount:ye})=>[b("div",Dr,[m($,{component:v(pe),size:56,color:R?v(t).primaryColor:v(t).primaryColorHover,class:"transition-all duration-300"},null,8,["component","color"]),b("p",Ur,W(ae?"Â§ÑÁêÜ‰∏≠...":"ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§ÑÊàñÁÇπÂáªÈÄâÊã©"),1)])]),_:1},8,["max","max-size","disabled"]),b("div",Nr,[b("div",$r,[m(le,{size:"small",disabled:N.value===0,type:"warning",class:"flex-1",onClick:v(n)},{icon:E(()=>[m($,{component:v(Ye)},null,8,["component"])]),default:E(()=>[H(" ÈáçËØïÂ§±Ë¥• ("+W(N.value)+") ",1)]),_:1},8,["disabled","onClick"]),m(le,{size:"small",disabled:!v(p)||v(h),class:"flex-1",onClick:v(g)},{icon:E(()=>[m($,{component:v(_s)},null,8,["component"])]),default:E(()=>[_[11]||(_[11]=H(" ÊöÇÂÅú "))]),_:1},8,["disabled","onClick"]),m(le,{size:"small",disabled:!v(h)||v(p),class:"flex-1",onClick:v(k)},{icon:E(()=>[m($,{component:v($e)},null,8,["component"])]),default:E(()=>[_[12]||(_[12]=H(" ÊÅ¢Â§ç "))]),_:1},8,["disabled","onClick"]),m(le,{type:"primary",disabled:v(S).length===0||v(p)||v(h),loading:v(p),size:"small",class:"flex-1",onClick:nt},{icon:E(()=>[m($,{component:v($e)},null,8,["component"])]),default:E(()=>[_[13]||(_[13]=H(" ÂºÄÂßã‰∏ä‰º† "))]),_:1},8,["disabled","loading"])]),b("div",Or," ÊîØÊåÅÊ†ºÂºè: "+W(me.value)+" | ÊúÄÂ§ß: "+W(tt.value),1)])]),b("div",Lr,[b("div",Br,[_[14]||(_[14]=b("h3",{class:"text-lg text-gray-600 font-medium dark:text-gray-200"},"‰∏ä‰º†ÁªüËÆ°",-1)),b("div",Hr,[m(ce,{bordered:!1,type:"info",class:"flex items-center"},{icon:E(()=>[m($,{component:v(bs)},null,8,["component"])]),default:E(()=>[H(" ÊÄªËÆ°: "+W(v(M).total),1)]),_:1}),m(ce,{bordered:!1,type:"warning",class:"flex items-center"},{icon:E(()=>[m($,{component:v(Oe)},null,8,["component"])]),default:E(()=>[H(" ÂæÖ‰∏ä‰º†: "+W(v(M).pending),1)]),_:1}),m(ce,{bordered:!1,type:"primary",class:"flex items-center"},{icon:E(()=>[m($,{component:v(gs)},null,8,["component"])]),default:E(()=>[H(" ‰∏ä‰º†‰∏≠: "+W(v(M).active),1)]),_:1}),m(ce,{bordered:!1,type:"success",class:"flex items-center"},{icon:E(()=>[m($,{component:v(Yt)},null,8,["component"])]),default:E(()=>[H(" Â∑≤ÂÆåÊàê: "+W(v(M).completed),1)]),_:1}),v(M).failed>0?(I(),q(ce,{key:0,bordered:!1,type:"error",class:"flex items-center"},{icon:E(()=>[m($,{component:v(Xt)},null,8,["component"])]),default:E(()=>[H(" Â§±Ë¥•: "+W(v(M).failed),1)]),_:1})):Y("",!0)])]),b("div",Wr,[m(ut,{type:"line",percentage:v(U),status:v(ue)(),height:12,"border-radius":6,"fill-border-radius":6},null,8,["percentage","status"])]),b("div",Gr,[b("div",Qr,[m($,{component:v(Ds)},null,8,["component"]),b("span",null,W(v(X)(v(B))),1)]),b("div",jr,[m($,{component:v(Oe)},null,8,["component"]),b("span",Kr,W(v(ie)(oe.value)),1)]),b("div",Vr,[m($,{component:v($s)},null,8,["component"]),m(ce,{type:v(o)==="good"?"success":v(o)==="fair"?"warning":"error",size:"small",bordered:!1},{default:E(()=>[H(W(ge.value),1)]),_:1},8,["type"])])])])]),b("div",Zr,[v(S).length>0?(I(),q(Re,{key:0,title:"ÂæÖ‰∏ä‰º†ÈòüÂàó",icon:v(Jt),count:v(S).length,"tag-type":"info",items:v(S),"default-collapsed":"","max-height":"250px"},{item:E(({item:R,index:ae})=>[(I(),q(Pe,{key:R.id,index:ae,task:R,"show-actions":!0,onRemove:ye=>v(l)(R.id)},null,8,["index","task","onRemove"]))]),_:1},8,["icon","count","items"])):Y("",!0),v(x).size>0?(I(),q(Re,{key:1,"max-height":"380px",title:"‰∏ä‰º†‰∏≠",icon:v(pe),count:v(x).size,"tag-type":"primary",items:Array.from(v(x).values())},{item:E(({item:R,index:ae})=>[(I(),q(Pe,{key:R.id,index:ae,task:R,"show-progress":!0},null,8,["index","task"]))]),_:1},8,["icon","count","items"])):Y("",!0),v(T).length>0?(I(),q(Re,{key:2,title:"Â∑≤ÂÆåÊàê","max-height":"250px",icon:v(vs),count:v(T).length,items:v(T),"tag-type":"success"},{item:E(({item:R,index:ae})=>[m(Pe,{task:R,index:ae,"show-actions":!0,onRetry:ye=>it(R.id),onView:ye=>ot(R)},null,8,["task","index","onRetry","onView"])]),_:1},8,["icon","count","items"])):Y("",!0)]),m(pt,{show:r.value,"onUpdate:show":_[9]||(_[9]=R=>r.value=R),width:400,placement:"right"},{default:E(()=>[m(ft,{title:"‰∏ä‰º†ËÆæÁΩÆ",closable:""},{default:E(()=>[m(dt,{"label-placement":"left","label-width":"120"},{default:E(()=>[m(se,{label:"Âπ∂ÂèëÊñá‰ª∂Êï∞"},{default:E(()=>[m(Ce,{value:a.maxConcurrentFiles,"onUpdate:value":[_[1]||(_[1]=R=>a.maxConcurrentFiles=R),te],min:1,max:10},null,8,["value"])]),_:1}),m(se,{label:"Âπ∂ÂèëÂàÜÁâáÊï∞"},{default:E(()=>[m(Ce,{value:a.maxConcurrentChunks,"onUpdate:value":[_[2]||(_[2]=R=>a.maxConcurrentChunks=R),te],min:1,max:10},null,8,["value"])]),_:1}),m(se,{label:"ÂàÜÁâáÂ§ßÂ∞è"},{default:E(()=>[m(ht,{value:a.chunkSize,"onUpdate:value":[_[3]||(_[3]=R=>a.chunkSize=R),te],options:i},null,8,["value"])]),_:1}),m(se,{label:"ÊúÄÂ§ßÈáçËØïÊ¨°Êï∞"},{default:E(()=>[m(Ce,{value:a.maxRetries,"onUpdate:value":[_[4]||(_[4]=R=>a.maxRetries=R),te],min:0,max:10},null,8,["value"])]),_:1}),m(se,{label:"ÁΩëÁªúËá™ÈÄÇÂ∫î"},{default:E(()=>[m(ve,{value:a.enableNetworkAdaptation,"onUpdate:value":[_[5]||(_[5]=R=>a.enableNetworkAdaptation=R),te]},null,8,["value"])]),_:1}),m(se,{label:"Êô∫ËÉΩÈáçËØï"},{default:E(()=>[m(ve,{value:a.enableSmartRetry,"onUpdate:value":[_[6]||(_[6]=R=>a.enableSmartRetry=R),te]},null,8,["value"])]),_:1}),m(se,{label:"Áßí‰º†Ê£ÄÊµã"},{default:E(()=>[m(ve,{value:a.enableDeduplication,"onUpdate:value":[_[7]||(_[7]=R=>a.enableDeduplication=R),te]},null,8,["value"])]),_:1}),m(se,{label:"‰ΩøÁî® Worker"},{default:E(()=>[m(ve,{value:a.useWorker,"onUpdate:value":[_[8]||(_[8]=R=>a.useWorker=R),te]},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}}),na=ze(qr,[["__scopeId","data-v-b9640850"]]);export{na as default};
