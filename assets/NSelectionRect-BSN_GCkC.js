import{d as X,s as x,r as M,c as w,h as Y,i as m,j as G,k as J,e as f,T as K,n as Q,l as Z}from"./index-saEpKK3w.js";import{u as ee}from"./use-theme-vars-BIXdptPX.js";function te(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!Z(o)}const T={SCROLLBAR:".n-scrollbar",CONTAINER:".n-scrollbar-container"},g={x:0,y:0},I={left:0,top:0,width:0,height:0},L=16,le="1.5s",ce=X({name:"NSelectionRect",props:{disabled:{type:Boolean,default:!1},className:{type:String,default:""},rectStyle:{type:Object,default:()=>({})},threshold:{type:Number,default:5},autoScroll:{type:Boolean,default:!0},scrollSpeed:{type:Number,default:10},scrollEdge:{type:Number,default:10},selectableSelector:{type:String,default:"[data-selectable-id]"},preventDragSelector:{type:String,default:"data-prevent-selection"},onSelectionStart:Function,onSelectionChange:Function,onSelectionEnd:Function,onClearSelection:Function},setup(o,{slots:y,attrs:N}){const S=ee(),i=x(),b=x(),s=M({isSelecting:!1,isMouseDown:!1,startPoint:{...g},currentPoint:{...g},selectedIds:new Set}),v=M(),d=x(),u=()=>{var t;return(t=b.value)==null?void 0:t.element},A=async()=>{if(await Q(),!i.value)return;const t=i.value.querySelector(T.SCROLLBAR);if(!t){console.warn("[SelectionRect] NScrollbar 组件未找到");return}const e=t.querySelector(T.CONTAINER);if(!e){console.warn("[SelectionRect] 滚动容器未找到");return}const l=t.__vueParentComponent,n=l==null?void 0:l.exposed;b.value={element:e,instance:n}},h=w(()=>{const t=u();if(!i.value||!t)return I;const{startPoint:e,currentPoint:l}=s.value,n=Math.max(0,Math.min(e.x,l.x)),c=Math.max(0,Math.min(e.y,l.y)),r=Math.min(t.scrollWidth,Math.max(e.x,l.x)),a=Math.min(t.scrollHeight,Math.max(e.y,l.y));return{left:n,top:c,width:r-n,height:a-c}}),D=w(()=>{const t=u();if(!t)return I;const e=h.value;return{left:e.left-t.scrollLeft,top:e.top-t.scrollTop,width:e.width,height:e.height}}),P=(t,e)=>{if(t.size!==e.size)return!1;for(const l of t)if(!e.has(l))return!1;return!0},B=(t,e)=>{const l=u();if(!i.value||!l)return!1;const n=i.value.getBoundingClientRect(),c=t.getBoundingClientRect(),r={left:c.left-n.left+l.scrollLeft,top:c.top-n.top+l.scrollTop,right:c.right-n.left+l.scrollLeft,bottom:c.bottom-n.top+l.scrollTop};return!(r.right<e.left||r.left>e.left+e.width||r.bottom<e.top||r.top>e.top+e.height)},p=t=>{var n;if(!i.value)return;const e=new Set,l=Array.from(i.value.querySelectorAll(o.selectableSelector));for(const c of l){const r=c.dataset.selectableId;r&&B(c,t)&&e.add(r)}P(s.value.selectedIds,e)||(s.value.selectedIds=e,(n=o.onSelectionChange)==null||n.call(o,Array.from(e)))},O=t=>{const e=u();if(!e)return{dx:0,dy:0};const{clientX:l,clientY:n}=t,c=e.getBoundingClientRect();let r=0,a=0;return n-c.top<o.scrollEdge&&e.scrollTop>0?a=-o.scrollSpeed:c.bottom-n<o.scrollEdge&&e.scrollTop<e.scrollHeight-e.clientHeight&&(a=o.scrollSpeed),l-c.left<o.scrollEdge&&e.scrollLeft>0?r=-o.scrollSpeed:c.right-l<o.scrollEdge&&e.scrollLeft<e.scrollWidth-e.clientWidth&&(r=o.scrollSpeed),{dx:r,dy:a}},$=()=>{var c;if(!o.autoScroll||!d.value)return;const{dx:t,dy:e}=O(d.value);if(t===0&&e===0)return;const l=u();if(!l)return;const n=(c=b.value)==null?void 0:c.instance;if(n!=null&&n.scrollBy?n.scrollBy({left:t,top:e,behavior:"auto"}):l.scrollBy({left:t,top:e,behavior:"auto"}),i.value){const r=i.value.getBoundingClientRect(),{clientX:a,clientY:W}=d.value;s.value.currentPoint={x:a-r.left+l.scrollLeft,y:W-r.top+l.scrollTop}}},F=()=>{v.value||(v.value=window.setInterval(()=>{$(),s.value.isSelecting&&p(h.value)},L))},R=()=>{v.value&&(clearInterval(v.value),v.value=void 0)},H=t=>!t.closest(`[${o.preventDragSelector}]`),C=t=>{const e=u();if(!i.value||!e)return null;const l=i.value.getBoundingClientRect();return{x:t.clientX-l.left+e.scrollLeft,y:t.clientY-l.top+e.scrollTop}},_=t=>{if(o.disabled||t.button!==0||!H(t.target))return;t.preventDefault();const e=C(t);e&&(s.value={isSelecting:!1,isMouseDown:!0,startPoint:e,currentPoint:{...e},selectedIds:new Set},d.value=t)},k=Y(t=>{var n;if(!s.value.isMouseDown)return;d.value=t;const e=C(t);if(!e)return;s.value.currentPoint=e,Math.hypot(e.x-s.value.startPoint.x,e.y-s.value.startPoint.y)>o.threshold&&(s.value.isSelecting||(s.value.isSelecting=!0,(n=o.onSelectionStart)==null||n.call(o)),p(h.value),o.autoScroll&&F())},L),j=t=>{var n,c;if(!s.value.isMouseDown)return;const e=s.value.isSelecting,l=Array.from(s.value.selectedIds);R(),e&&((n=o.onSelectionEnd)==null||n.call(o,l),(c=t==null?void 0:t.stopPropagation)==null||c.call(t)),s.value={isSelecting:!1,isMouseDown:!1,startPoint:{...g},currentPoint:{...g},selectedIds:new Set},d.value=void 0},U=t=>{var l;if(s.value.isSelecting)return;const e=t.target;!e.closest(o.selectableSelector)&&!e.closest("[data-dropdown-option]")&&(s.value.selectedIds.clear(),(l=o.onClearSelection)==null||l.call(o))},E=()=>{s.value.isSelecting&&p(h.value)},V=()=>{R();const t=u();t&&t.removeEventListener("scroll",E)};m(document,"mousedown",U),m(document,"mousemove",k),m(document,"mouseup",j),m(i,"selectstart",t=>{(s.value.isSelecting||s.value.isMouseDown)&&t.preventDefault()}),G(async()=>{await A();const t=u();t&&t.addEventListener("scroll",E,{passive:!0})}),J(V);const q=w(()=>{const t=S.value.primaryColor,e=S.value.primaryColorHover;return`
        .selection-container {
          position: relative;
          user-select: none;
        }
        .selection-wrapper {
          position: absolute;
          inset: 0;
          overflow: hidden;
          pointer-events: none;
          z-index: 9999;
        }
        .selection-rect {
          position: absolute;
          pointer-events: none;
          border: 2px solid ${t};
          background: ${e}14;
          border-radius: 4px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.08);
          transition: opacity 0.1s ease;
        }
        .selection-rect-border {
          position: absolute;
          inset: -1px;
          border: 1px solid ${e}66;
          border-radius: 4px;
          animation: selection-pulse ${le} ease-in-out infinite;
        }
        @keyframes selection-pulse {
          0%, 100% { opacity: 0.6; transform: scale(1); }
          50% { opacity: 1; transform: scale(0.98); }
        }
      `}),z=()=>{const{isSelecting:t}=s.value,{width:e,height:l,left:n,top:c}=D.value;if(!t||e<=0||l<=0)return null;const r=S.value.primaryColor,a=S.value.primaryColorHover;return f("div",{class:"selection-wrapper",style:{position:"absolute",inset:"0",overflow:"hidden",pointerEvents:"none",zIndex:9999}},[f("div",{class:"selection-rect",style:{position:"absolute",left:`${n}px`,top:`${c}px`,width:`${e}px`,height:`${l}px`,border:`2px solid ${r}`,background:`${a}14`,borderRadius:"4px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",...o.rectStyle}},[f("div",{class:"selection-rect-border",style:{position:"absolute",inset:"-1px",border:`1px solid ${a}66`,borderRadius:"4px"}},null)])])};return()=>{var l;const t=z(),e=u();return f("div",{ref:i,class:["selection-container",o.className,N.class],style:"display: flex; flex-direction: column; flex: 1; min-height: 0;",onMousedown:_},[(l=y.default)==null?void 0:l.call(y),e&&t?f(K,{to:e},te(t)?t:{default:()=>[t]}):t,f("style",null,[q.value])])}}});export{ce as N};
