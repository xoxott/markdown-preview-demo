<script setup lang="ts">
import { computed, ref } from 'vue';
import { NInput, useThemeVars } from 'naive-ui';
import MarkDown from '@/components/markdown/index.vue';
const themeVars = useThemeVars();

const content = ref(`# ğŸ“ Markdown ç¼–è¾‘å™¨æ¼”ç¤º

æ¬¢è¿ä½¿ç”¨æœ¬ç¼–è¾‘å™¨ï¼å®ƒæ”¯æŒå¤šç§å¢å¼ºåŠŸèƒ½ï¼ŒåŒ…æ‹¬å›¾è¡¨æ¸²æŸ“ã€ä»£ç è¿è¡Œã€ç»„ä»¶é¢„è§ˆç­‰ã€‚

---

## âœ¨ åŸºç¡€ Markdown åŠŸèƒ½

- æ”¯æŒ **åŠ ç²—**ã€*æ–œä½“*ã€\`è¡Œå†…ä»£ç \`
- æ”¯æŒ [è¶…é“¾æ¥](https://example.com)
- æ”¯æŒå›¾ç‰‡ã€å¼•ç”¨ã€åˆ—è¡¨ç­‰å¸¸è§„ Markdown è¯­æ³•
- åˆ†éš”çº¿ä¸æ ‡é¢˜ï¼š\`---\` ä¸ \`# / ## / ###\`

---

## ğŸ¨ Mermaid å›¾è¡¨

æ”¯æŒæµç¨‹å›¾ã€æ—¶åºå›¾ã€çŠ¶æ€å›¾ç­‰ï¼ŒåŸºäº Mermaid æ¸²æŸ“ï¼š

\`\`\`mermaid
sequenceDiagram
  participant ç”¨æˆ·
  participant ç³»ç»Ÿ
  ç”¨æˆ·->>ç³»ç»Ÿ: ç™»å½•è¯·æ±‚
  ç³»ç»Ÿ-->>ç”¨æˆ·: è¿”å›Token
  ç”¨æˆ·->>ç³»ç»Ÿ: è·å–ç”¨æˆ·ä¿¡æ¯
  ç³»ç»Ÿ-->>ç”¨æˆ·: è¿”å›ç”¨æˆ·æ•°æ®
\`\`\`

---

## ğŸ§  æ€ç»´å¯¼å›¾ï¼ˆMarkmapï¼‰

è‡ªåŠ¨å°† Markdown å¤§çº²ç»“æ„è½¬ä¸ºäº¤äº’å¼æ€ç»´å¯¼å›¾ï¼š

\`\`\`markmap
# Vue ç»„ä»¶é€šä¿¡

- Props å’Œ Emits
- æ’æ§½ï¼ˆSlotsï¼‰
- è·¨ç»„ä»¶é€šä¿¡
  - provide/inject
  - äº‹ä»¶æ€»çº¿ï¼ˆeventï¼‰
  - å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ Piniaï¼‰
\`\`\`

> âœ… å½“å‰ç¼–è¾‘å™¨å·²æ”¯æŒ Markmap æ€ç»´å¯¼å›¾æ¸²æŸ“

---

## ğŸ“Š ECharts å›¾è¡¨æ”¯æŒ

é€šè¿‡ JSON ç›´æ¥ç”Ÿæˆ ECharts å›¾è¡¨ï¼š

\`\`\`echarts
{
  "title": { "text": "å‘¨é”€å”®é¢" },
  "tooltip": {},
  "xAxis": { "data": ["å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››"] },
  "yAxis": {},
  "series": [{ "type": "line", "data": [120, 200, 150, 80] }]
}
\`\`\`

---

## âš™ï¸ JavaScript ä»£ç è¿è¡Œï¼ˆWeb Workerï¼‰

å¯ç›´æ¥è¿è¡Œ JS ä»£ç ï¼Œæ”¯æŒè¾“å‡ºä¸é”™è¯¯æ•è·ï¼š

\`\`\`javascript
function greet(name) {
  return \`ä½ å¥½ï¼Œ\${name}ï¼\`;
}
console.log(greet("ç¼–è¾‘å™¨ç”¨æˆ·"));
\`\`\`

---

## ğŸ§© Vue 3 ç»„ä»¶è¿è¡Œï¼ˆ@vue/replï¼‰

å®æ—¶è¿è¡Œ Vue 3 å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰ï¼š

\`\`\`vue
<template>
  <div class="p-2 text-green-600 border rounded">
    âœ… è¿™æ˜¯ä¸€ä¸ªè¿è¡Œä¸­çš„ Vue ç»„ä»¶ï¼
  </div>
</template>
\`\`\`

---
`);

/**
 * é€å­—æ‰“å°å·¥å…·å‡½æ•°
 *
 * @param fullText è¦æ‰“å°çš„å®Œæ•´æ–‡æœ¬
 * @param onUpdate æ¯æ¬¡æ›´æ–°è°ƒç”¨çš„å›è°ƒï¼Œä¼ å…¥å½“å‰ç´¯ç§¯çš„æ–‡æœ¬
 * @param delay æ¯ä¸ªå­—ç¬¦ä¹‹é—´çš„å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
 */
async function typewriterEffect(fullText: string, onUpdate: (current: string) => void, delay = 100) {
  let currentText = '';
  for (let i = 0; i < fullText.length; i++) {
    currentText += fullText[i];
    onUpdate(currentText);
    // eslint-disable-next-line no-await-in-loop
    await new Promise(resolve => setTimeout(resolve, delay));
  }
}

const clickHandle = () => {
  typewriterEffect(
    content.value,
    currentText => {
      content.value = currentText;
    },
    100
  );
};
const editorStyle = computed(() => ({
  backgroundColor: themeVars.value.bodyColor
}));

const leftStyle = computed(() => ({
  backgroundColor: themeVars.value.bodyColor,
  borderColor: themeVars.value.borderColor,
  color: themeVars.value.textColorBase
}));

const rightStyle = computed(() => ({
  backgroundColor: themeVars.value.bodyColor,
  color: themeVars.value.textColorBase
}));

const previewStyle = computed(() => ({
  backgroundColor: themeVars.value.cardColor,
  color: themeVars.value.textColorBase,
  borderColor: themeVars.value.borderColor
}));
</script>

<template>
  <div class="h-full flex bg-gray-50" :style="editorStyle">
    <!-- å·¦ä¾§è¾“å…¥æ¡† -->
    <div class="w-1/3 overflow-y-auto border-r border-gray-200 p-4" :style="leftStyle">
      <div class="mb-2 text-lg font-semibold">
        Markdown è¾“å…¥
        <NButton @click="clickHandle">æµå¼æ¸²æŸ“</NButton>
      </div>
      <NInput
        v-model:value="content"
        type="textarea"
        :autosize="{ minRows: 20 }"
        placeholder="è¯·è¾“å…¥ Markdown å†…å®¹..."
        class="w-full text-sm font-mono"
      />
    </div>

    <!-- å³ä¾§é¢„è§ˆæ¡† -->
    <div class="w-2/3 overflow-y-auto p-4" :style="rightStyle">
      <div class="mb-2 text-lg font-semibold">é¢„è§ˆç»“æœ</div>
      <div class="border border-gray-200 rounded-md p-4 shadow" :style="previewStyle">
        <MarkDown :content="content" />
      </div>
    </div>
  </div>
</template>
